#!/usr/bin/env node
var ErrorCode;!function(e){e[e.NoError=0]="NoError",e[e.SyntaxError=1]="SyntaxError",e[e.UnexpectedOpenBracket=2]="UnexpectedOpenBracket",e[e.ExpectedCloseBracket=3]="ExpectedCloseBracket",e[e.ExpectedOpenParen=4]="ExpectedOpenParen",e[e.ExpectedCloseParen=5]="ExpectedCloseParen",e[e.ExpectedQuote=6]="ExpectedQuote",e[e.UnknownToken=7]="UnknownToken",e[e.UnknownUnit=8]="UnknownUnit",e[e.UnknownFunction=9]="UnknownFunction",e[e.MissingArgument=10]="MissingArgument",e[e.ExpectedArgument=11]="ExpectedArgument",e[e.TooManyArguments=12]="TooManyArguments",e[e.ExpectedOperand=13]="ExpectedOperand",e[e.InvalidOperand=14]="InvalidOperand",e[e.InvalidUnaryOperand=15]="InvalidUnaryOperand",e[e.ExpectedIntegerIndex=16]="ExpectedIntegerIndex",e[e.CircularDefinition=17]="CircularDefinition",e[e.UnexpectedTokensArray=18]="UnexpectedTokensArray",e[e.UnexpectedTokensType=19]="UnexpectedTokensType",e[e.InvalidTokenName=20]="InvalidTokenName",e[e.InvalidTokenValue=21]="InvalidTokenValue",e[e.InconsistentTokenType=22]="InconsistentTokenType",e[e.UnknownFormat=23]="UnknownFormat",e[e.UnknownValueFormatter=24]="UnknownValueFormatter",e[e.UnknownNameFormatter=25]="UnknownNameFormatter"}(ErrorCode||(ErrorCode={}));const ERRORS={[ErrorCode.SyntaxError]:"Syntax error",[ErrorCode.UnexpectedOpenBracket]:"Unexpected `[`",[ErrorCode.ExpectedCloseBracket]:"Expected `]`",[ErrorCode.ExpectedOpenParen]:"Expected `(`",[ErrorCode.ExpectedCloseParen]:"Expected `)`",[ErrorCode.ExpectedQuote]:'Expected `"`',[ErrorCode.UnknownToken]:"Unknown token `%1`%2",[ErrorCode.UnknownUnit]:"Unknown unit `%1`",[ErrorCode.UnknownFunction]:"Unknown function `%1`%2",[ErrorCode.MissingArgument]:"Missing argument %1 of `%2` of type `%3`",[ErrorCode.ExpectedArgument]:"Expected argument %1 of `%2` to be of type `%3`",[ErrorCode.TooManyArguments]:"Too many arguments for function `%1(%2)`",[ErrorCode.ExpectedOperand]:"Expected operand",[ErrorCode.InvalidOperand]:"Invalid operand",[ErrorCode.InvalidUnaryOperand]:"Invalid operand",[ErrorCode.CircularDefinition]:'Circular definition of the "%1" token',[ErrorCode.UnexpectedTokensArray]:'The "tokens" property is an array. It should be a key/value map of tokens.\n%1',[ErrorCode.UnexpectedTokensType]:'The "tokens" property should be a key/value map of tokens.',[ErrorCode.InvalidTokenName]:'Invalid token name "%1": it must only contain digits, letters, "_" and "-"',[ErrorCode.InvalidTokenValue]:'The "%1" token is invalid. If using a YAML file, make sure RGB hex values are within quotes',[ErrorCode.InconsistentTokenType]:'Inconsistent token type: "%1" ( "%2")',[ErrorCode.UnknownFormat]:'Unknown format "%1"%2',[ErrorCode.UnknownValueFormatter]:'Unknown value formatter "%1"%2',[ErrorCode.UnknownNameFormatter]:'Unknown name formatter "%1"%2',[ErrorCode.ExpectedIntegerIndex]:"Expected a number of array index"};class SyntaxError extends Error{constructor(e,...r){super(),this.code=e,this.args=r}}function throwError(e,...r){throwErrorWithContext(void 0,e,...r)}function throwErrorWithContext(e,r,...t){var n;let o="";throw process.env.TEST?o="[ERR] "+(null!=(n=ErrorCode[r])?n:r):(e&&(o=e.join("\n")+"\n"),o+=ERRORS[r],t.forEach((e,r)=>{o=o.replace(new RegExp(`%${r+1}`,"g"),e)})),new Error(o)}const stringSimilarity=require("string-similarity");function getSuggestion(e,r){const t=function(e,r){if(!e||!r)return"";let t;if(0===(t=r instanceof Map?Array.from(r.keys()):Object.keys(r)).length)return"";const n=stringSimilarity.findBestMatch(e,t);return n.bestMatch.rating>.1?n.bestMatch.target:""}(e,r);return t?`. Did you mean "${t}"?`:""}const DefaultFormatters={valueFormatters:{},nameFormatters:{camelcase:(e,r)=>(e+!r?"":"."+r).toLowerCase().replace(/(?:^\w|[A-Z]|\b\w)/g,(e,r)=>0===r?e.toLowerCase():e.toUpperCase()).replace(/\s+/g,""),kebabcase:(e,r)=>(e+!r?"":"."+r).match(/[A-Z]{2,}(?=[A-Z][a-z0-9]*|\b)|[A-Z]?[a-z0-9]*|[A-Z]|[0-9]+/g).filter(Boolean).map(e=>e.toLowerCase()).join("-"),uppercase:(e,r)=>(e+!r?"":"."+r).toUpperCase(),lowercase:(e,r)=>(e+!r?"":"."+r).toLowerCase()}},DEFAULT_FILE_HEADER=`\nThis file was automatically generated by Chromatic.\nDo not edit.\nGenerated ${(new Date).toISOString()}\n`;var _a;const chalk=require("chalk"),ciInfo=require("ci-info");let gUseColor=null!=(_a=process.stdout.isTTY)&&_a&&!ciInfo.isCI;const terminal={useColor:e=>{gUseColor=e},autoFormat:e=>e.replace(/("(.*)")/g,e=>terminal.string(e.slice(1,-1))).replace(/(`(.*)`)/g,e=>terminal.keyword(e)),success:(e="")=>(chalk.green("✔︎   "+e),gUseColor?chalk.bold.green("✔︎   "+e):"✔︎   "+e),error:(e="")=>gUseColor?chalk.hex("#fa2040")(chalk.bold("✘   "+e)):"✘   "+e,warning:(e="")=>gUseColor?chalk.hex("#ffcc00")(chalk.bold("⚠️   "+e)):"⚠   "+e,path:(e="")=>gUseColor?chalk.hex("#6ab3ff").italic(e):e,keyword:(e="")=>gUseColor?chalk.hex("#ffcc00")(e):e,string:(e="")=>gUseColor?chalk.hex("#ffcc00")('"'+chalk.italic(e)+'"'):'"'+e+'"',dim:(e="")=>gUseColor?chalk.hex("#999")(e):e,time:(e=new Date)=>gUseColor?chalk.hex("#d1d7ff")(`[${e.toLocaleTimeString()}]`):"["+e+"]",link:e=>gUseColor?"\n▷   "+chalk.hex("#d1d7ff")("https://github.com/arnog/chromatic/docs/errors/"+e+".md"):"\n▷   https://github.com/arnog/chromatic/docs/errors/"+e+".md"},colorName=require("color-name"),chroma=require("chroma-js");function clampByte(e){return e<0?0:e>255?255:Math.round(e)}function hueToRgbChannel(e,r,t){return t<0&&(t+=6),t>=6&&(t-=6),t<1?(r-e)*t+e:t<3?r:t<4?(r-e)*(4-t)+e:e}function hslToRgb(e,r,t){e/=60;const n=t<=.5?t*(r+1):t+r-t*r,o=2*t-n;return{r:Math.round(255*hueToRgbChannel(o,n,e+2)),g:Math.round(255*hueToRgbChannel(o,n,e)),b:Math.round(255*hueToRgbChannel(o,n,e-2))}}function rgbToHsl(e,r,t){e/=255,r/=255,t/=255;const n=Math.min(e,r,t),o=Math.max(e,r,t),i=o-n;let a,s;o===n?a=0:e===o?a=(r-t)/i:r===o?a=2+(t-e)/i:t===o&&(a=4+(e-r)/i),(a=Math.min(60*a,360))<0&&(a+=360);const l=(n+o)/2;return{h:a,s:s=o===n?0:l<=.5?i/(o+n):i/(2-o-n),l:l}}function labToRgb(e,r,t){let n=(100*e+16)/116,o=r/500+n,i=n-t/200,a=3.2406*(o=.95047*(o*o*o>.008856?o*o*o:(o-16/116)/7.787))+-1.5372*(n=1*(n*n*n>.008856?n*n*n:(n-16/116)/7.787))+-.4986*(i=1.08883*(i*i*i>.008856?i*i*i:(i-16/116)/7.787)),s=-.9689*o+1.8758*n+.0415*i,l=.0557*o+-.204*n+1.057*i;return a=a>.0031308?1.055*Math.pow(a,1/2.4)-.055:12.92*a,s=s>.0031308?1.055*Math.pow(s,1/2.4)-.055:12.92*s,l=l>.0031308?1.055*Math.pow(l,1/2.4)-.055:12.92*l,{r:clampByte(255*a),g:clampByte(255*s),b:clampByte(255*l)}}function roundTo(e,r){return Math.round(e*Math.pow(10,r)+1e-14)/Math.pow(10,r)}class Value{constructor(){this.source=""}css(){return""}type(){}canonicalScalar(){return 0}getSource(){return this.source}setSource(e){this.source=e}}class Percentage extends Value{constructor(e){super(),this.value=e}css(){return roundTo(this.value,2)+"%"}type(){return"percentage"}canonicalScalar(){return this.value/100}}class Angle extends Value{constructor(e,r){super(),this.value=e,this.unit=r}css(){return roundTo(this.value,2)+this.unit}type(){return"angle"}canonicalScalar(){return asDegree(this)}}class Length extends Value{constructor(e,r){if(super(),"number"==typeof e)this.value=e,this.unit=0===e?"px":r;else if(void 0===r){const r=Object.keys(e).filter(r=>"number"==typeof e[r]&&0!==e[r]);0===r.length?(this.value=0,this.unit="px"):1===r.length?(this.value=e[r[0]],this.unit=r[0]):(this.value=e,this.unit="multi")}else this.value=e,this.unit="multi",console.assert("multi"===r)}css(){if("number"==typeof this.value)return 0===this.value||isNaN(this.value)?Number(this.value).toString():roundTo(this.value,2)+this.unit;const e={};let r=Object.keys(this.value);if(r.length>1){let t=0;r.forEach(r=>{const n=asPx(this.value[r],r);isNaN(n)?"px"!==r&&(e[r]=this.value[r]):t+=n}),0!==t&&(e.px=t)}else e[r[0]]=this.value[r[0]];return 1===(r=Object.keys(e)).length?"px"===r[0]&&0===e.px?"0":roundTo(e[r[0]],2)+r[0]:"calc("+r.map(r=>Number(e[r]).toString()+r).join(" + ")+")"}type(){return"length"}canonicalScalar(){return"multi"===this.unit?NaN:asPx(this.value,this.unit)}}class Time extends Value{constructor(e,r){super(),this.value=e,this.unit=r}css(){return roundTo(this.value,2)+this.unit}type(){return"time"}canonicalScalar(){return"ms"===this.unit?this.value/1e3:this.value}}class Frequency extends Value{constructor(e,r){super(),this.value=e,this.unit=r}css(){return roundTo(this.value,2)+this.unit}type(){return"frequency"}canonicalScalar(){return"khz"===this.unit?1e3*this.value:this.value}}class NumberValue extends Value{constructor(e){super(),this.value=e}css(){return Number(this.value).toString()}type(){return"number"}canonicalScalar(){return this.value}}class StringValue extends Value{constructor(e){super(),this.value=e}css(e=""){return e+this.value+e}type(){return"string"}canonicalScalar(){return parseFloat(this.value)}}class Color extends Value{constructor(e){if(super(),"string"==typeof e)if("transparent"===e.toLowerCase())[this.r,this.g,this.b,this.a]=[0,0,0,0],[this.h,this.s,this.l]=[0,0,0];else{const r=function(e){if(!e)return;if("#"!==e[0])return;let r;return(e=e.slice(1)).length<=4?(r={r:parseInt(e[0]+e[0],16),g:parseInt(e[1]+e[1],16),b:parseInt(e[2]+e[2],16)},4===e.length&&(r.a=parseInt(e[3]+e[3],16)/255)):(r={r:parseInt(e[0]+e[1],16),g:parseInt(e[2]+e[3],16),b:parseInt(e[4]+e[5],16)},8===e.length&&(r.a=parseInt(e[6]+e[7],16)/255)),r&&void 0===r.a&&(r.a=1),r}(e)||function(e){const r=colorName[e.toLowerCase()];if(r)return{r:r[0],g:r[1],b:r[2],a:1}}(e);if(!r)throw new Error;Object.assign(this,r),Object.assign(this,rgbToHsl(this.r,this.g,this.b))}else Object.assign(this,e),"number"==typeof this.r?Object.assign(this,rgbToHsl(this.r,this.g,this.b)):(console.assert("number"==typeof this.h),this.h=(this.h+360)%360,this.s=Math.max(0,Math.min(1,this.s)),this.l=Math.max(0,Math.min(1,this.l)),Object.assign(this,hslToRgb(this.h,this.s,this.l)));"number"!=typeof this.a&&(this.a=1)}type(){return"color"}opaque(){return new Color({r:this.r,g:this.g,b:this.b})}luma(){let e=this.r/255,r=this.g/255,t=this.b/255;return.2126*(e=e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4))+.7152*(r=r<=.03928?r/12.92:Math.pow((r+.055)/1.055,2.4))+.0722*(t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4))}hex(){let e=((1<<24)+(clampByte(this.r)<<16)+(clampByte(this.g)<<8)+clampByte(this.b)).toString(16).slice(1);return this.a<1&&(e+=("00"+Math.round(255*this.a).toString(16)).slice(-2)),e[0]===e[1]&&e[2]===e[3]&&e[4]===e[5]&&e[6]===e[7]&&(e=e[0]+e[2]+e[4]+(this.a<1?e[6]:"")),"#"+e}rgb(){return`rgb(${this.r}, ${this.g}, ${this.b}${this.a<1?", "+Number(100*this.a).toFixed(0)+"%":""})`}hsl(){return`hsl(${this.h}deg, ${this.s}%, ${this.l}%, ${this.a<1?", "+Number(100*this.a).toFixed(0)+"%":""})`}css(){return 0===this.r&&0===this.g&&0===this.b&&0===this.a?"transparent":this.a<1?this.rgb():this.hex()}canonicalScalar(){return this.luma()}}class ArrayValue extends Value{constructor(e){super(),this.value=e.map(e=>makeValueFrom(e))}get(e){return this.value[e]}type(){return"array"}css(){return'"['+this.value.map(e=>e.css()).join(", ")+']"'}}function isNumber(e){return e instanceof NumberValue}function assertNumber(e){console.assert(e instanceof NumberValue)}function isPercentage(e){return e instanceof Percentage}function isLength(e){return e instanceof Length}function isString(e){return e instanceof StringValue}function isAngle(e){return e instanceof Angle}function isTime(e){return e instanceof Time}function isFrequency(e){return e instanceof Frequency}function isZero(e){return e instanceof NumberValue&&0===e.value}function makeValueFrom(e){switch(e.type()){case"color":return new Color(e);case"frequency":return new Frequency(e.value,e.unit);case"time":return new Time(e.value,e.unit);case"angle":return new Angle(e.value,e.unit);case"string":return new StringValue(e.value);case"length":return new Length(e.value,e.unit);case"percentage":return new Percentage(e.value);case"number":return new NumberValue(e.value);case"array":return new ArrayValue(e.value.map(makeValueFrom));default:console.error("Unknown value type")}}function asColor(e){if(!e)return;let r;try{r=new Color(e)}catch(e){r=void 0}return r}function asDecimalByte(e){return isPercentage(e)?Math.round(255*e.value/100):(assertNumber(e),Math.round(e.value))}function asInteger(e,r){return isNumber(e)?Math.round(e.value):(void 0===r&&assertNumber(e),r)}function asDecimalRatio(e,r){return isPercentage(e)?e.value/100:isNumber(e)?e.value:(void 0===r&&(t=e,console.assert(t instanceof NumberValue||t instanceof Percentage)),r);var t}function asDegree(e){return isAngle(e)?"deg"===e.unit?e.value:"rad"===e.unit?180*e.value/Math.PI:"grad"===e.unit?180*e.value/200:"turn"===e.unit?360*e.value:void throwError(ErrorCode.UnknownUnit,e.unit):(assertNumber(e),e.value)}function asPx(e,r,t){var n,o,i,a,s,l,u,c,h,m,g,p,d,f,v,y;if("number"!=typeof e){console.assert("multi"===r);let o=null!=(n=e.px)?n:0;return Object.keys(e).forEach(e=>{const r=asPx(this.value[e],e,t);if(isNaN(r))return NaN;o+=o}),o}if("px"===r)return e;if("cm"===r)return 96*e/2.54;if("mm"===r)return 96*e/25.4;if("Q"===r)return 96*e/2.54/40;if("in"===r)return 96*e;if("pc"===r)return 16*e;if("pt"===r)return 96*e/72;let b;return(b="vmin"===r?Math.min(null!=(a=null===(i=null===(o=t)||void 0===o?void 0:o.baseUnits)||void 0===i?void 0:i.vh)?a:NaN,null!=(u=null===(l=null===(s=t)||void 0===s?void 0:s.baseUnits)||void 0===l?void 0:l.vw)?u:NaN):"vmax"===r?Math.max(null!=(m=null===(h=null===(c=t)||void 0===c?void 0:c.baseUnits)||void 0===h?void 0:h.vh)?m:NaN,null!=(d=null===(p=null===(g=t)||void 0===g?void 0:g.baseUnits)||void 0===p?void 0:p.vw)?d:NaN):null!=(y=null===(v=null===(f=t)||void 0===f?void 0:f.baseUnits)||void 0===v?void 0:v[r])?y:NaN)*e}function asPercent(e){return isPercentage(e)?e.value/100:(assertNumber(e),e.value)}function compareValue(e,r){return r.canonicalScalar()-e.canonicalScalar()}function promoteToMulti(e){if(isNumber(e))return new Length({px:e.value},"multi");if("multi"===e.unit)return e;const r={};return r[e.unit]=e.value,new Length(r,"multi")}const whiteColor=new Color("#fff"),blackColor=new Color("#000");function scaleColor(e,r,t,n){var o,i;let a,s=new Color("#fff"),l=new Color("#000"),u=10;if("color"===(null===(o=t)||void 0===o?void 0:o.type()))s=asColor(e),a=asColor(r),l=asColor(t),u=asInteger(n,10);else if("color"===(null===(i=r)||void 0===i?void 0:i.type()))s=asColor(e),a=asColor(r),l=asColor(r),u=asInteger(t,10);else if("color"===e.type()){a=asColor(e),l=new Color({h:a.h>=60&&a.h<=240?a.h+30:a.h-30,s:a.s,l:.35}),u=asInteger(r,10);const t=new StringValue("rgb");return new ArrayValue([FUNCTIONS.mix(s,a,new NumberValue(.12),t),FUNCTIONS.mix(s,a,new NumberValue(.3),t),FUNCTIONS.mix(s,a,new NumberValue(.5),t),FUNCTIONS.mix(s,a,new NumberValue(.7),t),FUNCTIONS.mix(s,a,new NumberValue(.85),t),a,FUNCTIONS.mix(l,a,new NumberValue(.85),t),FUNCTIONS.mix(l,a,new NumberValue(.7),t),FUNCTIONS.mix(l,a,new NumberValue(.5),t),FUNCTIONS.mix(l,a,new NumberValue(.2),t)])}if(!s||!a||!l)return;const c=chroma.scale([s.opaque().hex(),a.opaque().hex(),l.opaque().hex()]).mode("lab").correctLightness().colors(u+1);return new ArrayValue(c.map(e=>new Color(e)))}let FUNCTIONS={};FUNCTIONS={calc:e=>e,rgb:(e,r,t,n)=>new Color({r:asDecimalByte(e),g:asDecimalByte(r),b:asDecimalByte(t),a:asDecimalRatio(n,1)}),hsl:(e,r,t,n)=>new Color({h:asDegree(e),s:asPercent(r),l:asPercent(t),a:asDecimalRatio(n,1)}),hsv:(e,r,t,n)=>{let o=asPercent(r);const i=asPercent(t),a=(2-o)*i/2;return 0!=a&&(o=1==a?0:a<.5?o*i/(2*a):o*i/(2-2*a)),new Color({h:asDegree(e),s:o,l:a,a:asDecimalRatio(n,1)})},hwb:(e,r,t,n)=>new Color(Object.assign({a:asDecimalRatio(n,1)},function(e,r,t){const n=hslToRgb(e,1,.5),o=[];o[0]=n.r/255,o[1]=n.g/255,o[2]=n.b/255;const i=r+t;i>1&&(r=Number((r/i).toFixed(2)),t=Number((t/i).toFixed(2)));for(let e=0;e<3;e++)o[e]*=1-r-t,o[e]+=r,o[e]=Number(255*o[e]);return{r:o[0],g:o[1],b:o[2]}}(asDegree(e),asPercent(r),asPercent(t)))),lab:(e,r,t,n)=>new Color(Object.assign({a:asDecimalRatio(n,1)},labToRgb(asPercent(e),asDecimalRatio(r),asDecimalRatio(t)))),gray:(e,r)=>new Color(Object.assign({a:asDecimalRatio(r,1)},labToRgb(asPercent(e),0,0))),min:(e,r)=>compareValue(e,r)<0?e:r,max:(e,r)=>compareValue(e,r)<0?r:e,clamp:(e,r,t)=>compareValue(r,e)<0?e:compareValue(r,t)>0?t:r,mix:(e,r,t,n)=>{const o=function(e,r){return isString(e)?e.value:"hsl"}(n).toLowerCase(),i=asColor(e);if(!i)return;const a=asColor(r);if(!a)return i;const s=asDecimalRatio(t,.5);let l="number"==typeof a.a?a.a:1;return l+=(("number"==typeof i.a?a.a:1)-l)*s,"rgb"===o?new Color({r:i.r+(a.r-i.r)*s,g:i.g+(a.g-i.g)*s,b:i.b+(a.b-i.b)*s,a:l}):"hsl"===o?new Color({h:i.h+(a.h-i.h)*s,s:i.s+(a.s-i.s)*s,l:i.l+(a.l-i.l)*s,a:l}):void 0},saturate:(e,r)=>{const t=asColor(e);if(t)return new Color({h:t.h,s:t.s+(1-t.s)*asDecimalRatio(r,.1),l:t.l,a:t.a})},desaturate:(e,r)=>{const t=asColor(e);if(t)return new Color({h:t.h,s:t.s-t.s*asDecimalRatio(r,.1),l:t.l,a:t.a})},lighten:(e,r)=>{const t=asColor(e);if(t)return new Color({h:t.h,s:t.s,l:t.l+(1-t.l)*asDecimalRatio(r,.1),a:t.a})},darken:(e,r)=>{const t=asColor(e);if(t)return new Color({h:t.h,s:t.s,l:t.l-t.l*asDecimalRatio(r,.1),a:t.a})},rotateHue:(e,r)=>{const t=asColor(e);if(t)return r&&(isAngle(r)||isNumber(r))?new Color({h:(t.h+asDegree(r)+360)%360,s:t.s,l:t.l,a:t.a}):t},complement:e=>{const r=asColor(e);if(r)return new Color({h:(r.h+180)%360,s:r.s,l:r.l,a:r.a})},contrast:(e,r,t)=>{const n=asColor(e),o=asColor(r)||blackColor,i=asColor(t)||whiteColor;let a,s;const l=n.luma(),u=o.luma(),c=i.luma();return(a=l>u?(l+.05)/(u+.05):(u+.05)/(l+.05))>(s=l>c?(l+.05)/(c+.05):(c+.05)/(l+.05))?o:i},rgba:(e,r,t,n)=>FUNCTIONS.rgb(e,r,t,n),hsla:(e,r,t,n)=>FUNCTIONS.hsl(e,r,t,n),tint:(e,r)=>FUNCTIONS.mix(whiteColor,e,null!=r?r:new NumberValue(.1)),shade:(e,r)=>FUNCTIONS.mix(blackColor,e,null!=r?r:new NumberValue(.1)),scale:(e,r,t,n)=>scaleColor(e,r,t,n)};const colorFunctions=["rgb","rgba","hsl","hsla","hwb","grey","lab"],FUNCTION_ARGUMENTS={calc:"any",rgb:"number|percentage, number|percentage, number|percentage,number|percentage|none",rgba:"number|percentage, number|percentage, number|percentage,number|percentage|none",hsl:"number|angle, number|percentage, number|percentage, number|percentage|none",hsla:"number|angle, number|percentage, number|percentage, number|percentage|none",hsv:"number|angle, number|percentage, number|percentage, number|percentage|none",hwb:"number|angle, number|percentage, number|percentage, number|percentage|none",lab:"number|percentage, number, number, number|percentage|none",gray:"number|percentage, number|percentage|none",min:"any, any",max:"any, any",clamp:"any, any, any",mix:"color, color, number|percentage|none, string|none",saturate:"color, number|percentage|none",desaturate:"color, number|percentage|none",lighten:"color, number|percentage|none",darken:"color, number|percentage|none",rotateHue:"color, angle|number|none",complement:"color",contrast:"color, color|none, color|none",tint:"color, number|percentage|none",shade:"color, number|percentage|none"};class Stream{constructor(e,r={}){this.s="",this.index=0,this.options={},this.s=e,this.index=0,this.options=r}isEOF(){return this.index>=this.s.length}lookAhead(e){return this.s.slice(this.index,this.index+e)}skipWhiteSpace(){this.match(/^\s*/)}match(e){if("string"==typeof e){if(this.lookAhead(e.length)===e)return this.index+=e.length,e}else{const r=this.s.slice(this.index).match(e);if(r&&r[0])return this.index+=r[0].length,r[1]||!0}}error(e,...r){var t,n,o,i;const a=null!=(n=null===(t=this.s.slice(0,this.index).match(/^(.*)/))||void 0===t?void 0:t[1])?n:"",s=null!=(i=null===(o=this.s.slice(this.index).match(/(.*)$/))||void 0===o?void 0:o[1])?i:"";throwErrorWithContext([a+terminal.dim(s)," ".repeat(a.length)+"⇧"],e,...r)}applyOpToLength(e,r,t){isNumber(r)&&"/"===e&&this.error(ErrorCode.InvalidOperand),isNumber(r)||isNumber(t)||"*"!==e||this.error(ErrorCode.InvalidOperand);const n={"+":(e,r)=>e+r,"-":(e,r)=>e-r,"*":(e,r)=>e*r,"/":(e,r)=>e/r}[e];if(isNumber(r)){if(o=t,console.assert(o instanceof Length),"multi"===t.unit){const e={};return Object.keys(t.value).forEach(o=>{e[o]=n(r.value,t.value[o])}),new Length(e)}return new Length(n(r.value,t.value),t.unit)}var o;if(isNumber(t)){if("number"==typeof r.value)return new Length(n(r.value,t.value),r.unit);const e={};return Object.keys(r.value).forEach(o=>{e[o]=n(r.value[o],t.value)}),new Length(e)}if("/"===e)return"multi"!==r.unit&&"multi"!==t.unit||this.error(ErrorCode.InvalidOperand),r.unit===t.unit?new NumberValue(r.value/t.value):new NumberValue(r.canonicalScalar()/t.canonicalScalar());const i=promoteToMulti(r),a=promoteToMulti(t),s={};return[...Object.keys(i.value),...Object.keys(a.value)].forEach(e=>{void 0===a.value[e]?s[e]=i.value[e]:void 0===i.value[e]?s[e]=a.value[e]:s[e]=n(i.value[e],a.value[e])}),new Length(s)}parseUnit(e){if(this.match("%"))return new Percentage(e);let r=this.match(/^(em|ex|ch|rem|vw|vh|vmin|vmax|px|cm|mm|in|pt|pc|Q)/);return r?new Length(e,r):(r=this.match(/^(deg|°|rad|grad|turn)/))?new Angle(e,"°"===r?"deg":r):(r=this.match(/^(ms|s)/))?new Time(e,r):(r=this.match(/^(khz|hz|kHz|Hz)/))?new Frequency(e,r.toLowerCase()):((r=this.match(/^([a-zA-Z]+)/))&&this.error(ErrorCode.UnknownUnit,r),new NumberValue(e))}parseIndex(e){let r=e;if(this.match("["))if("array"!==e.type())this.error(ErrorCode.UnexpectedOpenBracket);else{const t=asInteger(this.parseExpression(),NaN);isNaN(t)&&this.error(ErrorCode.ExpectedIntegerIndex),r=e.get(t),this.skipWhiteSpace(),this.match("]")||this.error(ErrorCode.ExpectedCloseBracket)}return r}parseLiteral(){var e,r,t;let n;const o=this.index,i=this.match(/^\s*([+\-])\s*/);if(i){const e=this.parseLiteral();if("-"===i){if(isPercentage(e))return new Percentage(-100*asPercent(e));if(isNumber(e))return new NumberValue(-e.value);if(isAngle(e))return new Angle(-e.value,e.unit);if(isLength(e))return this.applyOpToLength("-",new Length(0,"px"),e);this.error(ErrorCode.InvalidUnaryOperand)}return e}const a=this.match(/^([0-9]*\.[0-9]+|\.?[0-9]+)/);if(a&&(n=this.parseUnit(parseFloat(a))),!n&&this.match("[")){const e=[];for(;"]"!==this.lookAhead(1)&&!this.isEOF();){const r=this.parseExpression();r||this.error(ErrorCode.SyntaxError),e.push(r),this.match(/^(\s*,?|\s+)/)}return this.isEOF()&&this.error(ErrorCode.ExpectedCloseBracket),this.match("]"),new ArrayValue(e)}if(!n&&this.match('"')){let e="";for(;'"'!==this.lookAhead(1)&&!this.isEOF();)"\\"===this.lookAhead(1)?(e+=this.s[this.index+1],this.index+=2):(e+=this.s[this.index],this.index+=1);return this.isEOF()&&this.error(ErrorCode.ExpectedQuote),this.match('"'),new StringValue(e)}if(!n&&this.match("{")){const o=this.match(/^([a-zA-Z_-][a-zA-Z0-9\._-]*)/);if(o){let i=null===(e=this.options)||void 0===e?void 0:e.aliasResolver(o);if("string"==typeof i){const e=o.match(/^(.+)-([0-9]{2,3})$/);if(e){const n=null===(r=this.options)||void 0===r?void 0:r.aliasResolver(e[1]);if("string"!=typeof n&&n instanceof Color){const r=Math.round(parseInt(e[2])/100);i=null===(t=scaleColor(n))||void 0===t?void 0:t.get(r)}else"string"==typeof n?this.error(ErrorCode.UnknownToken,e[1],n):this.error(ErrorCode.InvalidOperand)}}"string"==typeof i&&this.error(ErrorCode.UnknownToken,o,i),(n=i)&&(n=makeValueFrom(n)).setSource("{"+o+"}")}this.match("}")}return n||(n=asColor(this.match(/^\s*(#[0-9a-fA-F]{3,8})/))),n||(this.index=o,n=asColor(this.match(/^\s*([a-zA-Z]+)/))),n||(this.index=o),n}parseColorArguments(){const e=[];if(this.skipWhiteSpace(),!this.match("("))return;let r=this.parseExpression();if(r){if(e.push(r),!this.match(/^(\s*,?|\s+)/))return this.match(")"),e;if(r=this.parseExpression()){if(e.push(r),!this.match(/^(\s*,?|\s+)/))return this.match(")"),e;if(r=this.parseExpression()){if(e.push(r),!this.match(/^(\s*,?|\s+|\s*\/)/))return this.match(")"),e;(r=this.parseExpression())&&e.push(r)}}}return this.match(")"),e}parseArguments(){if(this.skipWhiteSpace(),!this.match("("))return;const e=[];for(;")"!==this.lookAhead(1)&&!this.isEOF();){const r=this.parseExpression();r||this.error(ErrorCode.SyntaxError),e.push(r),this.match(/^(\s*,?|\s+)/)}return this.isEOF()&&this.error(ErrorCode.ExpectedCloseParen),this.match(")"),e}parseCall(){const e=this.index,r=this.match(/^([a-zA-Z\-]+)/);if(r)if(FUNCTIONS[r]){const e=colorFunctions.includes(r)?this.parseColorArguments():this.parseArguments();if(e){try{!function(e,r){var t;const n=null===(t=FUNCTION_ARGUMENTS[e])||void 0===t?void 0:t.split(",").map(e=>e.trim());if(n&&(n.forEach((t,n)=>{var o;const i=t.split("|").map(e=>e.trim());if(!i.includes("none")&&!r[n])throw new SyntaxError(ErrorCode.MissingArgument,String(n+1),e,i.join(", "));if(r[n]&&!i.includes("any")&&!i.includes(null===(o=r[n])||void 0===o?void 0:o.type()))throw new SyntaxError(ErrorCode.ExpectedArgument,String(n+1),e,i.join(", "))}),r.length>n.length))throw new SyntaxError(ErrorCode.TooManyArguments,e,n.join(", "))}(r,e)}catch(e){e.code?this.error(e.code,...e.args):this.error(e.message)}return FUNCTIONS[r](...e)}this.error(ErrorCode.SyntaxError)}else"("===this.lookAhead(1)&&this.error(ErrorCode.UnknownFunction,r,getSuggestion(r,FUNCTIONS));this.index=e}parseTerminal(){const e=this.parseCall()||this.parseGroup()||this.parseLiteral();return e?this.parseIndex(e):e}parseFactor(){let e=this.parseTerminal(),r=this.match(/^\s*([*|/])\s*/);for(;r;){const t={"*":(e,r)=>e*r,"/":(e,r)=>e/r}[r],n=this.parseTerminal();if(n||this.error(ErrorCode.ExpectedOperand),isNumber(n))isNumber(e)?e=new NumberValue(t(e.value,n.value)):isPercentage(e)?e=new Percentage(t(e.value,n.value)):isLength(e)?e=this.applyOpToLength(r,e,n):isAngle(e)?e=new Angle(t(e.value,n.value),e.unit):isFrequency(e)?e=new Frequency(t(e.value,n.value),e.unit):isTime(e)&&(e=new Time(t(e.value,n.value),e.unit));else{if((isNumber(e)||isLength(e))&&isLength(n))return this.applyOpToLength(r,e,n);isNumber(e)?isPercentage(n)?e=new Percentage(t(e.value,n.value)):isLength(n)?e=this.applyOpToLength(r,e,n):isAngle(n)?e=new Angle(t(e.value,n.value),n.unit):isFrequency(n)?e=new Frequency(t(e.value,n.value),n.unit):isTime(n)&&(e=new Time(t(e.value,n.value),n.unit)):"/"===r&&e.type()===n.type()?e=new NumberValue(e.canonicalScalar()/n.canonicalScalar()):this.error(ErrorCode.InvalidOperand)}r=this.match(/^\s*([*|/])\s*/)}return e}parseTerm(){let e=this.parseFactor(),r=this.match(/^\s*([+\-])\s*/);for(;r;){const t={"+":(e,r)=>e+r,"-":(e,r)=>e-r}[r],n=this.parseFactor();n||this.error(ErrorCode.ExpectedOperand),isString(e)||isString(n)?("-"===r&&this.error(ErrorCode.InvalidOperand),e=new StringValue(t(e.css(),n.css()))):isNumber(e)&&isNumber(n)?e=new NumberValue(t(e.value,n.value)):(isZero(e)||isPercentage(e))&&(isZero(n)||isPercentage(n))?e=new Percentage(100*t(asPercent(e),asPercent(n))):isZero(e)&&isTime(n)?e=new Time(t(0,n.value),n.unit):isTime(e)&&isZero(n)?e=new Time(e.value,e.unit):isTime(e)&&isTime(n)?e=e.unit===n.unit?new Time(t(e.value,n.value),e.unit):new Time(t(e.canonicalScalar(),n.canonicalScalar()),"s"):isZero(e)&&isFrequency(n)?e=new Frequency(t(0,n.value),n.unit):isFrequency(e)&&isZero(n)?e=new Frequency(e.value,e.unit):isFrequency(e)&&isFrequency(n)?e=e.unit===n.unit?new Frequency(t(e.value,n.value),e.unit):new Frequency(t(e.canonicalScalar(),n.canonicalScalar()),"hz"):isZero(e)&&isAngle(n)?e=new Angle(t(0,n.value),n.unit):isAngle(e)&&isZero(n)?e=new Angle(e.value,e.unit):isAngle(e)&&isAngle(n)?e=e.unit===n.unit?new Angle(t(e.value,n.value),e.unit):new Angle(t(asDegree(e),asDegree(n)),"deg"):(isZero(e)||isLength(e))&&(isZero(n)||isLength(n))?e=this.applyOpToLength(r,e,n):this.error(ErrorCode.InvalidOperand),r=this.match(/^\s*([+\-])\s*/)}return e}parseGroup(){let e;return this.match("(")&&(e=this.parseExpression(),this.skipWhiteSpace(),this.match(")")||this.error(ErrorCode.ExpectedCloseParen)),e&&isNumber(e)&&(e=this.parseUnit(e.value)),e}parseExpression(){return this.skipWhiteSpace(),this.parseTerm()}}function sanitizePropertyNameForCSS(e){return e.replace(/[^a-zA-Z0-9_-]/g,"-")}function renderSassProperty(e){return`${e.definition.comment?"// "+e.definition.comment+"\n":""}$${sanitizePropertyNameForCSS(e.propertyName)}: ${e.propertyValue} !default;`}const WebFormats={formats:{sass:{ext:".scss",renderFile:e=>(e.header?"/* "+e.header.split("\n").join("\n * ")+"\n */\n\n":"")+e.content,renderProperty:renderSassProperty,renderGroup:function(e){let r="";const t={},n=[];return e.definitions.forEach((e,r)=>{Object.keys(e.value).length>1?Object.keys(e.value).forEach(e=>{t[e]||(t[e]=[]),t[e].push(r)}):n.push(r)}),Object.keys(t).forEach(n=>{const o=t[n].map(r=>(function(e){return`--${sanitizePropertyNameForCSS(e.propertyName)}: ${e.propertyValue};`})(Object.assign(Object.assign({},e),{theme:n,category:"",token:r,definition:e.definitions.get(r),propertyName:r,propertyValue:e.values.get(r+("_"===n?"":"."+n))}))).join("\n\t");r+="_"===n?`:root {\n\t${o}\n}\n`:`body[data-theme="${n}"] {\n\t${o}\n}\n`}),r+=n.map(r=>renderSassProperty(Object.assign(Object.assign({},e),{category:"",theme:"",token:r,definition:e.definitions.get(r),propertyName:r,propertyValue:e.values.get(r)}))).join("\n")}},plist:{ext:".plist",renderFile:e=>'\n<?xml version="1.0" encoding="UTF-8"?>\n<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">\n\n'+(e.header?"\x3c!-- \n"+e.header+"\n--\x3e\n\n":"")+e.content,renderGroup:e=>`<plist version="1.0"><dict>\n\t${e.properties.join("\n\t")}\n</dict></plist>`,renderProperty:e=>`${e.definition.comment?"\x3c!-- "+e.definition.comment+" --\x3e\n\t":""}<key>${e.propertyName}</key>\n\t<string>${e.propertyValue}</string> `,valueFormatters:["color/plist"]}}},marked=require("marked"),highlight=require("highlight.js"),handlebars=require("handlebars"),fs=require("fs");function renderFragment(e){let r="";const t={colors:[],group:""};return e.themes.forEach(n=>{t.group=1===e.themes.length?"":"_"===n?"Base":n,t.colors=[],e.definitions.forEach((r,o)=>{var i,a;if(r.value[n]){const s=o+("_"===n?"":"."+n),l=e.rawValues.get(s);if("color"===l.type()){const e=l;let n,s=e.luma()>=1?"frame ":"";e.luma()>.42&&(s+="light"),e.a<1&&((n=new Color(e)).a=1),t.colors.push({name:o,def:r.value,source:e.getSource(),value:e.css(),comment:(i=r.comment,null!=i?i:""),cls:s,opaqueColor:null===(a=n)||void 0===a?void 0:a.css()})}}}),r+=handlebars.compile(fs.readFileSync(__dirname+"/templates/html-colors.hbs","utf-8"))(t)}),r&&(r="<h2>Colors</h2>"+r),r}const StyleGuideFormat={formats:{"html/fragment":{ext:".html",renderFile:renderFragment,renderGroup:function(e){return renderFragment(e)},renderProperty:function(e){let r="";return r+=`<b>${e.propertyName}</b>: ${e.propertyValue}`,e.definition.comment&&(r+=`<p>${e.definition.comment}</p>`),e.definition.remarks&&(r+=marked(e.definition.remarks)),r}},html:{extends:"html/fragment",ext:".html",renderFile:function(e){return handlebars.compile(fs.readFileSync(__dirname+"/templates/html-file.hbs","utf-8"))(e)}}}};marked.setOptions({renderer:new marked.Renderer,highlight:function(e){return highlight.highlightAuto(e).value},pedantic:!1,gfm:!0,breaks:!1,sanitize:!1,smartLists:!0,smartypants:!1,xhtml:!1});const{cosmiconfigSync:cosmiconfigSync}=require("cosmiconfig"),configParser=cosmiconfigSync("chromatic"),glob=require("glob"),fs$1=require("fs-extra"),path=require("path"),yaml=require("yaml"),json5=require("json5"),resolveFrom=require("resolve-from"),gConfig={};let gThemes,gTokenDefinitions,gTokenValues,gRecursiveEvaluationStack,gProcessedFiles,gWatching=!1,gIgnoreErrors=!1;function error(e){var r;"string"==typeof e&&(e=[e]);const t="\n"+[].concat(...e.map(e=>e.split("\n"))).join("\n    ");null===(r=gConfig.console)||void 0===r||r.error(terminal.autoFormat(t)),gWatching||gIgnoreErrors||process.exit(1)}function log(e){var r;null===(r=gConfig.console)||void 0===r||r.log(e)}function mergeObject(e,r){e!==r&&r&&Object.keys(r).forEach(t=>{Array.isArray(r[t])?(e[t]||(e[t]=[]),e[t]=[...e[t],...r[t]]):"object"==typeof r[t]?(e[t]||(e[t]={}),mergeObject(e[t],r[t])):void 0!==r[t]&&(e[t]=r[t])})}function processPath(e){var r,t;const n=[];if(e=path.resolve(path.normalize(e)),gProcessedFiles.includes(e))return;if(gProcessedFiles.push(e),fs$1.lstatSync(e).isDirectory())return void glob.sync(e+"/**/*."+gConfig.tokenFileExt).forEach(processPath);let o;try{const r=fs$1.readFileSync(e,"utf8");o=/^\.json/.test(path.extname(e))?json5.parse(r):yaml.parse(r)}catch(e){n.push((e.name?e.name+": ":"")+e.message)}if((null===(r=o)||void 0===r?void 0:r.import)&&("string"==typeof o.import&&(o.import=[o.import]),Array.isArray(o.import)?o.import.forEach(r=>{let t=e;try{processPath(t=resolveFrom(path.parse(e).dir,r))}catch(e){n.push(`option "import: ${r}"`),"MODULE_NOT_FOUND"===e.code?n.push("Module not found."+("./"===r.slice(0,2)?"":`\nTo import as a file, use a relative path: "./${r}"`)):"ENOENT"===e.code?n.push("→ "+terminal.path(t)+"\nFile not found."):n.push(e.message)}}):n.push('Option "import" should be a path or an array of paths')),o&&gConfig.verbose&&(o.imports||o.extends||o.include||o.includes)&&!o.import&&log(terminal.warning()+terminal.path(path.relative("",e))+`\n${terminal.warning("Warning:")} use the \`"import"\` property to import other token files`),null===(t=o)||void 0===t?void 0:t.tokens)try{"object"!=typeof o.tokens?throwError(ErrorCode.UnexpectedTokensType):function e(r,t,n){Array.isArray(n)&&throwError(ErrorCode.UnexpectedTokensArray,terminal.link("tokens-as-array")),Object.keys(n).forEach(o=>{var i;const a=(t?t+".":"")+o;/^[a-zA-Z_-][a-zA-Z0-9_-]*$/.test(o)||throwError(ErrorCode.InvalidTokenName,a),n[o]||throwError(ErrorCode.InvalidTokenValue,o);try{const t=function(e,r){if("string"!=typeof r&&("object"!=typeof r||!r.value))return;let t={value:{}};return"string"==typeof r?t.value._=r:t=Object.assign({},r),"string"==typeof t.value&&(t.value={_:t.value}),e&&t.value._&&(t.value[e]=t.value._,t.value._=void 0),Object.keys(t.value).forEach(e=>{gThemes.includes(e)||gThemes.push(e)}),t}(null!=(i=r.theme)?i:gConfig.defaultTheme,n[o]);if(t)if(gTokenDefinitions.has(a)){t.type&&gTokenDefinitions.get(a).type&&gTokenDefinitions.get(a).type!==t.type&&throwError(ErrorCode.InconsistentTokenType,t.type,gTokenDefinitions.get(a).type);const e=gTokenDefinitions.get(a);mergeObject(e,t),gTokenDefinitions.set(a,e)}else gTokenDefinitions.set(a,t);else e(r,a,n[o])}catch(e){throw new Error(`${a}: "${n[o]}"\n${e.message}`)}})}(o,"",o.tokens)}catch(e){n.push(e.message)}gConfig.verbose&&0===n.length&&log(terminal.success()+"← "+terminal.path(process.env.TEST?path.basename(e):path.relative("",e))),n.length>0&&error([terminal.error()+terminal.path(process.env.TEST?path.basename(e):path.relative("",e)),...n])}function renderFile$1(e,r){const t=[],n=[];gTokenDefinitions.forEach((e,t)=>{Object.keys(e.value).forEach(e=>{r.themes.includes(e)&&n.push("_"===e?t:t+"."+e)})});const o=function(e,r){if(!r)return;const t=new Map;return e.forEach(e=>{try{t.set(e,r(gTokenValues.get(e)))}catch(r){error([terminal.error(`Error formatting "${gTokenValues.get(e).css()}" for the "${e}" token`),r.message])}}),t}(n,e.valueFormatter);o.forEach((e,r)=>{const t=e.replace(/{[a-zA-Z0-9_-]+}/g,e=>{const r=e.slice(1,-1);return o.has(r)?o.get(r):(error(terminal.error("Unresolved alias. ")+`Cannot find token "${e}"`+getSuggestion(r,o)),e)});t&&o.set(r,t)});const i=[];return r.themes.forEach(n=>{gTokenDefinitions.forEach((a,s)=>{if(void 0===a.value[n])return;const l=e.nameFormatter(s,n);t.includes(l)&&log(l!==s?terminal.warning("Warning: ")+` the "${s}" token has multiple definitions as "${l}"`:terminal.warning("Warning: ")+` the "${s}" token has multiple definitions`),t.push(l);const u=s+("_"===n?"":"."+n);i.push(e.renderProperty(Object.assign(Object.assign({},r),{theme:n,category:"",properties:i,values:o,token:u,definition:a,propertyName:l,propertyValue:o.get(u)})))})}),e.renderFile(Object.assign(Object.assign({},r),{content:e.renderGroup(Object.assign(Object.assign({},r),{category:"",properties:i,values:o}))}))}function build(e,r){var t,n,o,i,a;n=null===(t=r)||void 0===t?void 0:t.watching,gWatching=null!=n&&n,gThemes=[],gTokenDefinitions=new Map,gTokenValues=new Map,gRecursiveEvaluationStack=[],gProcessedFiles=[],e.forEach(e=>{const r=glob.sync(e);0!==r.length?r.forEach(processPath):error(terminal.error("File not found: ")+terminal.path(e))}),gTokenDefinitions.forEach((e,r)=>{Object.keys(e.value).forEach(t=>{const n=r+("_"===t?"":"."+t);let o;try{(o=function e(r,t){if(!t)return;gRecursiveEvaluationStack.includes(r)&&throwError(ErrorCode.CircularDefinition,r),gRecursiveEvaluationStack.push(r);const n=function(e,r={}){const t=new Stream(e,r),n=t.parseExpression();if(t.skipWhiteSpace(),t.isEOF())return n.setSource(e),n}(t,Object.assign(Object.assign({},gConfig),{aliasResolver:t=>{var n,o;if(gTokenValues.has(t))return gTokenValues.get(t);let i;return gTokenDefinitions.has(t)&&(gConfig.defaultTheme&&(i=e(t+"."+gConfig.defaultTheme,null===(n=gTokenDefinitions.get(t))||void 0===n?void 0:n.value[gConfig.defaultTheme])),i||(i=e(t,null===(o=gTokenDefinitions.get(r))||void 0===o?void 0:o.value._))),null!=i?i:getSuggestion(t,gTokenDefinitions)}}));return gRecursiveEvaluationStack.pop(),n}(n,e.value[t]))||(o=new StringValue(e.value[t]))}catch(n){error([terminal.error("Syntax error")+` in "${r+": '"+e.value[t]}'"`,n.message]),o=new StringValue(e.value[t])}gTokenValues.set(n,o);const i=o.type();e.type&&i!=e.type&&log(terminal.warning("Warning:")+` Type mismatch. Expected \`${e.type}\` but got \`${i}\` for "${n}" token`)})});try{const e=function(e){const r={fileHeader:DEFAULT_FILE_HEADER,renderFilename:function({theme:e,basename:r}){return r+(e?"-"+e:"")},renderGroup:e=>e.properties.join("\n"),renderFile:e=>e.content};gConfig.formats[e]||throwError(ErrorCode.UnknownFormat,e,getSuggestion(e,gConfig.formats));const t=gConfig.formats[e].extends;return"string"==typeof t?gConfig.formats[t]?(mergeObject(r,gConfig.formats[t]),mergeObject(r,gConfig.formats[e])):throwError(ErrorCode.UnknownFormat,e,getSuggestion(e,gConfig.formats)):mergeObject(r,gConfig.formats[e]),"string"==typeof r.valueFormatter?gConfig.valueFormatters[r.valueFormatter]||throwError(ErrorCode.UnknownValueFormatter,r.valueFormatter,getSuggestion(r.valueFormatter,gConfig.valueFormatters)):"function"!=typeof r.valueFormatter&&(r.valueFormatter=e=>e.css()),"string"==typeof r.nameFormatter?gConfig.nameFormatters[r.nameFormatter]||throwError(ErrorCode.UnknownNameFormatter,r.nameFormatter,getSuggestion(r.nameFormatter,gConfig.nameFormatters)):"function"!=typeof r.nameFormatter&&(r.nameFormatter=(e,r)=>e+(r&&"_"!==r?"-"+r:"")),"function"!=typeof r.renderProperty&&(gConfig.verbose&&log(terminal.warning("Warning: ")+` the "${e}" format does not have a \`propertyTemplate\` function`),r.renderProperty=e=>`${e.propertyName}${e.theme?"-"+e.theme:""}: ${e.propertyValue}`),r}(gConfig.outputFormat);e.fileHeader=null!=(o=r.header)?o:e.fileHeader;const t=(null===(i=r)||void 0===i?void 0:i.output)&&path.resolve(r.output),n=function(e,r){var t;const n={};if(!function(){var e;return(null===(e=gConfig.themes)||void 0===e?void 0:e.length)>0&&(gThemes=gThemes.filter(e=>gConfig.themes.includes(e))),gThemes.forEach(e=>{let r=0;gTokenDefinitions.forEach((t,n)=>{void 0!==t.value[e]&&(r+=1)}),0===r&&gThemes.splice(gThemes.indexOf(e),1)}),0!==gThemes.length&&0!==gTokenDefinitions.size||(error([terminal.error("No tokens found."),'Token files should have a "tokens" property',terminal.link("../guide")]),!1)}())return;const o=null!=(t=e&&path.parse(e))?t:{name:"tokens"},i={filepath:"",themes:[],header:r.fileHeader,definitions:gTokenDefinitions,rawValues:gTokenValues,content:""};return gConfig.splitOutput?gThemes.forEach(e=>{i.filepath=path.format({dir:o.dir,name:r.renderFilename({theme:e,basename:o.name}),ext:r.ext}),i.themes=[e],n[i.filepath]=renderFile$1(r,i)}):(i.filepath=path.format({dir:o.dir,name:r.renderFilename({theme:"",basename:o.name}),ext:r.ext}),i.themes=gThemes,n[i.filepath]=renderFile$1(r,i)),n}(t,e);if(n&&!(null===(a=r)||void 0===a?void 0:a.dryRun)){if(!t)return n;if(gConfig.verbose){let e="";1===gThemes.length&&"_"===gThemes[0]||(e=1===gThemes.length?`for theme "${gThemes[0]}"`:"for themes "+gThemes.map(e=>'"'+e+'"').join(", ")),log(`    Writing ${terminal.string(gConfig.outputFormat)} format ${e}`)}Object.keys(n).forEach(e=>{!function(e,r){const t=path.dirname(r);fs$1.existsSync(t)||fs$1.mkdirsSync(t),fs$1.writeFileSync(r,e),(gConfig.verbose||gWatching)&&log(terminal.success()+(gWatching?terminal.time()+" ":"")+"→ "+terminal.path(path.relative("",r)))}(n[e],e)})}}catch(e){error(terminal.error(e.message))}return{}}function chromatic(e,r){var t,n,o,i,a,s,l,u,c,h,m,g,p,d,f,v,y,b,C,k,w,E,x,T,F,N,S,O;"string"==typeof e&&(e=[e]);let U=configParser.search();null==(n=null===(t=U)||void 0===t?void 0:t.isEmpty)||n||mergeObject(gConfig,U.config),(null===(o=r)||void 0===o?void 0:o.config)&&(null==(a=null===(i=U=configParser.load(r.config))||void 0===i?void 0:i.isEmpty)||a||mergeObject(gConfig,U.config)),(null===(s=r)||void 0===s?void 0:s.themes)&&("string"==typeof r.themes?gConfig.themes=r.themes.split(",").map(e=>e.trim()):Array.isArray(r.themes)&&(gConfig.themes=[...r.themes])),u=null===(l=r)||void 0===l?void 0:l.ignoreErrors,gIgnoreErrors=null!=u&&u;const j=[];if("string"==typeof(null===(c=r)||void 0===c?void 0:c.console)?"log"===(null===(h=r)||void 0===h?void 0:h.console)&&(terminal.useColor(!1),gConfig.console={log:e=>{j.push(e)},error:e=>{j.push(e)}}):gConfig.console=null!=(g=null===(m=r)||void 0===m?void 0:m.console)?g:{log:e=>console.error(e),error:e=>console.error(e)},gConfig.themes||(gConfig.themes=[]),gConfig.tokenFileExt=null!=(v=null!=(d=null===(p=r)||void 0===p?void 0:p.tokenFileExt)?d:null===(f=gConfig)||void 0===f?void 0:f.tokenFileExt)?v:"yaml",gConfig.verbose=null!=(k=null!=(b=null===(y=r)||void 0===y?void 0:y.verbose)?b:null===(C=gConfig)||void 0===C?void 0:C.verbose)&&k,gConfig.splitOutput=r.splitOutput,gConfig.outputFormat=null!=(T=null!=(E=null===(w=r)||void 0===w?void 0:w.format)?E:null===(x=gConfig)||void 0===x?void 0:x.outputFormat)?T:"",!gConfig.outputFormat){const e=(null===(F=r)||void 0===F?void 0:F.output)&&path.extname(null===(N=r)||void 0===N?void 0:N.output);if(e){const r=Object.keys(gConfig.formats).filter(r=>gConfig.formats[r].ext===e);1===r.length?gConfig.outputFormat=r[0]:gConfig.formats[e.slice(1)]?gConfig.outputFormat=e.slice(1):r.length>1&&error([terminal.error("Ambiguous format. ")+`Use ${terminal.keyword("--format")} to indicate which output format to use.`,`Did you mean \`${r.join(", ")}\`?`])}gConfig.outputFormat?gConfig.verbose&&log(terminal.warning()+'Setting the format to "gConfig.outputFormat" based on the output file extension. Use `--format` to indicate which output format to use.'):(gConfig.outputFormat="yaml",log(terminal.warning("Format not specified.")+` Using "${terminal.keyword("yaml")}". `+`Use ${terminal.keyword("--format")} to indicate which output format to use.`))}mergeObject(gConfig.nameFormatters,null===(S=r)||void 0===S?void 0:S.nameFormatters),mergeObject(gConfig.valueFormatters,null===(O=r)||void 0===O?void 0:O.valueFormatters);const $=build(e,r);return j.length>0&&($.stderr=j.join("\n")),$}mergeObject(gConfig,DefaultFormatters),mergeObject(gConfig,WebFormats),mergeObject(gConfig,{formats:{yaml:{ext:".yaml",renderFile:e=>(e.header?"# "+e.header.split("\n").join("\n# "):"")+"\ntokens:\n"+e.content,renderGroup:e=>"\t"+e.properties.join("\n\t"),renderProperty:e=>`${e.definition.comment?"# "+e.definition.comment+"\n\t":""}${e.propertyName}: "${e.propertyValue.replace(/"/g,'\\"')}"`},json:{ext:".json",renderFile:e=>e.content,renderGroup:e=>"{\n\t"+e.properties.join(",\n\t")+"\n}",renderProperty:e=>`"${e.propertyName}": "${e.propertyValue}"`}}}),mergeObject(gConfig,StyleGuideFormat),module.exports=chromatic;const fs$2=require("fs-extra"),path$1=require("path"),chokidar=require("chokidar");function logResult(e){console.log(Object.keys(e).map(r=>("stderr"===r?terminal.error():terminal.success())+">>>> "+terminal.path(r)+"\n"+e[r]).join("\n"))}require("yargs").usage("Usage: $0 file(s) [options]").example("$0 ./assets/tokens.yaml -o ./build/tokens.scss","Generate a Sass file from a design tokens YAML file").command(["* <paths..>","build <paths..>"],"Build output files",(function(e){e.positional("<path>",{describe:"Path to a token file or directory",type:"string"}).option("output",{alias:"o",describe:"Save output to path",type:"path"}).normalize("output").option("format",{alias:"f",describe:"Output format: css|sass|js|yaml|json",type:"string"}).option("header",{describe:"Content inserted at the to of the output file",type:"string"}).option("themes",{describe:"Comma separated list of themes to process",type:"string"}).option("split-output",{describe:"If there are multiple themes, output one file per theme. Otherwise the themes are combined in a single file.",type:"boolean",default:!1}).option("token-file-ext",{describe:"Default file extension of token files",type:"string",default:".yaml"}).option("dry-run",{describe:"Validate the token files, attempt to generate the specified file format, but don't output anything",conflicts:"output",type:"boolean"}).option("config",{describe:"Load config file from path",type:"path"}).normalize("config").option("verbose",{describe:"Display additional information during processing",type:"boolean"}).option("no-color",{describe:"Suppress color output in terminal",type:"boolean"}).option("ignore-errors",{alias:"i",describe:"Attempt to continue when an error is encountered",type:"boolean"}).option("watch",{describe:"Watch for changes to the token files and rebuild",type:"boolean"})}),(function(e){if(void 0===process.stdin.isTTY||process.stdin.isTTY)(!e.paths||e.paths.length<1)&&(console.error(terminal.error()+"Expected at least one path to a directory or token file.\n"+`    Use ${terminal.keyword(e.$0+" help")} for available options.\n`,`   Use ${terminal.keyword(e.$0+" example")} to create an example directory.`),process.exit(1)),e.watch?chokidar.watch(e.paths).on("all",(r,t)=>{chromatic(e.paths,Object.assign(Object.assign({},e),{watching:!0})),console.log(terminal.time()+` ${terminal.dim(e.$0)}: Waiting for changes...\n${terminal.dim("Press Ctrl-C to exit.")}`)}):logResult(chromatic(e.paths,e));else{process.stdin.setEncoding("utf-8");let r="";process.stdin.on("readable",(function(){let e;for(;e=process.stdin.read();)r+=e})),process.stdin.on("end",(function(){logResult(chromatic(r,e))}))}})).command("example [example-directory]","Create example directory",e=>{e.positional("example-directory",{describe:"Example output directory",type:"string"})},(function(e){var r;const t=path$1.resolve(null!=(r=e["example-directory"])?r:"chromatic-example");console.log("Creating an example in "+path$1.relative("",t));try{fs$2.copySync("examples/basic",t,{overwrite:!1,errorOnExist:!0}),console.log("Now, try the example:\n    "+terminal.keyword(e.$0+" "+path$1.relative("",t)+" -o ./build/tokens.scss")+"\nor:\n    "+terminal.keyword(e.$0+" "+path$1.relative("",t)+" -o ./build/tokens.html"))}catch(e){console.log(e.message)}})).command("help","Show help",()=>{},e=>e.help()).help("h").alias("h","help").epilog("For more information, see https://github.com/arnog/chromatic/docs/guide.md").strict(!0).argv;

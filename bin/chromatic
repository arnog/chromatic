#!/usr/bin/env node
var e;!function(e){e[e.NoError=0]="NoError",e[e.SyntaxError=1]="SyntaxError",e[e.UnexpectedOpenBracket=2]="UnexpectedOpenBracket",e[e.ExpectedCloseBracket=3]="ExpectedCloseBracket",e[e.ExpectedCloseCurlyBracket=4]="ExpectedCloseCurlyBracket",e[e.ExpectedOpenParen=5]="ExpectedOpenParen",e[e.ExpectedCloseParen=6]="ExpectedCloseParen",e[e.ExpectedQuote=7]="ExpectedQuote",e[e.UnknownToken=8]="UnknownToken",e[e.UnknownUnit=9]="UnknownUnit",e[e.UnknownFunction=10]="UnknownFunction",e[e.MissingArgument=11]="MissingArgument",e[e.ExpectedArgument=12]="ExpectedArgument",e[e.TooManyArguments=13]="TooManyArguments",e[e.InvalidArgument=14]="InvalidArgument",e[e.ExpectedOperand=15]="ExpectedOperand",e[e.InvalidOperand=16]="InvalidOperand",e[e.InvalidUnaryOperand=17]="InvalidUnaryOperand",e[e.ExpectedIntegerIndex=18]="ExpectedIntegerIndex",e[e.CircularDefinition=19]="CircularDefinition",e[e.UnexpectedTokensArray=20]="UnexpectedTokensArray",e[e.UnexpectedTokensType=21]="UnexpectedTokensType",e[e.InvalidTokenName=22]="InvalidTokenName",e[e.InvalidTokenValue=23]="InvalidTokenValue",e[e.InconsistentTokenType=24]="InconsistentTokenType",e[e.UnknownFormat=25]="UnknownFormat",e[e.UnknownValueFormatter=26]="UnknownValueFormatter",e[e.UnknownNameFormatter=27]="UnknownNameFormatter"}(e||(e={}));const t={[e.SyntaxError]:"Syntax error",[e.UnexpectedOpenBracket]:"Unexpected `[`",[e.ExpectedCloseBracket]:"Expected `]`",[e.ExpectedCloseCurlyBracket]:"Expected `}`",[e.ExpectedOpenParen]:"Expected `(`",[e.ExpectedCloseParen]:"Expected `)`",[e.ExpectedQuote]:'Expected `"`',[e.UnknownToken]:"Unknown token `%1`%2",[e.UnknownUnit]:"Unknown unit `%1`",[e.UnknownFunction]:"Unknown function `%1`%2",[e.MissingArgument]:"Missing argument %1 of `%2` of type `%3`",[e.ExpectedArgument]:"Expected argument %1 of `%2` to be of type `%3`",[e.TooManyArguments]:"Too many arguments for function `%1(%2)`",[e.InvalidArgument]:"Invalid argument `%2` for function `%1`%3",[e.ExpectedOperand]:"Expected operand",[e.InvalidOperand]:"Invalid operand",[e.InvalidUnaryOperand]:"Invalid operand",[e.CircularDefinition]:'Circular definition of the "%1" token',[e.UnexpectedTokensArray]:'The "tokens" property is an array. It should be a key/value map of tokens.\n%1',[e.UnexpectedTokensType]:'The "tokens" property should be a key/value map of tokens.',[e.InvalidTokenName]:'Invalid token name "%1": it must only contain digits, letters, "_" and "-"',[e.InvalidTokenValue]:'The "%1" token is invalid. If using a YAML file, make sure RGB hex values are within quotes',[e.InconsistentTokenType]:'Inconsistent token type in valus of token "%1"',[e.UnknownFormat]:'Unknown format "%1"%2',[e.UnknownValueFormatter]:'Unknown value formatter "%1"%2',[e.UnknownNameFormatter]:'Unknown name formatter "%1"%2',[e.ExpectedIntegerIndex]:"Expected array index to be a number"};class n extends Error{constructor(e,...n){super(t[e]),this.code=e,this.args=n}}function r(e,t,...n){e&&s(void 0,t,...n)}function a(e,...t){s(void 0,e,...t)}function s(n,r,...a){var s;let o="";throw process.env.TEST?o="[ERR] "+(null!=(s=e[r])?s:r):(n&&(o=n.join("\n")+"\n"),o+=t[r],a.forEach((e,t)=>{o=o.replace(new RegExp(`%${t+1}`,"g"),e)})),new Error(o)}const o=require("string-similarity");function i(e,t){const n=function(e,t){if(!e||!t)return"";let n;if(n=t instanceof Map?Array.from(t.keys()):Array.isArray(t)?t:Object.keys(t),0===n.length)return"";const r=o.findBestMatch(e,n);return r.bestMatch.rating>.1?r.bestMatch.target:""}(e,t);return n?`. Did you mean "${n}"?`:""}const l={nameFormatters:{camelcase:(e,t)=>(e+!t?"":"."+t).toLowerCase().replace(/(?:^\w|[A-Z]|\b\w)/g,(e,t)=>0===t?e.toLowerCase():e.toUpperCase()).replace(/\s+/g,""),kebabcase:(e,t)=>(e+!t?"":"."+t).match(/[A-Z]{2,}(?=[A-Z][a-z0-9]*|\b)|[A-Z]?[a-z0-9]*|[A-Z]|[0-9]+/g).filter(Boolean).map(e=>e.toLowerCase()).join("-"),uppercase:(e,t)=>(e+!t?"":"."+t).toUpperCase(),lowercase:(e,t)=>(e+!t?"":"."+t).toLowerCase()},handlebarsHelpers:{uppercase:e=>e.toUpperCase(),sanitizeCssPropertyName:e=>e.replace(/[^a-zA-Z0-9_-]/g,"-"),cssValue:e=>{var t,n;return null!=(n=null===(t=e)||void 0===t?void 0:t.css())?n:"[MISSING VALUE]"},"remove-last-comma":function(e){const t=e.fn(this).split("\n"),n=t.reduce((e,t,n)=>/,$/.test(t)?n:e,-1);return t.map((e,t)=>t!==n?e:e.slice(0,-1)).join("\n")},comment:function(e,t="/* */"){var n,r;if("string"!=typeof e)return this.comment;if(!e)return"";"string"!=typeof t&&(t="/* */");const a=null!=(r=null===(n=t.match(/(\s*)/))||void 0===n?void 0:n[1])?r:"",s=t.slice(a.length);let[o,i]=s.split(" ");return"/*"===o&&"*/"===i?a+"/* "+e.split("\n").join("\n"+a+" * ")+"\n"+a+" */":(i||(o=t.slice(a.length),i=""),a+o+e.split("\n").join((null!=i?i:"")+"\n"+a+o))}}},u=`\nThis file was automatically generated by Chromatic.\nDo not edit.\nGenerated ${(new Date).toISOString()}\n`,c=require("color-name");function h(e){return e<0?0:e>255?255:Math.round(e)}class p{constructor(){this.source=""}css(){return""}type(){}canonicalScalar(){return 0}getSource(){return this.source}setSource(e){this.source=e}equals(e){return this.type()===e.type()&&this.canonicalScalar()==e.canonicalScalar()}}function d(e,t){return Math.round(e*Math.pow(10,t)+1e-14)/Math.pow(10,t)}class m extends p{constructor(e){super(),this.value=e}css(){return d(this.value,2)+"%"}type(){return"percentage"}canonicalScalar(){return this.value/100}equals(e){if(A(e)){const t=W(this),n=W(e);return[...Object.keys(t.value),...Object.keys(n.value)].every(e=>t.value[e]===n.value[e])}return!1}}class f extends p{constructor(e,t){super(),this.value=e,this.unit=t}css(){return d(this.value,2)+this.unit}type(){return"angle"}canonicalScalar(){return V(this)}}class v extends p{constructor(e,t){if(super(),"number"==typeof e)this.value=e,this.unit=0===e?"px":t;else if(void 0===t){const t=Object.keys(e).filter(t=>"number"==typeof e[t]&&0!==e[t]);0===t.length?(this.value=0,this.unit="px"):1===t.length?(this.value=e[t[0]],this.unit=t[0]):(this.value=e,this.unit="multi")}else this.value=e,this.unit="multi",console.assert("multi"===t)}css(){if("number"==typeof this.value)return 0===this.value||isNaN(this.value)?Number(this.value).toString():d(this.value,2)+this.unit;const e={};let t=Object.keys(this.value);if(t.length>1){let n=0;t.forEach(t=>{const r=D(this.value[t],t);isNaN(r)?"px"!==t&&(e[t]=this.value[t]):n+=r}),0!==n&&(e.px=n)}else e[t[0]]=this.value[t[0]];return t=Object.keys(e),1===t.length?"px"===t[0]&&0===e.px?"0":d(e[t[0]],2)+t[0]:"calc("+t.map(t=>Number(e[t]).toString()+t).join(" + ")+")"}type(){return"length"}canonicalScalar(){return"multi"===this.unit?NaN:D(this.value,this.unit)}}class g extends p{constructor(e,t){super(),this.value=e,this.unit=t}css(){return d(this.value,2)+this.unit}type(){return"time"}canonicalScalar(){return"ms"===this.unit?this.value/1e3:this.value}}class b extends p{constructor(e,t){super(),this.value=e,this.unit=t}css(){return d(this.value,2)+this.unit}type(){return"frequency"}canonicalScalar(){return"khz"===this.unit?1e3*this.value:this.value}}class y extends p{constructor(e){super(),this.value=e}css(){return Number(this.value).toString()}type(){return"number"}canonicalScalar(){return this.value}}class w extends p{constructor(e){super(),this.value=e}css(e=""){return e+this.value+e}type(){return"string"}canonicalScalar(){return parseFloat(this.value)}equals(e){return C(e)&&this.value===e.value}}class x extends p{constructor(e){super(),this.value=e.map(e=>I(e))}get(e){return this.value[e]}type(){return"array"}css(){return"["+this.value.map(e=>e.css()).join(", ")+"]"}equals(e){return _(e)&&this.value.length===e.value.length&&this.value.every((t,n)=>t===e.value[n])}}function k(e,t,n){return n<0&&(n+=6),n>=6&&(n-=6),n<1?(t-e)*n+e:n<3?t:n<4?(t-e)*(4-n)+e:e}function E(e,t,n){e=(e+360)%360/60,n=Math.max(0,Math.min(n,1)),t=Math.max(0,Math.min(t,1));const r=n<=.5?n*(t+1):n+t-n*t,a=2*n-r;return{r:Math.round(255*k(a,r,e+2)),g:Math.round(255*k(a,r,e)),b:Math.round(255*k(a,r,e-2))}}function M(e,t,n){e/=255,t/=255,n/=255;const r=Math.min(e,t,n),a=Math.max(e,t,n),s=a-r;let o,i;a===r?o=0:e===a?o=(t-n)/s:t===a?o=2+(n-e)/s:n===a&&(o=4+(e-t)/s),o=Math.min(60*o,360),o<0&&(o+=360);const l=(r+a)/2;return i=a===r?0:l<=.5?s/(a+r):s/(2-a-r),{h:o,s:i,l:l}}class O extends p{constructor(e){if(super(),"string"==typeof e)if("transparent"===e.toLowerCase())[this.r,this.g,this.b,this.a]=[0,0,0,0],[this.h,this.s,this.l]=[0,0,0];else{const t=function(e){if(!e)return;if("#"!==e[0])return;let t;return(e=e.slice(1)).length<=4?(t={r:parseInt(e[0]+e[0],16),g:parseInt(e[1]+e[1],16),b:parseInt(e[2]+e[2],16)},4===e.length&&(t.a=parseInt(e[3]+e[3],16)/255)):(t={r:parseInt(e[0]+e[1],16),g:parseInt(e[2]+e[3],16),b:parseInt(e[4]+e[5],16)},8===e.length&&(t.a=parseInt(e[6]+e[7],16)/255)),t&&void 0===t.a&&(t.a=1),t}(e)||function(e){const t=c[e.toLowerCase()];if(t)return{r:t[0],g:t[1],b:t[2],a:1}}(e);if(!t)throw new Error;Object.assign(this,t),Object.assign(this,M(this.r,this.g,this.b))}else Object.assign(this,e),"number"==typeof this.r?Object.assign(this,M(this.r,this.g,this.b)):(console.assert("number"==typeof this.h),this.h=(this.h+360)%360,this.s=Math.max(0,Math.min(1,this.s)),this.l=Math.max(0,Math.min(1,this.l)),Object.assign(this,E(this.h,this.s,this.l)));"number"!=typeof this.a&&(this.a=1)}type(){return"color"}opaque(){return new O({r:this.r,g:this.g,b:this.b})}luma(){let e=this.r/255,t=this.g/255,n=this.b/255;return e=e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4),t=t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4),n=n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4),.2126*e+.7152*t+.0722*n}hex(){let e=((1<<24)+(h(this.r)<<16)+(h(this.g)<<8)+h(this.b)).toString(16).slice(1);return this.a<1&&(e+=("00"+Math.round(255*this.a).toString(16)).slice(-2)),e[0]===e[1]&&e[2]===e[3]&&e[4]===e[5]&&e[6]===e[7]&&(e=e[0]+e[2]+e[4]+(this.a<1?e[6]:"")),"#"+e}rgb(){return`rgb(${d(this.r,2)}, ${d(this.g,2)}, ${d(this.b,2)}${this.a<1?", "+d(100*this.a,2)+"%":""})`}hsl(){return`hsl(${this.h}deg, ${this.s}%, ${this.l}%, ${this.a<1?", "+d(100*this.a,2)+"%":""})`}css(){return 0===this.r&&0===this.g&&0===this.b&&0===this.a?"transparent":this.a<1?this.rgb():this.hex()}canonicalScalar(){return this.luma()}equals(e){return T(e)&&this.r===e.r&&this.g===e.g&&this.b===e.b&&this.a===e.a}}function I(e){switch(e.type()){case"color":return new O(e);case"frequency":return new b(e.value,e.unit);case"time":return new g(e.value,e.unit);case"angle":return new f(e.value,e.unit);case"string":return new w(e.value);case"length":return new v(e.value,e.unit);case"percentage":return new m(e.value);case"number":return new y(e.value);case"array":return new x(e.value.map(I));default:console.error("Unknown value type")}}function T(e){return e instanceof O}function S(e){if(!e)return;let t;try{t=new O(e)}catch(e){t=void 0}return t}function j(e){return e instanceof y}function U(e){console.assert(e instanceof y)}function F(e){return e instanceof m}function A(e){return e instanceof v}function C(e){return e instanceof w}function N(e){return e instanceof f}function q(e){return e instanceof g}function $(e){return e instanceof b}function _(e){return e instanceof x}function L(e){return e instanceof y&&0===e.value}function z(e,t){return j(e)?Math.round(e.value):(void 0===t&&U(e),t)}function P(e,t){return F(e)?e.value/100:j(e)?e.value:(void 0===t&&(n=e,console.assert(n instanceof y||n instanceof m)),t);var n}function V(t){return N(t)?"deg"===t.unit?t.value:"rad"===t.unit?180*t.value/Math.PI:"grad"===t.unit?180*t.value/200:"turn"===t.unit?360*t.value:void a(e.UnknownUnit,t.unit):(U(t),t.value)}function D(e,t,n){var r,a,s,o,i,l,u,c,h,p,d;if("number"!=typeof e){console.assert("multi"===t);let a=null!=(r=e.px)?r:0;return Object.keys(e).forEach(e=>{const t=D(this.value[e],e,n);if(isNaN(t))return NaN;a+=a}),a}if("px"===t)return e;if("cm"===t)return 96*e/2.54;if("mm"===t)return 96*e/25.4;if("Q"===t)return 96*e/2.54/40;if("in"===t)return 96*e;if("pc"===t)return 16*e;if("pt"===t)return 96*e/72;let m;return m="vmin"===t?Math.min(null!=(s=null===(a=n)||void 0===a?void 0:a.vh)?s:NaN,null!=(i=null===(o=n)||void 0===o?void 0:o.vw)?i:NaN):"vmax"===t?Math.max(null!=(u=null===(l=n)||void 0===l?void 0:l.vh)?u:NaN,null!=(h=null===(c=n)||void 0===c?void 0:c.vw)?h:NaN):null!=(d=null===(p=n)||void 0===p?void 0:p[t])?d:NaN,m*e}function B(e){return F(e)?e.value/100:(U(e),e.value)}function H(e,t){return C(e)?e.value:t}function Z(e,t){return t.canonicalScalar()-e.canonicalScalar()}function W(e){if(j(e))return new v({px:e.value},"multi");if("multi"===e.unit)return e;const t={};return t[e.unit]=e.value,new v(t,"multi")}function R(t,r){if("multi"===t.unit)throw new n(e.InvalidOperand);const a=H(r,"pentatonic").toLowerCase();let s={tritonic:[2,3],tetratonic:[2,4],pentatonic:[2,5],golden:[1.618,1],"golden ditonic":[1.618,2]}[a];if(void 0===s){if(s=a.split(":").map(e=>parseFloat(e)),isNaN(s[0])||isNaN(s[1]))throw new n(e.InvalidOperand);s=[s[1]/s[0],1]}const[o,i]=s,l=t.value*(Math.pow(o,7/i)-Math.pow(o,-2/i))<10||t.value*Math.pow(o,-2/i)<1?2:0,u=[-2,-1,0,1,2,3,4,5,6,7].map(e=>new v(d(t.value*Math.pow(o,e/i),l),t.unit));return new x(u)}var G;const Q=require("chalk"),Y=require("ci-info");let J=null!=(G=process.stdout.isTTY)&&G&&!Y.isCI;const K={useColor:e=>{J=e},autoFormat:e=>e.replace(/("(.*)")/g,e=>K.string(e.slice(1,-1))).replace(/(`(.*)`)/g,e=>K.keyword(e)),success:(e="")=>(Q.green("✔︎   "+e),J?Q.bold.green("✔︎   "+e):"✔︎   "+e),error:(e="")=>J?Q.hex("#fa2040")(Q.bold("✘   "+e)):"✘   "+e,warning:(e="")=>J?Q.hex("#ffcc00")(Q.bold("⚠️   "+e)):"⚠   "+e,path:(e="")=>J?Q.hex("#6ab3ff").italic(e):e,keyword:(e="")=>J?Q.hex("#ffcc00")(e):e,string:(e="")=>J?Q.hex("#ffcc00")('"'+Q.italic(e)+'"'):'"'+e+'"',dim:(e="")=>J?Q.hex("#999")(e):e,time:(e=new Date)=>J?Q.hex("#d1d7ff")(`[${e.toLocaleTimeString()}]`):"["+e+"]",link:e=>J?"\n▷   "+Q.hex("#d1d7ff")("https://github.com/arnog/chromatic/docs/errors/"+e+".md"):"\n▷   https://github.com/arnog/chromatic/docs/errors/"+e+".md"},X=require("chroma-js");function ee(e){return e<0?0:e>1?1:e}function te(e){return F(e)?Math.round(255*e.value/100):(U(e),Math.round(e.value))}function ne(e,t,n){let r=((e=Math.max(0,Math.min(100,e)))+16)/116,a=(t=Math.max(-128,Math.min(128,t)))/500+r,s=r-(n=Math.max(-128,Math.min(128,n)))/200;a=.95047*(a*a*a>.008856?a*a*a:(a-16/116)/7.787),r=1*(r*r*r>.008856?r*r*r:(r-16/116)/7.787),s=1.08883*(s*s*s>.008856?s*s*s:(s-16/116)/7.787);let o=3.2406*a+-1.5372*r+-.4986*s,i=-.9689*a+1.8758*r+.0415*s,l=.0557*a+-.204*r+1.057*s;return o=o>.0031308?1.055*Math.pow(o,1/2.4)-.055:12.92*o,i=i>.0031308?1.055*Math.pow(i,1/2.4)-.055:12.92*i,l=l>.0031308?1.055*Math.pow(l,1/2.4)-.055:12.92*l,{r:h(255*o),g:h(255*i),b:h(255*l)}}function re(e,t,n){e=h(e)/255,t=h(t)/255,n=h(n)/255;let r=(.4124*(e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92)+.3576*(t=t>.04045?Math.pow((t+.055)/1.055,2.4):t/12.92)+.1805*(n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92))/.95047,a=(.2126*e+.7152*t+.0722*n)/1,s=(.0193*e+.1192*t+.9505*n)/1.08883;return r=r>.008856?Math.pow(r,1/3):7.787*r+16/116,a=a>.008856?Math.pow(a,1/3):7.787*a+16/116,s=s>.008856?Math.pow(s,1/3):7.787*s+16/116,{L:116*a-16,a:500*(r-a),b:200*(a-s)}}function ae(e,t,n){return{r:3.063218*e-1.393325*t-.475802*n,g:-.969243*e+1.875966*t+.041555*n,b:.067871*e-.228834*t+1.069251*n}}const se={protanopia:{cpu:.735,cpv:.265,am:1.273463,ayi:-.073894},deuteranopia:{cpu:1.14,cpv:-.14,am:.968437,ayi:.003331},tritanopia:{cpu:.171,cpv:-.003,am:.062921,ayi:.292119}},oe=new O("#fff"),ie=new O("#000");function le(e,t,n,r){const a=H(r,"hsl").toLowerCase(),s=S(e);if(!s)return;const o=S(t);if(!o)return s;const i=P(n,.5);let l="number"==typeof o.a?o.a:1;return l+=(("number"==typeof s.a?o.a:1)-l)*i,"rgb"===a?new O({r:s.r+(o.r-s.r)*i,g:s.g+(o.g-s.g)*i,b:s.b+(o.b-s.b)*i,a:l}):"hsl"===a?new O({h:s.h+(o.h-s.h)*i,s:s.s+(o.s-s.s)*i,l:s.l+(o.l-s.l)*i,a:l}):void 0}function ue(e,t){if(0===e&&0===t)return 0;const n=180*Math.atan2(e,t)/Math.PI;return n>=0?n:n+360}function ce(e,t){const n=re(e.r,e.g,e.b),r=re(t.r,t.g,t.b),a=r.L-n.L,s=(n.L+r.L)/2,o=Math.sqrt(n.a*n.a+n.b*n.b),i=Math.sqrt(r.a*r.a+r.b*r.b),l=(o+i)/2,u=1-Math.sqrt(Math.pow(l,7)/(Math.pow(l,7)+Math.pow(25,7))),c=n.a+n.a/2*u,h=r.a+r.a/2*u,p=Math.sqrt(c*c+n.b*n.b),d=Math.sqrt(h*h+r.b*r.b),m=(p+d)/2,f=d-p,v=Math.pow(s-50,2),g=1+.015*v/Math.sqrt(20+v),b=1+.045*m,y=ue(n.b,c),w=ue(r.b,h),x=0===o||0===i?0:Math.abs(y-w)<=180?w-y:w<=y?w-y+360:w-y-360,k=2*Math.sqrt(p*d)*Math.sin(x*Math.PI/180/2),E=Math.abs(y-w)>180?(y+w+360)/2:(y+w)/2,M=1+.015*m*(1-.17*Math.cos(Math.PI/180*(E-30))+.24*Math.cos(Math.PI/180*(2*E))+.32*Math.cos(Math.PI/180*(3*E+6))-.2*Math.cos(Math.PI/180*(4*E-63))),O=-2*Math.sqrt(Math.pow(m,7)/(Math.pow(m,7)+Math.pow(25,7)))*Math.sin(Math.PI/180*(60*Math.exp(-Math.pow((E-275)/25,2)))),I=a/(1*g),T=f/(1*b),S=k/(1*M);return Math.sqrt(I*I+T*T+S*S+O*T*S)}function he(e,t){switch(t){case"none":return e;case"grayscale":const s=re(e.r,e.g,e.b);return new O(Object.assign({a:e.a},ne(s.L,0,0)));case"protanopia":case"deuteranopia":case"tritanopia":{const s=2.2,{x:o,y:i,z:l}={x:.430574*(n=Math.pow(e.r/255,s))+.34155*(r=Math.pow(e.g/255,s))+.178325*(a=Math.pow(e.b/255,s)),y:.222015*n+.706655*r+.07133*a,z:.020183*n+.129553*r+.93918*a},u=o+i+l!=0?o/(o+i+l):0,c=o+i+l!=0?i/(o+i+l):0,h=.312713*i/.329016,p=.358271*i/.329016;let d;d=u<se[t].cpu?(se[t].cpv-c)/(se[t].cpu-u):(c-se[t].cpv)/(u-se[t].cpu);const m=c-u*d,f=(se[t].ayi-m)/(d-se[t].am),v=d*f+m,g=f*i/v,b=(1-(f+v))*i/v,y=h-g,w=p-b,{r:x,g:k,b:E}=ae(y,0,w);let{r:M,g:I,b:T}=ae(g,i,b);const S=M?((M<0?0:1)-M)/x:0,j=I?((I<0?0:1)-I)/k:0,U=T?((T<0?0:1)-T)/E:0,F=Math.max(S>1||S<0?0:S,j>1||j<0?0:j,U>1||U<0?0:U);return M+=F*x,I+=F*k,T+=F*E,new O({r:255*Math.pow(ee(M),1/s),g:255*Math.pow(ee(I),1/s),b:255*Math.pow(ee(T),1/s)})}}var n,r,a}function pe(e,t,n){const r=[],a=he(e,n);return t.forEach(t=>{if(!e.equals(t.color)){const s=n?ce(a,he(t.color,n))/3:ce(e,t.color);s<2&&r.push({name:t.name,color:t.color,deltaE:s})}}),0===r.length?null:r.sort((e,t)=>e.deltaE-t.deltaE)}function de(e,t,n,r){var a,s;let o,i=new O("#fff"),l=new O("#000"),u=10;if("color"===(null===(a=n)||void 0===a?void 0:a.type()))i=S(e),o=S(t),l=S(n),u=z(r,10);else if("color"===(null===(s=t)||void 0===s?void 0:s.type()))i=S(e),o=S(t),l=S(t),u=z(n,10);else if("color"===e.type()){o=S(e),l=new O({h:o.h-20*Math.sin(4*Math.PI*(o.h/360)),s:o.s+.2*Math.sin(2*Math.PI*(o.h/360)),l:o.h>=180?o.l-.35:o.l-.2+.1*Math.sin(4*Math.PI*(o.h/360))}),u=z(t,10);const n=new w("rgb");return new x([le(i,o,new y(.12),n),le(i,o,new y(.3),n),le(i,o,new y(.5),n),le(i,o,new y(.7),n),le(i,o,new y(.85),n),o,le(l,o,new y(.85),n),le(l,o,new y(.7),n),le(l,o,new y(.5),n),le(l,o,new y(.2),n)])}if(!i||!o||!l)return;const c=X.scale([i.opaque().hex(),o.opaque().hex(),l.opaque().hex()]).mode("lab").correctLightness().colors(u+1);return new x(c.map(e=>new O(e)))}const me=["rgb","rgba","hsl","hsla","hwb","gray","lab"],fe={rgb:(e,t,n,r)=>new O({r:te(e),g:te(t),b:te(n),a:P(r,1)}),hsl:(e,t,n,r)=>new O({h:V(e),s:B(t),l:B(n),a:P(r,1)}),hsv:(e,t,n,r)=>{let a=B(t);const s=B(n),o=(2-a)*s/2;return 0!=o&&(a=1==o?0:o<.5?a*s/(2*o):a*s/(2-2*o)),new O({h:V(e),s:a,l:o,a:P(r,1)})},hwb:(e,t,n,r)=>new O(Object.assign({a:P(r,1)},function(e,t,n){const r=E(e,1,.5),a=[];a[0]=r.r/255,a[1]=r.g/255,a[2]=r.b/255;const s=t+n;s>1&&(t=Number((t/s).toFixed(2)),n=Number((n/s).toFixed(2)));for(let e=0;e<3;e++)a[e]*=1-t-n,a[e]+=t,a[e]=Number(255*a[e]);return{r:a[0],g:a[1],b:a[2]}}(V(e),B(t),B(n)))),lab:(e,t,n,r)=>new O(Object.assign({a:P(r,1)},ne(100*B(e),P(t),P(n)))),gray:(e,t)=>new O(Object.assign({a:P(t,1)},ne(100*B(e),0,0))),filter:(t,n)=>{const r=H(n,"none").toLowerCase(),s=he(t,H(n,"none").toLowerCase());return s||a(e.InvalidArgument,"filter()",`"${r}"`,i(r,["none","grayscale","protanopia","deuteranopia","tritanopia"])),s},mix:(t,n,r,s)=>{const o=H(s,"hsl").toLowerCase(),l=S(t);if(!l)return;const u=S(n);if(!u)return l;const c=P(r,.5);let h="number"==typeof u.a?u.a:1;if(h+=(("number"==typeof l.a?u.a:1)-h)*c,"rgb"===o)return new O({r:l.r+(u.r-l.r)*c,g:l.g+(u.g-l.g)*c,b:l.b+(u.b-l.b)*c,a:h});if("hsl"===o)return new O({h:l.h+(u.h-l.h)*c,s:l.s+(u.s-l.s)*c,l:l.l+(u.l-l.l)*c,a:h});if("lab"===o){const{L:e,a:t,b:n}=re(l.r,l.g,l.b),{L:r,a:a,b:s}=re(u.r,u.g,u.b);return new O(Object.assign(Object.assign({},ne(e+(r-e)*c,t+(a-t)*c,n+(s-n)*c)),{alpha:h}))}a(e.InvalidArgument,"mix()",`"${o}"`,i(o,["hsl","lab","rgb"]))},saturate:(e,t)=>{const n=S(e);if(n)return new O({h:n.h,s:n.s+(1-n.s)*P(t,.1),l:n.l,a:n.a})},desaturate:(e,t)=>{const n=S(e);if(n)return new O({h:n.h,s:n.s-n.s*P(t,.1),l:n.l,a:n.a})},lighten:(e,t)=>{const n=S(e);if(n)return new O({h:n.h,s:n.s,l:n.l+(1-n.l)*P(t,.1),a:n.a})},darken:(e,t)=>{const n=S(e);if(n)return new O({h:n.h,s:n.s,l:n.l-n.l*P(t,.1),a:n.a})},rotateHue:(e,t)=>{const n=S(e);if(n)return t&&(N(t)||j(t))?new O({h:(n.h+V(t)+360)%360,s:n.s,l:n.l,a:n.a}):n},complement:e=>{const t=S(e);if(t)return new O({h:(t.h+180)%360,s:t.s,l:t.l,a:t.a})},contrast:(e,t,n)=>{const r=S(e),a=S(t)||ie,s=S(n)||oe;let o,i;const l=r.luma(),u=a.luma(),c=s.luma();return o=l>u?(l+.05)/(u+.05):(u+.05)/(l+.05),i=l>c?(l+.05)/(c+.05):(c+.05)/(l+.05),o>i?a:s},rgba:(e,t,n,r)=>new O({r:te(e),g:te(t),b:te(n),a:P(r,1)}),hsla:(e,t,n,r)=>new O({h:V(e),s:B(t),l:B(n),a:P(r,1)}),tint:(e,t)=>le(oe,e,null!=t?t:new y(.1)),shade:(e,t)=>le(ie,e,null!=t?t:new y(.1))};let ve={};ve=Object.assign({calc:e=>e,min:(e,t)=>Z(e,t)<0?e:t,max:(e,t)=>Z(e,t)<0?t:e,clamp:(e,t,n)=>Z(t,e)<0?e:Z(t,n)>0?n:t,scale:(e,t,n,r)=>T(e)?de(e,t,n,r):A(e)?R(e,t):void 0},fe);const ge=Object.assign({calc:"any",min:"any, any",max:"any, any",clamp:"any, any, any"},{rgb:"number|percentage, number|percentage, number|percentage,number|percentage|none",rgba:"number|percentage, number|percentage, number|percentage,number|percentage|none",hsl:"number|angle, number|percentage, number|percentage, number|percentage|none",hsla:"number|angle, number|percentage, number|percentage, number|percentage|none",hsv:"number|angle, number|percentage, number|percentage, number|percentage|none",hwb:"number|angle, number|percentage, number|percentage, number|percentage|none",lab:"number|percentage, number, number, number|percentage|none",gray:"number|percentage, number|percentage|none",mix:"color, color, number|percentage|none, string|none",saturate:"color, number|percentage|none",desaturate:"color, number|percentage|none",lighten:"color, number|percentage|none",darken:"color, number|percentage|none",rotateHue:"color, angle|number|none",complement:"color",contrast:"color, color|none, color|none",filter:"color, string",tint:"color, number|percentage|none",shade:"color, number|percentage|none"});class be{constructor(e,t={}){this.s="",this.index=0,this.options={},this.s=e,this.index=0,this.options=t}isEOF(){return this.index>=this.s.length}lookAhead(e){return this.s.slice(this.index,this.index+e)}skipWhiteSpace(){this.match(/^\s*/)}match(e){if("string"==typeof e){if(this.lookAhead(e.length)===e)return this.index+=e.length,e}else{const t=this.s.slice(this.index).match(e);if(t&&t[0])return this.index+=t[0].length,t[1]||!0}}error(e,...t){var n,r,a,o;const i=null!=(r=null===(n=this.s.slice(0,this.index).match(/^(.*)/))||void 0===n?void 0:n[1])?r:"",l=null!=(o=null===(a=this.s.slice(this.index).match(/(.*)$/))||void 0===a?void 0:a[1])?o:"";s([i+K.dim(l)," ".repeat(i.length)+"⇧"],e,...t)}applyOpToLength(t,n,r){j(n)&&"/"===t&&this.error(e.InvalidOperand),j(n)||j(r)||"*"!==t||this.error(e.InvalidOperand);const a={"+":(e,t)=>e+t,"-":(e,t)=>e-t,"*":(e,t)=>e*t,"/":(e,t)=>e/t}[t];if(j(n)){if(s=r,console.assert(s instanceof v),"multi"===r.unit){const e={};return Object.keys(r.value).forEach(t=>{e[t]=a(n.value,r.value[t])}),new v(e)}return new v(a(n.value,r.value),r.unit)}var s;if(j(r)){if("number"==typeof n.value)return new v(a(n.value,r.value),n.unit);const e={};return Object.keys(n.value).forEach(t=>{e[t]=a(n.value[t],r.value)}),new v(e)}if("/"===t)return"multi"!==n.unit&&"multi"!==r.unit||this.error(e.InvalidOperand),n.unit===r.unit?new y(n.value/r.value):new y(n.canonicalScalar()/r.canonicalScalar());const o=W(n),i=W(r),l={};return[...Object.keys(o.value),...Object.keys(i.value)].forEach(e=>{void 0===i.value[e]?l[e]=o.value[e]:void 0===o.value[e]?l[e]=i.value[e]:l[e]=a(o.value[e],i.value[e])}),new v(l)}parseUnit(t){if(this.match("%"))return new m(t);let n=this.match(/^(em|ex|ch|rem|vw|vh|vmin|vmax|px|cm|mm|in|pt|pc|Q)/);return n?new v(t,n):(n=this.match(/^(deg|°|rad|grad|turn)/),n?new f(t,"°"===n?"deg":n):(n=this.match(/^(ms|s)/),n?new g(t,n):(n=this.match(/^(khz|hz|kHz|Hz)/),n?new b(t,n.toLowerCase()):(n=this.match(/^([a-zA-Z]+)/),n&&this.error(e.UnknownUnit,n),new y(t)))))}parseIndex(t){let n=t;if(this.match("["))if("array"!==t.type())this.error(e.UnexpectedOpenBracket);else{const r=z(this.parseExpression(),NaN);isNaN(r)&&this.error(e.ExpectedIntegerIndex),n=t.get(r),this.skipWhiteSpace(),this.match("]")||this.error(e.ExpectedCloseBracket)}return n}parseLiteral(){var t,n,r,a;let s;const o=this.index,i=this.match(/^\s*([+\-])\s*/);if(i){const t=this.parseLiteral();if("-"===i){if(F(t))return new m(-100*B(t));if(j(t))return new y(-t.value);if(N(t))return new f(-t.value,t.unit);if(A(t))return this.applyOpToLength("-",new v(0,"px"),t);this.error(e.InvalidUnaryOperand)}return t}const l=this.match(/^([0-9]*\.[0-9]+|\.?[0-9]+)/);if(l&&(s=this.parseUnit(parseFloat(l))),!s&&this.match("[")){const t=[];for(;"]"!==this.lookAhead(1)&&!this.isEOF();){const n=this.parseExpression();n||this.error(e.SyntaxError),t.push(n),this.match(/^(\s*,?|\s+)/)}return this.isEOF()&&this.error(e.ExpectedCloseBracket),this.match("]"),new x(t)}if(!s&&this.match('"')){let t="";for(;'"'!==this.lookAhead(1)&&!this.isEOF();)"\\"===this.lookAhead(1)?(t+=this.s[this.index+1],this.index+=2):(t+=this.s[this.index],this.index+=1);return this.isEOF()&&this.error(e.ExpectedQuote),this.match('"'),new w(t)}if(!s&&this.match("{")){const o=this.match(/^([a-zA-Z_-][a-zA-Z0-9\._-]*)/);if(o){let i=null===(t=this.options)||void 0===t?void 0:t.aliasResolver(o);if("string"==typeof i){const t=o.match(/^(.+)-([0-9]{2,3})$/);if(t){const s=null===(n=this.options)||void 0===n?void 0:n.aliasResolver(t[1]);if("string"!=typeof s){if(_(s)){const e=Math.round(parseInt(t[2])/100);i=s.get(e)}else if(T(s)){const e=Math.round(parseInt(t[2])/100);i=null===(r=de(s))||void 0===r?void 0:r.get(e)}else if(A(s)){const e="50"===t[2]?0:Math.round(parseInt(t[2])/100);i=null===(a=R(s))||void 0===a?void 0:a.get(e)}}else"string"==typeof s?this.error(e.UnknownToken,t[1],s):this.error(e.InvalidOperand)}}"string"==typeof i&&this.error(e.UnknownToken,o,i),s=i,s&&(s=I(s),s.setSource("{"+o+"}"))}this.match("}")||this.error(e.ExpectedCloseCurlyBracket)}return s||(s=S(this.match(/^\s*(#[0-9a-fA-F]{3,8})/))),s||(this.index=o,s=S(this.match(/^\s*([a-zA-Z]+)/))),s||(this.index=o),s}parseColorArguments(){const e=[];if(this.skipWhiteSpace(),!this.match("("))return;let t=this.parseExpression();if(t){if(e.push(t),!this.match(/^(\s*,?|\s+)/))return this.match(")"),e;if(t=this.parseExpression(),t){if(e.push(t),!this.match(/^(\s*,?|\s+)/))return this.match(")"),e;if(t=this.parseExpression(),t){if(e.push(t),!this.match(/^(\s*,?|\s+|\s*\/)/))return this.match(")"),e;t=this.parseExpression(),t&&e.push(t)}}}return this.match(")"),e}parseArguments(){if(this.skipWhiteSpace(),!this.match("("))return;const t=[];for(;")"!==this.lookAhead(1)&&!this.isEOF();){const n=this.parseExpression();n||this.error(e.SyntaxError),t.push(n),this.match(/^(\s*,?|\s+)/)}return this.isEOF()&&this.error(e.ExpectedCloseParen),this.match(")"),t}parseCall(){const t=this.index,r=this.match(/^([a-zA-Z\-]+)/);if(r)if(ve[r]){const t=me.includes(r)?this.parseColorArguments():this.parseArguments();if(t){try{!function(t,r){var a;const s=null===(a=ge[t])||void 0===a?void 0:a.split(",").map(e=>e.trim());if(s&&(s.forEach((a,s)=>{var o;const i=a.split("|").map(e=>e.trim());if(!i.includes("none")&&!r[s])throw new n(e.MissingArgument,String(s+1),t,i.join(", "));if(r[s]&&!i.includes("any")&&!i.includes(null===(o=r[s])||void 0===o?void 0:o.type()))throw new n(e.ExpectedArgument,String(s+1),t,i.join(", "))}),r.length>s.length))throw new n(e.TooManyArguments,t,s.join(", "))}(r,t)}catch(e){e.code?this.error(e.code,...e.args):this.error(e.message)}return ve[r](...t)}this.error(e.SyntaxError)}else"("===this.lookAhead(1)&&this.error(e.UnknownFunction,r,i(r,ve));this.index=t}parseTerminal(){const e=this.parseCall()||this.parseGroup()||this.parseLiteral();return e?this.parseIndex(e):e}parseFactor(){let t=this.parseTerminal(),n=this.match(/^\s*([*|/])\s*/);for(;n;){const r={"*":(e,t)=>e*t,"/":(e,t)=>e/t}[n],a=this.parseTerminal();if(a||this.error(e.ExpectedOperand),j(a))j(t)?t=new y(r(t.value,a.value)):F(t)?t=new m(r(t.value,a.value)):A(t)?t=this.applyOpToLength(n,t,a):N(t)?t=new f(r(t.value,a.value),t.unit):$(t)?t=new b(r(t.value,a.value),t.unit):q(t)&&(t=new g(r(t.value,a.value),t.unit));else{if((j(t)||A(t))&&A(a))return this.applyOpToLength(n,t,a);j(t)?F(a)?t=new m(r(t.value,a.value)):A(a)?t=this.applyOpToLength(n,t,a):N(a)?t=new f(r(t.value,a.value),a.unit):$(a)?t=new b(r(t.value,a.value),a.unit):q(a)&&(t=new g(r(t.value,a.value),a.unit)):"/"===n&&t.type()===a.type()?t=new y(t.canonicalScalar()/a.canonicalScalar()):this.error(e.InvalidOperand)}n=this.match(/^\s*([*|/])\s*/)}return t}parseTerm(){let t=this.parseFactor(),n=this.match(/^\s*([+\-])\s*/);for(;n;){const r={"+":(e,t)=>e+t,"-":(e,t)=>e-t}[n],a=this.parseFactor();a||this.error(e.ExpectedOperand),C(t)||C(a)?("-"===n&&this.error(e.InvalidOperand),t=new w(r(t.css(),a.css()))):j(t)&&j(a)?t=new y(r(t.value,a.value)):(L(t)||F(t))&&(L(a)||F(a))?t=new m(100*r(B(t),B(a))):L(t)&&q(a)?t=new g(r(0,a.value),a.unit):q(t)&&L(a)?t=new g(t.value,t.unit):q(t)&&q(a)?t=t.unit===a.unit?new g(r(t.value,a.value),t.unit):new g(r(t.canonicalScalar(),a.canonicalScalar()),"s"):L(t)&&$(a)?t=new b(r(0,a.value),a.unit):$(t)&&L(a)?t=new b(t.value,t.unit):$(t)&&$(a)?t=t.unit===a.unit?new b(r(t.value,a.value),t.unit):new b(r(t.canonicalScalar(),a.canonicalScalar()),"hz"):L(t)&&N(a)?t=new f(r(0,a.value),a.unit):N(t)&&L(a)?t=new f(t.value,t.unit):N(t)&&N(a)?t=t.unit===a.unit?new f(r(t.value,a.value),t.unit):new f(r(V(t),V(a)),"deg"):(L(t)||A(t))&&(L(a)||A(a))?t=this.applyOpToLength(n,t,a):this.error(e.InvalidOperand),n=this.match(/^\s*([+\-])\s*/)}return t}parseGroup(){let t;return this.match("(")&&(t=this.parseExpression(),this.skipWhiteSpace(),this.match(")")||this.error(e.ExpectedCloseParen)),t&&j(t)&&(t=this.parseUnit(t.value)),t}parseExpression(){return this.skipWhiteSpace(),this.parseTerm()}}const ye=require("fs"),we={formats:{yaml:{ext:".yaml",render:e=>e.renderTemplate(ye.readFileSync(__dirname+"/templates/yaml.hbs","utf-8"),e)},json:{ext:".json",render:e=>e.renderTemplate(ye.readFileSync(__dirname+"/templates/json.hbs","utf-8"),e),handlebarsHelpers:{}},"data-dump":{ext:".yaml",render:e=>e.renderTemplate(ye.readFileSync(__dirname+"/templates/data-dump.hbs","utf-8"),e)}}},xe=require("fs"),ke={formats:{sass:{ext:".scss",render:e=>e.renderTemplate(xe.readFileSync(__dirname+"/templates/sass.hbs","utf-8"),e)},css:{ext:".css",render:e=>e.renderTemplate(xe.readFileSync(__dirname+"/templates/css.hbs","utf-8"),e)}}},Ee=require("marked"),Me=require("highlight.js"),Oe=require("handlebars"),Ie=require("fs");function Te(e){let t="";const n={colors:[],colorRamps:[],group:""},r=[];return e.themes.forEach(e=>{e.tokens.forEach(t=>{T(t.tokenValue)&&r.push({name:t.tokenId+("_"===e.theme||""===e.theme?"":"."+e.theme),color:t.tokenValue})})}),e.themes.forEach(a=>{n.group=1===e.themes.length?"":"_"===a.theme?"Base":a.theme,n.colors=[],a.tokens.forEach(e=>{var t,a,s,o;if(T(e.tokenValue)){const o=e.tokenValue;let i,l=o.luma()>=1?"frame ":"";o.luma()>.42&&(l+="light"),o.a<1&&(i=new O(o),i.a=1);const u=pe(o,r),c=pe(o,r,"protanopia"),h=null===(t=pe(o,r,"deuteranopia"))||void 0===t?void 0:t.filter(e=>{var t;return!(null===(t=u)||void 0===t?void 0:t.includes(e))}),p=pe(o,r,"tritanopia"),m=[];[...null!=h?h:[],...null!=p?p:[],...null!=c?c:[]].forEach(e=>{m.findIndex(t=>t.name===e.name)<0&&(!u||u.findIndex(t=>t.name===e.name)<0)&&m.push(e)}),n.colors.push({name:e.tokenId,value:e.tokenValue,source:o.getSource(),css:o.css(),protanopiaCss:he(o,"protanopia").css(),deuteranopiaCss:he(o,"deuteranopia").css(),tritanopiaCss:he(o,"tritanopia").css(),comment:(a=e.tokenDefinition.comment,null!=a?a:""),cls:l,opaqueColor:null===(s=i)||void 0===s?void 0:s.css(),similarColors:{normal:u?u.map(e=>({name:e.name,css:e.color.css(),deltaE:d(e.deltaE,2)})):null,colorDeficient:m?m.map(e=>({name:e.name,css:e.color.css(),deltaE:d(e.deltaE,2)})):null,protanopia:c?c.map(e=>({name:e.name,css:e.color.css(),deltaE:d(e.deltaE,2)})):null,deuteranopia:h?h.map(e=>({name:e.name,css:e.color.css(),deltaE:d(e.deltaE,2)})):null,tritanopia:p?p.map(e=>({name:e.name,css:e.color.css(),deltaE:d(e.deltaE,2)})):null}})}else if((o=e.tokenValue)instanceof x&&o.value.every(e=>T(e))){let t;n.colorRamps.push({name:e.tokenId,source:e.tokenValue.getSource(),values:e.tokenValue.value.map((e,n)=>{var r;const a=e;let s,o=a.luma()>=1?"frame ":"";a.luma()>.42&&(o+="light"),a.a<1&&(s=new O(a),s.a=1);const i=t&&ce(a,t);return t=a,{name:0===n?"50":100*n,cls:o,value:a,css:a.css(),opaqueColor:null===(r=s)||void 0===r?void 0:r.css(),deltaE:i<2?d(i,2):void 0}})})}}),t+=Oe.compile(Ie.readFileSync(__dirname+"/templates/html-colors.hbs","utf-8"))(n)}),t}const Se={formats:{"html/colors":{ext:".html",render:Te},html:{ext:".html",render:e=>e.renderTemplate(Ie.readFileSync(__dirname+"/templates/html-file.hbs","utf-8"),Object.assign(Object.assign({},e),{"color-section":Te(e)}))}}};Ee.setOptions({renderer:new Ee.Renderer,highlight:e=>Me.highlightAuto(e).value,pedantic:!1,gfm:!0,breaks:!1,sanitize:!1,smartLists:!0,smartypants:!1,xhtml:!1});const{cosmiconfigSync:je}=require("cosmiconfig"),Ue=je("chromatic"),Fe=require("glob"),Ae=require("fs-extra"),Ce=require("path"),Ne=require("yaml"),qe=require("json5"),$e=require("resolve-from"),_e=require("handlebars"),Le={};let ze,Pe,Ve,De,Be,He,Ze,We=!1,Re=!1;function Ge(e){var t;"string"==typeof e&&(e=[e]);const n="\n"+[].concat(...e.map(e=>e.split("\n"))).join("\n    ");null===(t=Le.console)||void 0===t||t.error(K.autoFormat(n)),We||Re||process.exit(1)}function Qe(e){var t;null===(t=Le.console)||void 0===t||t.log(e)}function Ye(e,t){e!==t&&t&&Object.keys(t).forEach(n=>{Array.isArray(t[n])?(e[n]||(e[n]=[]),e[n]=[...e[n],...t[n]]):"object"==typeof t[n]?(e[n]||(e[n]={}),Ye(e[n],t[n])):void 0!==t[n]&&(e[n]=t[n])})}function Je(t,n,a){if(n&&!He.includes(t))try{r(Be.includes(t),e.CircularDefinition,t),Be.push(t);const s=function(e,t={}){const n=new be(e,t),r=n.parseExpression();if(n.skipWhiteSpace(),n.isEOF())return r&&r.setSource(e),r}(n,Object.assign(Object.assign({},Le),{aliasResolver:e=>{var n,r,s,o,l;let u;if(a){if(De.has(e+"."+a))return De.get(e+"."+a);if(Ve.has(e)&&(u=Je(e+"."+a,null!=(r=null===(n=Ve.get(e))||void 0===n?void 0:n.value[a])?r:null===(s=Ve.get(t))||void 0===s?void 0:s.value._,a)),u)return u}return De.has(e)?De.get(e):(Ve.has(e)&&(a&&(u=Je(e+"."+a,null===(o=Ve.get(e))||void 0===o?void 0:o.value[a],a)),u||(u=Je(e,null===(l=Ve.get(t))||void 0===l?void 0:l.value._,a))),null!=u?u:i(e,Ve))}}));return Be.pop(),s}catch(e){He.includes(t)||(He.push(t),Ge([K.error("Syntax error")+` in "${t+": '"+n}'"`,e.message]))}}function Ke(t){var n,a,s;const o=[];if(t=Ce.resolve(Ce.normalize(t)),Ze.includes(t))return;if(Ze.push(t),Ae.lstatSync(t).isDirectory())return void Fe.sync(t+"/**/*"+Le.tokenFileExt).forEach(Ke);let i;try{const e=Ae.readFileSync(t,"utf8");i=/^\.json/.test(Ce.extname(t))?qe.parse(e):Ne.parse(e)}catch(e){o.push((e.name?e.name+": ":"")+e.message)}if((null===(n=i)||void 0===n?void 0:n.import)&&("string"==typeof i.import&&(i.import=[i.import]),Array.isArray(i.import)?i.import.forEach(e=>{let n=t;try{n=$e(Ce.parse(t).dir,e),Ke(n)}catch(t){o.push(`option "import: ${e}"`),"MODULE_NOT_FOUND"===t.code?o.push("Module not found."+("./"===e.slice(0,2)?"":`\nTo import as a file, use a relative path: "./${e}"`)):"ENOENT"===t.code?o.push("→ "+K.path(n)+"\nFile not found."):o.push(t.message)}}):o.push('Option "import" should be a path or an array of paths')),i&&Le.verbose&&(i.imports||i.extends||i.include||i.includes)&&!i.import&&Qe(K.warning()+K.path(Ce.relative("",t))+`\n${K.warning("Warning:")} use the \`"import"\` property to import other token files`),(null===(a=i)||void 0===a?void 0:a.groups)&&Object.keys(i.groups).forEach(e=>{var t;if(Pe.has(e)){const n=Pe.get(e);n.name=null!=(t=i.groups[e].name)?t:n.name,n.comment=(n.comment?n.comment+"\n":"")+i.groups[e].comment,n.remarks=(n.remarks?n.remarks+"\n":"")+i.groups[e].remarks,Pe.set(e,n)}else Pe.set(e,i.groups[e])}),null===(s=i)||void 0===s?void 0:s.tokens){r("object"!=typeof i.tokens,e.UnexpectedTokensType);try{!function t(n,a,s){r(Array.isArray(s),e.UnexpectedTokensArray,K.link("tokens-as-array")),Pe.has(a)||Pe.set(a,{}),Object.keys(s).forEach(o=>{var i;const l=(a?a+".":"")+o;r(!/^[a-zA-Z_-][a-zA-Z0-9_-]*$/.test(o),e.InvalidTokenName,l),r(!s[o],e.InvalidTokenValue,o);try{const e=function(e,t){if("string"!=typeof t&&("object"!=typeof t||!t.value))return;let n={value:{}};return"string"==typeof t?n.value._=t:n=Object.assign({},t),"string"==typeof n.value&&(n.value={_:n.value}),e&&n.value._&&(n.value[e]=n.value._,n.value._=void 0),Object.keys(n.value).forEach(e=>{ze.includes(e)||ze.push(e)}),n}(null!=(i=n.theme)?i:Le.defaultTheme,s[o]);if(e)if(Ve.has(l)){const t=Ve.get(l);Ye(t,e),Ve.set(l,t)}else Ve.set(l,e);else t(n,l,s[o])}catch(e){throw new Error(`${l}: "${s[o]}"\n${e.message}`)}})}(i,"",i.tokens)}catch(e){o.push(e.message)}}Le.verbose&&0===o.length&&Qe(K.success()+"← "+K.path(process.env.TEST?Ce.basename(t):Ce.relative("",t))),o.length>0&&Ge([K.error()+"← "+K.path(process.env.TEST?Ce.basename(t):Ce.relative("",t)),...o])}function Xe(e,t,n){Ve.forEach((e,n)=>{Object.keys(e.value).forEach(e=>{t.includes(e)})});const r=[];Pe.forEach((e,n)=>{const a=[...Ve].filter(([e,t])=>n?e.startsWith(n+"."):!/\./.test(e));r.push({groupId:n,groupInfo:e,tokens:a.map(([e,n])=>({tokenId:e,tokenDefinition:n,themes:t.map(t=>{const n=e+("_"===t?"":"."+t);return{theme:t,tokenName:n,tokenValue:De.get(n)}}).filter(e=>e.tokenValue)}))})});const a={};return Ve.forEach((e,t)=>{if(Object.keys(e.value).length>1)Object.keys(e.value).forEach(n=>{a[n]||(a[n]=[]);const r=t+("_"===n?"":"."+n);a[n].push({tokenId:t,tokenName:r,tokenDefinition:e,tokenValue:De.get(r)})});else{const n=Object.keys(e.value)[0],r=t+("_"===n?"":"."+n);a[""]||(a[""]=[]),a[""].push({tokenId:t,tokenName:r,tokenDefinition:e,tokenValue:De.get(r)})}}),e.render({filepath:n,fileHeader:e.fileHeader,themes:Object.keys(a).map(e=>({theme:e,isDefaultTheme:"_"===e,tokens:a[e]})),groups:r,renderTemplate:(e,t)=>_e.compile(e.replace(/\r\n/g,"\n"))(t)})}function et(t,n){var a,s,o,l,c;s=null===(a=n)||void 0===a?void 0:a.watching,We=null!=s&&s,ze=[],Ve=new Map,Pe=new Map,De=new Map,Be=[],Ze=[],He=[],t.forEach(e=>{const t=Fe.sync(e);0!==t.length?t.forEach(Ke):Ge(K.error("File not found: ")+K.path(e))});try{Ve.forEach((e,t)=>{Object.keys(e.value).forEach(n=>{var r;const a=t+("_"===n?"":"."+n),s=null!=(r=Je(a,e.value[n],Le.defaultTheme))?r:new w(e.value[n]);De.set(a,s),e.type&&s.type()!=e.type&&Qe(K.warning("Warning:")+` Type mismatch. Expected \`${e.type}\` but got \`${s.type()}\` for "${a}" token`)})}),De.forEach((e,t)=>{C(e)&&(e.value=e.value.replace(/{[a-zA-Z0-9\._-]+}/g,e=>{const t=e.slice(1,-1);return De.has(t)?De.get(t).css():(Ge(K.error("Unresolved alias. ")+`Cannot find token "${e}"`+i(t,De)),e)}))}),Ve.forEach((e,t)=>{ze.forEach(n=>{var r;if("_"!==n&&void 0===e.value[n]){const a=t+"."+n,s=null!=(r=Je(a,e.value._,n))?r:new w(e.value._);De.set(a,s)}})}),Ve.forEach((e,t)=>{ze.forEach(e=>{var n;if("_"!==e){const r=t+"."+e;(null===(n=De.get(t))||void 0===n?void 0:n.equals(De.get(r)))&&De.delete(r)}})}),Ve.forEach((t,n)=>{r(Object.keys(t.value).reduce((e,t)=>{var r,a;const s="_"===t?n:n+"."+t;return e.includes(null===(r=De.get(s))||void 0===r?void 0:r.type())||e.push(null===(a=De.get(s))||void 0===a?void 0:a.type()),e},[]).length>1,e.InconsistentTokenType,n)});const t=function(t){const n={fileHeader:u,formatFilename:function({theme:e,basename:t}){return t+(e?"-"+e:"")},handlebarsHelpers:Object.assign({},Le.handlebarsHelpers),render:e=>"Expected a render() function in the Format definition."};r(!Le.formats[t],e.UnknownFormat,t,i(t,Le.formats));const a=Le.formats[t].extends;return a&&(r(!Le.formats[a],e.UnknownFormat,a,i(a,Le.formats)),Ye(n,Le.formats[a])),Ye(n,Le.formats[t]),Object.keys(n.handlebarsHelpers).forEach(e=>{_e.registerHelper(e,n.handlebarsHelpers[e])}),n}(Le.outputFormat);t.fileHeader=null!=(o=n.header)?o:t.fileHeader;const a=(null===(l=n)||void 0===l?void 0:l.output)&&Ce.resolve(n.output),s=function(e,t){var n;const r={};let a="";if(!function(){var e;return(null===(e=Le.themes)||void 0===e?void 0:e.length)>0&&(ze=ze.filter(e=>Le.themes.includes(e))),ze.forEach(e=>{let t=0;Ve.forEach((n,r)=>{void 0!==n.value[e]&&(t+=1)}),0===t&&ze.splice(ze.indexOf(e),1)}),0!==ze.length&&0!==Ve.size||(Ge([K.error("No tokens found."),'Token files should have a "tokens" property',K.link("../guide")]),!1)}())return;const s=null!=(n=e&&Ce.parse(e))?n:{name:"tokens"};return Le.splitOutput?ze.forEach(e=>{a=Ce.format({dir:s.dir,name:t.formatFilename({theme:e,basename:s.name}),ext:t.ext}),r[a]=Xe(t,[e],a)}):(a=Ce.format({dir:s.dir,name:t.formatFilename({theme:"",basename:s.name}),ext:t.ext}),r[a]=Xe(t,ze,a)),r}(a,t);if(s&&!(null===(c=n)||void 0===c?void 0:c.dryRun)){if(!a)return s;if(Le.verbose){let e="";1===ze.length&&"_"===ze[0]||(e=1===ze.length?`for theme "${ze[0]}"`:"for themes "+ze.map(e=>'"'+e+'"').join(", ")),Qe(`    Writing ${K.string(Le.outputFormat)} format ${e}`)}Object.keys(s).forEach(e=>{!function(e,t){const n=Ce.dirname(t);Ae.existsSync(n)||Ae.mkdirsSync(n),Ae.writeFileSync(t,e),(Le.verbose||We)&&Qe(K.success()+(We?K.time()+" ":"")+"→ "+K.path(Ce.relative("",t)))}(s[e],e)})}}catch(e){Ge(K.error(e.message))}return{}}function tt(e,t){var n,r,a,s,o,i,l,u,c,h,p,d,m,f,v,g,b,y,w,x,k,E,M,O,I,T,S;"string"==typeof e&&(e=[e]);let j=Ue.search();null==(r=null===(n=j)||void 0===n?void 0:n.isEmpty)||r||Ye(Le,j.config),(null===(a=t)||void 0===a?void 0:a.config)&&(j=Ue.load(t.config),null==(o=null===(s=j)||void 0===s?void 0:s.isEmpty)||o||Ye(Le,j.config)),(null===(i=t)||void 0===i?void 0:i.themes)&&("string"==typeof t.themes?Le.themes=t.themes.split(",").map(e=>e.trim()):Array.isArray(t.themes)&&(Le.themes=[...t.themes])),u=null===(l=t)||void 0===l?void 0:l.ignoreErrors,Re=null!=u&&u;const U=[];if("string"==typeof(null===(c=t)||void 0===c?void 0:c.console)?"log"===(null===(h=t)||void 0===h?void 0:h.console)&&(K.useColor(!1),Le.console={log:e=>{U.push(e)},error:e=>{U.push(e)}}):Le.console=null!=(d=null===(p=t)||void 0===p?void 0:p.console)?d:{log:e=>console.error(e),error:e=>console.error(e)},Le.themes||(Le.themes=[]),Le.tokenFileExt=null!=(g=null!=(f=null===(m=t)||void 0===m?void 0:m.tokenFileExt)?f:null===(v=Le)||void 0===v?void 0:v.tokenFileExt)?g:"yaml",Le.verbose=null!=(x=null!=(y=null===(b=t)||void 0===b?void 0:b.verbose)?y:null===(w=Le)||void 0===w?void 0:w.verbose)&&x,Le.splitOutput=t.splitOutput,Le.outputFormat=null!=(O=null!=(E=null===(k=t)||void 0===k?void 0:k.format)?E:null===(M=Le)||void 0===M?void 0:M.outputFormat)?O:"",!Le.outputFormat){const e=(null===(I=t)||void 0===I?void 0:I.output)&&Ce.extname(null===(T=t)||void 0===T?void 0:T.output);if(e){const t=Object.keys(Le.formats).filter(t=>{var n,r;return Le.formats[t].ext===e||(null===(r=Le.formats[null===(n=Le.formats[t])||void 0===n?void 0:n.extends])||void 0===r?void 0:r.ext)});1===t.length?Le.outputFormat=t[0]:Le.formats[e.slice(1)]?Le.outputFormat=e.slice(1):t.length>1&&Ge([K.error("Ambiguous format. ")+`Use ${K.keyword("--format")} to indicate which output format to use.`,`Did you mean \`${t.join(", ")}\`?`])}Le.outputFormat?Le.verbose&&Qe(K.warning()+'Setting the format to "gConfig.outputFormat" based on the output file extension. Use `--format` to indicate which output format to use.'):(Le.outputFormat="yaml",Qe(K.warning("Format not specified.")+` Using "${K.keyword("yaml")}". `+`Use ${K.keyword("--format")} to indicate which output format to use.`))}Ye(Le.handlebarsHelpers,null===(S=t)||void 0===S?void 0:S.handlebarsHelpers);const F=et(e,t);return U.length>0&&(F.stderr=U.join("\n")),F}Ye(Le,l),Ye(Le,ke),Ye(Le,we),Ye(Le,Se),module.exports=tt;const nt=require("./package.json");require("please-upgrade-node")(nt);const rt=require("fs-extra"),at=require("path"),st=require("update-notifier"),ot=require("chokidar");function it(e){console.log(Object.keys(e).map(t=>("stderr"===t?K.error():K.success())+">>>> "+K.path(t)+"\n"+e[t]).join("\n"))}st({pkg:nt,shouldNotifyInNpmScript:!0}).notify(),require("yargs").usage("Usage: $0 file(s) [options]").example("$0 ./assets/tokens.yaml -o ./build/tokens.scss","Generate a Sass file from a design tokens YAML file").command(["* <paths..>","build <paths..>"],"Build output files",(function(e){e.positional("<path>",{describe:"Path to a token file or directory",type:"string"}).option("output",{alias:"o",describe:"Save output to path",type:"path"}).normalize("output").option("format",{alias:"f",describe:"Output format: css|sass|js|yaml|json",type:"string"}).option("header",{describe:"Content inserted at the to of the output file",type:"string"}).option("themes",{describe:"Comma separated list of themes to process",type:"string"}).option("split-output",{describe:"If there are multiple themes, output one file per theme. Otherwise the themes are combined in a single file.",type:"boolean",default:!1}).option("token-file-ext",{describe:"Default file extension of token files",type:"string",default:".yaml"}).option("dry-run",{describe:"Validate the token files, attempt to generate the specified file format, but don't output anything",conflicts:"output",type:"boolean"}).option("config",{describe:"Load config file from path",type:"path"}).normalize("config").option("verbose",{describe:"Display additional information during processing",type:"boolean"}).option("no-color",{describe:"Suppress color output in terminal",type:"boolean"}).option("ignore-errors",{alias:"i",describe:"Attempt to continue when an error is encountered",type:"boolean"}).option("watch",{describe:"Watch for changes to the token files and rebuild",type:"boolean"})}),(function(e){if(void 0===process.stdin.isTTY||process.stdin.isTTY)(!e.paths||e.paths.length<1)&&(console.error(K.error()+"Expected at least one path to a directory or token file.\n"+`    Use ${K.keyword(e.$0+" help")} for available options.\n`,`   Use ${K.keyword(e.$0+" example")} to create an example directory.`),process.exit(1)),e.watch?ot.watch(e.paths).on("all",(t,n)=>{tt(e.paths,Object.assign(Object.assign({},e),{watching:!0})),console.log(K.time()+` ${K.dim(e.$0)}: Waiting for changes...\n${K.dim("Press Ctrl-C to exit.")}`)}):it(tt(e.paths,e));else{process.stdin.setEncoding("utf-8");let t="";process.stdin.on("readable",(function(){let e;for(;e=process.stdin.read();)t+=e})),process.stdin.on("end",(function(){it(tt(t,e))}))}})).command("example [example-directory]","Create example directory",e=>{e.positional("example-directory",{describe:"Example output directory",type:"string"})},(function(e){var t;const n=at.resolve(null!=(t=e["example-directory"])?t:"chromatic-example");console.log("Creating an example in "+at.relative("",n));try{rt.copySync("examples/basic",n,{overwrite:!1,errorOnExist:!0}),console.log("Now, try the example:\n    "+K.keyword(e.$0+" "+at.relative("",n)+" -o ./build/tokens.scss")+"\nor:\n    "+K.keyword(e.$0+" "+at.relative("",n)+" -o ./build/tokens.html"))}catch(e){console.log(e.message)}})).command("help","Show help",()=>{},e=>e.help()).help("h").alias("h","help").epilog("For more information, see https://github.com/arnog/chromatic/docs/guide.md").strict(!0).argv;

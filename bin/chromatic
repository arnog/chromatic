#!/usr/bin/env node
var ErrorCode;!function(e){e[e.NoError=0]="NoError",e[e.SyntaxError=1]="SyntaxError",e[e.UnexpectedOpenBracket=2]="UnexpectedOpenBracket",e[e.ExpectedCloseBracket=3]="ExpectedCloseBracket",e[e.ExpectedOpenParen=4]="ExpectedOpenParen",e[e.ExpectedCloseParen=5]="ExpectedCloseParen",e[e.ExpectedQuote=6]="ExpectedQuote",e[e.UnknownUnit=7]="UnknownUnit",e[e.UnknownFunction=8]="UnknownFunction",e[e.MissingArgument=9]="MissingArgument",e[e.ExpectedArgument=10]="ExpectedArgument",e[e.TooManyArguments=11]="TooManyArguments",e[e.ExpectedOperand=12]="ExpectedOperand",e[e.InvalidOperand=13]="InvalidOperand",e[e.InvalidUnaryOperand=14]="InvalidUnaryOperand",e[e.ExpectedIntegerIndex=15]="ExpectedIntegerIndex",e[e.CircularDefinition=16]="CircularDefinition",e[e.UnexpectedTokensArray=17]="UnexpectedTokensArray",e[e.UnexpectedTokensType=18]="UnexpectedTokensType",e[e.InvalidTokenName=19]="InvalidTokenName",e[e.InvalidTokenValue=20]="InvalidTokenValue",e[e.InconsistentTokenType=21]="InconsistentTokenType",e[e.UnknownFormat=22]="UnknownFormat",e[e.UnknownValueFormatter=23]="UnknownValueFormatter",e[e.UnknownNameFormatter=24]="UnknownNameFormatter"}(ErrorCode||(ErrorCode={}));const ERRORS={[ErrorCode.SyntaxError]:"Syntax error",[ErrorCode.UnexpectedOpenBracket]:"Unexpected `[`",[ErrorCode.ExpectedCloseBracket]:"Expected `]`",[ErrorCode.ExpectedOpenParen]:"Expected `(`",[ErrorCode.ExpectedCloseParen]:"Expected `)`",[ErrorCode.ExpectedQuote]:'Expected `"`',[ErrorCode.UnknownUnit]:"Unknown unit `%1`",[ErrorCode.UnknownFunction]:"Unknown function `%1`%2",[ErrorCode.MissingArgument]:"Missing argument %1 of `%2` of type `%3`",[ErrorCode.ExpectedArgument]:"Expected argument %1 of `%2` to be of type `%3`",[ErrorCode.TooManyArguments]:"Too many arguments for function `%1(%2)`",[ErrorCode.ExpectedOperand]:"Expected operand",[ErrorCode.InvalidOperand]:"Invalid operand",[ErrorCode.InvalidUnaryOperand]:"Invalid operand",[ErrorCode.CircularDefinition]:'Circular definition of the "%1" token',[ErrorCode.UnexpectedTokensArray]:'The "tokens" property is an array. It should be a key/value map of tokens.\n%1',[ErrorCode.UnexpectedTokensType]:'The "tokens" property should be a key/value map of tokens.',[ErrorCode.InvalidTokenName]:'Invalid token name "%1": it must only contain digits, letters, "_" and "-"',[ErrorCode.InvalidTokenValue]:'The "%1" token is invalid. If using a YAML file, make sure RGB hex values are within quotes',[ErrorCode.InconsistentTokenType]:'Inconsistent token type: "%1" ( "%2")',[ErrorCode.UnknownFormat]:'Unknown format "%1"%2',[ErrorCode.UnknownValueFormatter]:'Unknown value formatter "%1"%2',[ErrorCode.UnknownNameFormatter]:'Unknown name formatter "%1"%2',[ErrorCode.ExpectedIntegerIndex]:"Expected a number of array index"};class SyntaxError extends Error{constructor(e,...t){super(),this.code=e,this.args=t}}function throwError(e,...t){throwErrorWithContext(void 0,e,...t)}function throwErrorWithContext(e,t,...r){var n;let o="";throw process.env.TEST?o="[ERR] "+(null!=(n=ErrorCode[t])?n:t):(e&&(o=e.join("\n")+"\n"),o+=ERRORS[t],r.forEach((e,t)=>{o=o.replace(new RegExp(`%${t+1}`,"g"),e)})),new Error(o)}const stringSimilarity=require("string-similarity");function getSuggestion(e,t){const r=function(e,t){if(!e||!t)return"";let r;if(0===(r=t instanceof Map?Array.from(t.keys()):Object.keys(t)).length)return"";const n=stringSimilarity.findBestMatch(e,r);return n.bestMatch.rating>.1?n.bestMatch.target:""}(e,t);return r?`. Did you mean "${r}"?`:""}const DefaultFormatters={valueFormatters:{},nameFormatters:{camelcase:(e,t)=>(e+!t?"":"."+t).toLowerCase().replace(/(?:^\w|[A-Z]|\b\w)/g,(e,t)=>0===t?e.toLowerCase():e.toUpperCase()).replace(/\s+/g,""),kebabcase:(e,t)=>(e+!t?"":"."+t).match(/[A-Z]{2,}(?=[A-Z][a-z0-9]*|\b)|[A-Z]?[a-z0-9]*|[A-Z]|[0-9]+/g).filter(Boolean).map(e=>e.toLowerCase()).join("-"),uppercase:(e,t)=>(e+!t?"":"."+t).toUpperCase(),lowercase:(e,t)=>(e+!t?"":"."+t).toLowerCase()}},DEFAULT_FILE_HEADER=`\nThis file was automatically generated by Chromatic.\nDo not edit.\nGenerated ${(new Date).toISOString()}\n`;var _a;const chalk=require("chalk"),ciInfo=require("ci-info");let gUseColor=null!=(_a=process.stdout.isTTY)&&_a&&!ciInfo.isCI;const terminal={useColor:e=>{gUseColor=e},autoFormat:e=>e.replace(/("(.*)")/g,e=>terminal.string(e.slice(1,-1))).replace(/(`(.*)`)/g,e=>terminal.keyword(e)),success:(e="")=>(chalk.green("✔︎   "+e),gUseColor?chalk.bold.green("✔︎   "+e):"✔︎   "+e),error:(e="")=>gUseColor?chalk.hex("#fa2040")(chalk.bold("✘   "+e)):"✘   "+e,warning:(e="")=>gUseColor?chalk.hex("#ffcc00")(chalk.bold("⚠️   "+e)):"⚠   "+e,path:(e="")=>gUseColor?chalk.hex("#6ab3ff").italic(e):e,keyword:(e="")=>gUseColor?chalk.hex("#ffcc00")(e):e,string:(e="")=>gUseColor?chalk.hex("#ffcc00")('"'+chalk.italic(e)+'"'):'"'+e+'"',dim:(e="")=>gUseColor?chalk.hex("#999")(e):e,time:(e=new Date)=>gUseColor?chalk.hex("#d1d7ff")(`[${e.toLocaleTimeString()}]`):"["+e+"]",link:e=>gUseColor?"\n▷   "+chalk.hex("#d1d7ff")("https://github.com/arnog/chromatic/docs/errors/"+e+".md"):"\n▷   https://github.com/arnog/chromatic/docs/errors/"+e+".md"},colorName=require("color-name"),chroma=require("chroma-js");function clampByte(e){return e<0?0:e>255?255:Math.round(e)}function hueToRgbChannel(e,t,r){return r<0&&(r+=6),r>=6&&(r-=6),r<1?(t-e)*r+e:r<3?t:r<4?(t-e)*(4-r)+e:e}function hslToRgb(e,t,r){e/=60;const n=r<=.5?r*(t+1):r+t-r*t,o=2*r-n;return{r:Math.round(255*hueToRgbChannel(o,n,e+2)),g:Math.round(255*hueToRgbChannel(o,n,e)),b:Math.round(255*hueToRgbChannel(o,n,e-2))}}function rgbToHsl(e,t,r){e/=255,t/=255,r/=255;const n=Math.min(e,t,r),o=Math.max(e,t,r),a=o-n;let i,s;o===n?i=0:e===o?i=(t-r)/a:t===o?i=2+(r-e)/a:r===o&&(i=4+(e-t)/a),(i=Math.min(60*i,360))<0&&(i+=360);const l=(n+o)/2;return{h:i,s:s=o===n?0:l<=.5?a/(o+n):a/(2-o-n),l:l}}function labToRgb(e,t,r){let n=(100*e+16)/116,o=t/500+n,a=n-r/200,i=3.2406*(o=.95047*(o*o*o>.008856?o*o*o:(o-16/116)/7.787))+-1.5372*(n=1*(n*n*n>.008856?n*n*n:(n-16/116)/7.787))+-.4986*(a=1.08883*(a*a*a>.008856?a*a*a:(a-16/116)/7.787)),s=-.9689*o+1.8758*n+.0415*a,l=.0557*o+-.204*n+1.057*a;return i=i>.0031308?1.055*Math.pow(i,1/2.4)-.055:12.92*i,s=s>.0031308?1.055*Math.pow(s,1/2.4)-.055:12.92*s,l=l>.0031308?1.055*Math.pow(l,1/2.4)-.055:12.92*l,{r:clampByte(255*i),g:clampByte(255*s),b:clampByte(255*l)}}function roundTo(e,t){return Math.round(e*Math.pow(10,t)+1e-14)/Math.pow(10,t)}class Value{constructor(){this.source=""}css(){return""}type(){}canonicalScalar(){return 0}getSource(){return this.source}setSource(e){this.source=e}}class Percentage extends Value{constructor(e){super(),this.value=e}css(){return roundTo(this.value,2)+"%"}type(){return"percentage"}canonicalScalar(){return this.value/100}}class Angle extends Value{constructor(e,t){super(),this.value=e,this.unit=t}css(){return roundTo(this.value,2)+this.unit}type(){return"angle"}canonicalScalar(){return asDegree(this)}}class Length extends Value{constructor(e,t){super(),this.value=e,this.unit=t}css(){return roundTo(this.value,2)+this.unit}type(){return"length"}canonicalScalar(){return asPx(this)}}class Time extends Value{constructor(e,t){super(),this.value=e,this.unit=t}css(){return roundTo(this.value,2)+this.unit}type(){return"time"}canonicalScalar(){return"ms"===this.unit?this.value/1e3:this.value}}class Frequency extends Value{constructor(e,t){super(),this.value=e,this.unit=t}css(){return roundTo(this.value,2)+this.unit}type(){return"frequency"}canonicalScalar(){return"khz"===this.unit?1e3*this.value:this.value}}class Float extends Value{constructor(e){super(),this.value=e}css(){return Number(this.value).toString()}type(){return"float"}canonicalScalar(){return this.value}}class StringValue extends Value{constructor(e){super(),this.value=e}css(e=""){return e+this.value+e}type(){return"string"}canonicalScalar(){return parseFloat(this.value)}}class Color extends Value{constructor(e){if(super(),"string"==typeof e)if("transparent"===e.toLowerCase())[this.r,this.g,this.b,this.a]=[0,0,0,0],[this.h,this.s,this.l]=[0,0,0];else{const t=function(e){if(!e)return;if("#"!==e[0])return;let t;return(e=e.slice(1)).length<=4?(t={r:parseInt(e[0]+e[0],16),g:parseInt(e[1]+e[1],16),b:parseInt(e[2]+e[2],16)},4===e.length&&(t.a=parseInt(e[3]+e[3],16)/255)):(t={r:parseInt(e[0]+e[1],16),g:parseInt(e[2]+e[3],16),b:parseInt(e[4]+e[5],16)},8===e.length&&(t.a=parseInt(e[6]+e[7],16)/255)),t&&void 0===t.a&&(t.a=1),t}(e)||function(e){const t=colorName[e.toLowerCase()];if(t)return{r:t[0],g:t[1],b:t[2],a:1}}(e);console.assert(t),Object.assign(this,t),Object.assign(this,rgbToHsl(this.r,this.g,this.b))}else Object.assign(this,e),"number"==typeof this.r?Object.assign(this,rgbToHsl(this.r,this.g,this.b)):(console.assert("number"==typeof this.h),this.h=(this.h+360)%360,this.s=Math.max(0,Math.min(1,this.s)),this.l=Math.max(0,Math.min(1,this.l)),Object.assign(this,hslToRgb(this.h,this.s,this.l)));"number"!=typeof this.a&&(this.a=1)}type(){return"color"}opaque(){return new Color({r:this.r,g:this.g,b:this.b})}luma(){let e=this.r/255,t=this.g/255,r=this.b/255;return.2126*(e=e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4))+.7152*(t=t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4))+.0722*(r<=.03928?r/12.92:Math.pow((r+.055)/1.055,2.4))}hex(){let e=((1<<24)+(clampByte(this.r)<<16)+(clampByte(this.g)<<8)+clampByte(this.b)).toString(16).slice(1);return this.a<1&&(e+=("00"+Math.round(255*this.a).toString(16)).slice(-2)),e[0]===e[1]&&e[2]===e[3]&&e[4]===e[5]&&e[6]===e[7]&&(e=e[0]+e[2]+e[4]+(this.a<1?e[6]:"")),"#"+e}rgb(){return`rgb(${this.r}, ${this.g}, ${this.b}${this.a<1?", "+Number(100*this.a).toFixed(0)+"%":""})`}hsl(){return`hsl(${this.h}deg, ${this.s}%, ${this.l}%, ${this.a<1?", "+Number(100*this.a).toFixed(0)+"%":""})`}css(){return 0===this.r&&0===this.g&&0===this.b&&0===this.a?"transparent":this.a<1?this.rgb():this.hex()}canonicalScalar(){return this.luma()}}class ArrayValue extends Value{constructor(e){super(),this.value=e.map(e=>makeValueFrom(e))}get(e){return this.value[e]}type(){return"array"}css(){return'"['+this.value.map(e=>e.css()).join(", ")+']"'}}function isFloat(e){return e instanceof Float}function assertFloat(e){console.assert(e instanceof Float)}function isPercentage(e){return e instanceof Percentage}function isLength(e){return e instanceof Length}function isString(e){return e instanceof StringValue}function isAngle(e){return e instanceof Angle}function makeValueFrom(e){switch(e.type()){case"color":return new Color(e);case"frequency":return new Frequency(e.value,e.unit);case"time":return new Time(e.value,e.unit);case"angle":return new Angle(e.value,e.unit);case"string":return new StringValue(e.value);case"length":return new Length(e.value,e.unit);case"percentage":return new Percentage(e.value);case"float":return new Float(e.value);case"array":return new ArrayValue(e.value.map(makeValueFrom));default:console.error("Unknown value type")}}function asColor(e){if(!e)return;let t;try{t=new Color(e)}catch(e){t=void 0}return t}function asDecimalByte(e){return isPercentage(e)?Math.round(255*e.value/100):(assertFloat(e),Math.round(e.value))}function asInteger(e,t){return isFloat(e)?Math.round(e.value):(void 0===t&&assertFloat(e),t)}function asDecimalRatio(e,t){return isPercentage(e)?e.value/100:isFloat(e)?e.value:(void 0===t&&(r=e,console.assert(r instanceof Float||r instanceof Percentage)),t);var r}function asDegree(e){return isAngle(e)?"deg"===e.unit?e.value:"rad"===e.unit?180*e.value/Math.PI:"grad"===e.unit?180*e.value/200:"turn"===e.unit?360*e.value:void throwError(ErrorCode.UnknownUnit,e.unit):(assertFloat(e),e.value)}function asPx(e,t){if(isLength(e)){if("px"===e.unit)return e.value;if("cm"===e.unit)return 96*e.value/2.54;if("mm"===e.unit)return 96*e.value/25.4;if("Q"===e.unit)return 96*e.value/2.54/40;if("in"===e.unit)return 96*e.value;if("pc"===e.unit)return 16*e.value;if("pt"===e.unit)return 96*e.value/72;if("rem"===e.unit&&t["base-font-size"])return e.value*t["base-font-size"];if(/^(rem|em|ex|ch|vw|vh|vmin|vmax)/.test(e.unit))throw new Error(`Relative unit "${e.unit}" cannot be evaluated. Use an absolute unit (px, pt, etc...)`);this.error(ErrorCode.UnknownUnit,e.unit)}return assertFloat(e),e.value}function asPercent(e){return isPercentage(e)?e.value/100:(assertFloat(e),e.value)}function compareValue(e,t){return t.canonicalScalar()-e.canonicalScalar()}const whiteColor=new Color("#fff"),blackColor=new Color("#000");function scaleColor(e,t,r,n){var o,a;let i,s=new Color("#fff"),l=new Color("#000"),c=10;if("color"===(null===(o=r)||void 0===o?void 0:o.type()))s=asColor(e),i=asColor(t),l=asColor(r),c=asInteger(n,10);else if("color"===(null===(a=t)||void 0===a?void 0:a.type()))s=asColor(e),i=asColor(t),l=asColor(t),c=asInteger(r,10);else if("color"===e.type()){i=asColor(e),l=new Color({h:i.h>=60&&i.h<=240?i.h+30:i.h-30,s:i.s,l:.35}),c=asInteger(t,10);const r=new StringValue("rgb");return new ArrayValue([FUNCTIONS.mix(s,i,new Float(.12),r),FUNCTIONS.mix(s,i,new Float(.3),r),FUNCTIONS.mix(s,i,new Float(.5),r),FUNCTIONS.mix(s,i,new Float(.7),r),FUNCTIONS.mix(s,i,new Float(.85),r),i,FUNCTIONS.mix(l,i,new Float(.85),r),FUNCTIONS.mix(l,i,new Float(.7),r),FUNCTIONS.mix(l,i,new Float(.5),r),FUNCTIONS.mix(l,i,new Float(.2),r)])}if(!s||!i||!l)return;const u=chroma.scale([s.opaque().hex(),i.opaque().hex(),l.opaque().hex()]).mode("lab").correctLightness().colors(c+1);return new ArrayValue(u.map(e=>new Color(e)))}let FUNCTIONS={};FUNCTIONS={calc:e=>e,rgb:(e,t,r,n)=>new Color({r:asDecimalByte(e),g:asDecimalByte(t),b:asDecimalByte(r),a:asDecimalRatio(n,1)}),hsl:(e,t,r,n)=>new Color({h:asDegree(e),s:asPercent(t),l:asPercent(r),a:asDecimalRatio(n,1)}),hsv:(e,t,r,n)=>{let o=asPercent(t);const a=asPercent(r),i=(2-o)*a/2;return 0!=i&&(o=1==i?0:i<.5?o*a/(2*i):o*a/(2-2*i)),new Color({h:asDegree(e),s:o,l:i,a:asDecimalRatio(n,1)})},hwb:(e,t,r,n)=>new Color(Object.assign({a:asDecimalRatio(n,1)},function(e,t,r){const n=hslToRgb(e,1,.5),o=[];o[0]=n.r/255,o[1]=n.g/255,o[2]=n.b/255;const a=t+r;a>1&&(t=Number((t/a).toFixed(2)),r=Number((r/a).toFixed(2)));for(let e=0;e<3;e++)o[e]*=1-t-r,o[e]+=t,o[e]=Number(255*o[e]);return{r:o[0],g:o[1],b:o[2]}}(asDegree(e),asPercent(t),asPercent(r)))),lab:(e,t,r,n)=>new Color(Object.assign({a:asDecimalRatio(n,1)},labToRgb(asPercent(e),asDecimalRatio(t),asDecimalRatio(r)))),gray:(e,t)=>new Color(Object.assign({a:asDecimalRatio(t,1)},labToRgb(asPercent(e),0,0))),min:(e,t)=>compareValue(e,t)<0?e:t,max:(e,t)=>compareValue(e,t)<0?t:e,clamp:(e,t,r)=>compareValue(t,e)<0?e:compareValue(t,r)>0?r:t,mix:(e,t,r,n)=>{const o=function(e,t){return isString(e)?e.value:"hsl"}(n).toLowerCase(),a=asColor(e);if(!a)return;const i=asColor(t);if(!i)return a;const s=asDecimalRatio(r,.5);let l="number"==typeof i.a?i.a:1;return l+=(("number"==typeof a.a?i.a:1)-l)*s,"rgb"===o?new Color({r:a.r+(i.r-a.r)*s,g:a.g+(i.g-a.g)*s,b:a.b+(i.b-a.b)*s,a:l}):"hsl"===o?new Color({h:a.h+(i.h-a.h)*s,s:a.s+(i.s-a.s)*s,l:a.l+(i.l-a.l)*s,a:l}):void 0},saturate:(e,t)=>{const r=asColor(e);if(r)return new Color({h:r.h,s:r.s+(1-r.s)*asDecimalRatio(t,.1),l:r.l,a:r.a})},desaturate:(e,t)=>{const r=asColor(e);if(r)return new Color({h:r.h,s:r.s-r.s*asDecimalRatio(t,.1),l:r.l,a:r.a})},lighten:(e,t)=>{const r=asColor(e);if(r)return new Color({h:r.h,s:r.s,l:r.l+(1-r.l)*asDecimalRatio(t,.1),a:r.a})},darken:(e,t)=>{const r=asColor(e);if(r)return new Color({h:r.h,s:r.s,l:r.l-r.l*asDecimalRatio(t,.1),a:r.a})},rotateHue:(e,t)=>{const r=asColor(e);if(r)return t&&(isAngle(t)||isFloat(t))?new Color({h:(r.h+asDegree(t)+360)%360,s:r.s,l:r.l,a:r.a}):r},complement:e=>{const t=asColor(e);if(t)return new Color({h:(t.h+180)%360,s:t.s,l:t.l,a:t.a})},contrast:(e,t,r)=>{const n=asColor(e),o=asColor(t)||blackColor,a=asColor(r)||whiteColor;let i,s;const l=n.luma(),c=o.luma(),u=a.luma();return(i=l>c?(l+.05)/(c+.05):(c+.05)/(l+.05))>(s=l>u?(l+.05)/(u+.05):(u+.05)/(l+.05))?o:a},rgba:(e,t,r,n)=>FUNCTIONS.rgb(e,t,r,n),hsla:(e,t,r,n)=>FUNCTIONS.hsl(e,t,r,n),tint:(e,t)=>FUNCTIONS.mix(whiteColor,e,null!=t?t:new Float(.1)),shade:(e,t)=>FUNCTIONS.mix(blackColor,e,null!=t?t:new Float(.1)),scale:(e,t,r,n)=>scaleColor(e,t,r,n)};const colorFunctions=["rgb","rgba","hsl","hsla","hwb","grey","lab"],FUNCTION_ARGUMENTS={calc:"any",rgb:"float|percentage, float|percentage, float|percentage,float|percentage|none",rgba:"float|percentage, float|percentage, float|percentage,float|percentage|none",hsl:"float|angle, float|percentage, float|percentage, float|percentage|none",hsla:"float|angle, float|percentage, float|percentage, float|percentage|none",hsv:"float|angle, float|percentage, float|percentage, float|percentage|none",hwb:"float|angle, float|percentage, float|percentage, float|percentage|none",gray:"float|percentage, float|percentage|none",min:"any, any",max:"any, any",clamp:"any, any, any",mix:"color, color, float|percentage|none, string|none",saturate:"color, float|percentage|none",desaturate:"color, float|percentage|none",lighten:"color, float|percentage|none",darken:"color, float|percentage|none",rotateHue:"color, angle|float|none",complement:"color",contrast:"color, color|none, color|none",tint:"color, float|percentage|none",shade:"color, float|percentage|none"};class Stream{constructor(e,t={}){this.s="",this.index=0,this.options={},this.s=e,this.index=0,this.options=t}isEOF(){return this.index>=this.s.length}lookAhead(e){return this.s.slice(this.index,this.index+e)}skipWhiteSpace(){this.match(/^\s*/)}match(e){if("string"==typeof e){if(this.lookAhead(e.length)===e)return this.index+=e.length,e}else{const t=this.s.slice(this.index).match(e);if(t&&t[0])return this.index+=t[0].length,t[1]||!0}}error(e,...t){var r,n,o,a;const i=null!=(n=null===(r=this.s.slice(0,this.index).match(/^(.*)/))||void 0===r?void 0:r[1])?n:"",s=null!=(a=null===(o=this.s.slice(this.index).match(/(.*)$/))||void 0===o?void 0:o[1])?a:"";throwErrorWithContext([i+terminal.dim(s)," ".repeat(i.length)+"⇧"],e,...t)}parseUnit(e){if(this.match("%"))return new Percentage(e);let t=this.match(/^(em|ex|ch|rem|vw|vh|vmin|vmax|px|cm|mm|in|pt|pc|Q)/);return t?new Length(e,t):(t=this.match(/^(deg|°|rad|grad|turn)/))?new Angle(e,"°"===t?"deg":t):(t=this.match(/^(ms|s)/))?new Time(e,t):(t=this.match(/^(kHz|Hz)/))?new Frequency(e,t):new Float(e)}parseIndex(e){let t=e;if(this.match("["))if("array"!==e.type())this.error(ErrorCode.UnexpectedOpenBracket);else{const r=asInteger(this.parseExpression(),NaN);isNaN(r)&&this.error(ErrorCode.ExpectedIntegerIndex),t=e.get(r),this.skipWhiteSpace(),this.match("]")||this.error(ErrorCode.ExpectedCloseBracket)}return t}parseLiteral(){var e,t,r;let n;const o=this.index,a=this.match(/^([0-9]*\.[0-9]+|\.?[0-9]+)/);if(a&&(n=this.parseUnit(parseFloat(a))),!n&&this.match("[")){const e=[];for(;"]"!==this.lookAhead(1)&&!this.isEOF();){const t=this.parseExpression();t||this.error(ErrorCode.SyntaxError),e.push(t),this.match(/^(\s*,?|\s+)/)}return this.isEOF()&&this.error(ErrorCode.ExpectedCloseBracket),this.match("]"),new ArrayValue(e)}if(!n&&this.match('"')){let e="";for(;'"'!==this.lookAhead(1)&&!this.isEOF();)"\\"===this.lookAhead(1)?(e+=this.s[this.index+1],this.index+=2):(e+=this.s[this.index],this.index+=1);return this.isEOF()&&this.error(ErrorCode.ExpectedQuote),this.match('"'),new StringValue(e)}if(!n&&this.match("{")){const o=this.match(/^([a-zA-Z0-9\._-]+)/);if(o){if(!(n=null===(e=this.options)||void 0===e?void 0:e.aliasResolver(o))){const e=o.match(/^(.+)-([0-9]+)$/);if(e){const o=asColor(null===(t=this.options)||void 0===t?void 0:t.aliasResolver(e[1]));if(o){const t=Math.round(parseInt(e[2])/100);n=null===(r=scaleColor(o))||void 0===r?void 0:r.get(t)}}}n?(n=makeValueFrom(n)).setSource("{"+o+"}"):n=new StringValue("{"+o+"}")}this.match("}")}return n||(n=asColor(this.match(/^\s*(#[0-9a-fA-F]{3,8})/))),n||(this.index=o,n=asColor(this.match(/^\s*([a-zA-Z]+)/))),n||(this.index=o),n}parseColorArguments(){const e=[];if(this.skipWhiteSpace(),!this.match("("))return;let t=this.parseExpression();if(t){if(e.push(t),!this.match(/^(\s*,?|\s+)/))return this.match(")"),e;if(t=this.parseExpression()){if(e.push(t),!this.match(/^(\s*,?|\s+)/))return this.match(")"),e;if(t=this.parseExpression()){if(e.push(t),!this.match(/^(\s*,?|\s+|\s*\/)/))return this.match(")"),e;(t=this.parseExpression())&&e.push(t)}}}return this.match(")"),e}parseArguments(){if(this.skipWhiteSpace(),!this.match("("))return;const e=[];for(;")"!==this.lookAhead(1)&&!this.isEOF();){const t=this.parseExpression();t||this.error(ErrorCode.SyntaxError),e.push(t),this.match(/^(\s*,?|\s+)/)}return this.isEOF()&&this.error(ErrorCode.ExpectedCloseParen),this.match(")"),e}parseCall(){const e=this.index,t=this.match(/^([a-zA-Z\-]+)/);if(t)if(FUNCTIONS[t]){const e=colorFunctions.includes(t)?this.parseColorArguments():this.parseArguments();if(e){try{!function(e,t){var r;const n=null===(r=FUNCTION_ARGUMENTS[e])||void 0===r?void 0:r.split(",").map(e=>e.trim());if(n&&(n.forEach((r,n)=>{var o;const a=r.split("|").map(e=>e.trim());if(!a.includes("none")&&!t[n])throw new SyntaxError(ErrorCode.MissingArgument,String(n+1),e,a.join(", "));if(t[n]&&!a.includes("any")&&!a.includes(null===(o=t[n])||void 0===o?void 0:o.type()))throw new SyntaxError(ErrorCode.ExpectedArgument,String(n+1),e,a.join(", "))}),t.length>n.length))throw new SyntaxError(ErrorCode.TooManyArguments,e,n.join(", "))}(t,e)}catch(e){e.code?this.error(e.code,...e.args):this.error(e.message)}return FUNCTIONS[t](...e)}this.error(ErrorCode.SyntaxError)}else"("===this.lookAhead(1)&&this.error(ErrorCode.UnknownFunction,t,getSuggestion(t,FUNCTIONS));this.index=e}parseProduct(){let e=this.parseCall()||this.parseGroup()||this.parseLiteral();if(!e)return e;e=this.parseIndex(e);const t=this.index;this.skipWhiteSpace();const r=this.match(/^([*|/])/);if(r){this.skipWhiteSpace();const t=this.parseProduct();if(t||this.error(ErrorCode.ExpectedOperand),!isFloat(t))return new Float("*"===r?e.canonicalScalar()*t.canonicalScalar():e.canonicalScalar()/t.canonicalScalar());if(isFloat(e))return new Float("*"===r?e.value*t.value:e.value/t.value);if(isPercentage(e))return new Percentage(100*("*"===r?asPercent(e)*t.value:asPercent(e)/t.value));if(isLength(e))return new Length("*"===r?e.value*t.value:e.value/t.value,e.unit);if(isAngle(e))return new Angle("*"===r?e.value*t.value:e.value/t.value,e.unit);if(e instanceof Frequency)return new Frequency("*"===r?e.value*t.value:e.value/t.value,e.unit);if(function(e){return e instanceof Time}(e))return new Time("*"===r?e.value*t.value:e.value/t.value,e.unit);this.error(ErrorCode.InvalidOperand)}else this.index=t;return e}parseTerm(){const e=this.parseProduct(),t={"+":(e,t)=>e+t,"-":(e,t)=>e-t}[this.match(/^\s*([+\-])\s*/)];if(t){const r=this.parseProduct();if(r||this.error(ErrorCode.ExpectedOperand),e){if(isString(e)||isString(r))return new StringValue(t(e.css(),r.css()));if(isPercentage(e)&&isPercentage(r))return new Percentage(100*t(asPercent(e),asPercent(r)));if(isFloat(e)&&isFloat(r))return new Float(t(e.value,r.value));if(isAngle(e)&&isAngle(r))return e.unit===r.unit?new Angle(t(e.value,r.value),e.unit):new Angle(t(asDegree(e),asDegree(r)),"deg");if(isLength(e)&&isLength(r))return e.unit===r.unit?new Length(t(e.value,r.value),e.unit):new Length(t(asPx(e,this.options),asPx(r,this.options)),"px");this.error(ErrorCode.InvalidOperand)}else{if(isPercentage(r))return new Percentage(100*t(0,asPercent(r)));if(isFloat(r))return new Float(t(0,r.value));if(isAngle(r))return new Angle(t(0,r.value),r.unit);if(isLength(r))return new Length(t(0,r.value),r.unit);this.error(ErrorCode.InvalidUnaryOperand)}}return e}parseGroup(){let e;return this.match("(")&&(e=this.parseExpression(),this.skipWhiteSpace(),this.match(")")||this.error(ErrorCode.ExpectedCloseParen)),e&&isFloat(e)&&(e=this.parseUnit(e.value)),e}parseExpression(){return this.skipWhiteSpace(),this.parseTerm()}}function sanitizePropertyNameForCSS(e){return e.replace(/[^a-zA-Z0-9_-]/g,"-")}function renderSassProperty(e){return`${e.definition.comment?"// "+e.definition.comment+"\n":""}$${sanitizePropertyNameForCSS(e.propertyName)}: ${e.propertyValue} !default;`}const WebFormats={formats:{sass:{ext:".scss",renderFile:e=>(e.header?"/* "+e.header.split("\n").join("\n * ")+"\n */\n\n":"")+e.content,renderProperty:renderSassProperty,renderGroup:function(e){let t="";const r={},n=[];return e.definitions.forEach((e,t)=>{Object.keys(e.value).length>1?Object.keys(e.value).forEach(e=>{r[e]||(r[e]=[]),r[e].push(t)}):n.push(t)}),Object.keys(r).forEach(n=>{const o=r[n].map(t=>(function(e){return`--${sanitizePropertyNameForCSS(e.propertyName)}: ${e.propertyValue};`})(Object.assign(Object.assign({},e),{theme:n,category:"",token:t,definition:e.definitions.get(t),propertyName:t,propertyValue:e.values.get(t+("_"===n?"":"."+n))}))).join("\n\t");t+="_"===n?`:root {\n\t${o}\n}\n`:`body[data-theme="${n}"] {\n\t${o}\n}\n`}),t+=n.map(t=>renderSassProperty(Object.assign(Object.assign({},e),{category:"",theme:"",token:t,definition:e.definitions.get(t),propertyName:t,propertyValue:e.values.get(t)}))).join("\n")}},plist:{ext:".plist",renderFile:e=>'\n<?xml version="1.0" encoding="UTF-8"?>\n<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">\n\n'+(e.header?"\x3c!-- \n"+e.header+"\n--\x3e\n\n":"")+e.content,renderGroup:e=>`<plist version="1.0"><dict>\n\t${e.properties.join("\n\t")}\n</dict></plist>`,renderProperty:e=>`${e.definition.comment?"\x3c!-- "+e.definition.comment+" --\x3e\n\t":""}<key>${e.propertyName}</key>\n\t<string>${e.propertyValue}</string> `,valueFormatters:["color/plist"]}}},marked=require("marked"),highlight=require("highlight.js"),handlebars=require("handlebars"),fs=require("fs");function renderFragment(e){let t="";const r={colors:[],group:""};return e.themes.forEach(n=>{r.group=1===e.themes.length?"":"_"===n?"Base":n,r.colors=[],e.definitions.forEach((t,o)=>{var a,i;if(t.value[n]){const s=o+("_"===n?"":"."+n),l=e.rawValues.get(s);if("color"===l.type()){const e=l;let n,s=e.luma()>=1?"frame ":"";e.luma()>.42&&(s+="light"),e.a<1&&((n=new Color(e)).a=1),r.colors.push({name:o,def:t.value,source:e.getSource(),value:e.css(),comment:(a=t.comment,null!=a?a:""),cls:s,opaqueColor:null===(i=n)||void 0===i?void 0:i.css()})}}}),t+=handlebars.compile(fs.readFileSync(__dirname+"/templates/html-colors.hbs","utf-8"))(r)}),t&&(t="<h2>Colors</h2>"+t),t}const StyleGuideFormat={formats:{"html/fragment":{ext:".html",renderFile:renderFragment,renderGroup:function(e){return renderFragment(e)},renderProperty:function(e){let t="";return t+=`<b>${e.propertyName}</b>: ${e.propertyValue}`,e.definition.comment&&(t+=`<p>${e.definition.comment}</p>`),e.definition.remarks&&(t+=marked(e.definition.remarks)),t}},html:{extends:"html/fragment",renderFile:function(e){return handlebars.compile(fs.readFileSync(__dirname+"/templates/html-file.hbs","utf-8"))(e)}}}};marked.setOptions({renderer:new marked.Renderer,highlight:function(e){return highlight.highlightAuto(e).value},pedantic:!1,gfm:!0,breaks:!1,sanitize:!1,smartLists:!0,smartypants:!1,xhtml:!1});const{cosmiconfigSync:cosmiconfigSync}=require("cosmiconfig"),configParser=cosmiconfigSync("chromatic"),glob=require("glob"),fs$1=require("fs-extra"),path=require("path"),yaml=require("yaml"),json5=require("json5"),resolveFrom=require("resolve-from"),gConfig={};let gThemes,gTokenDefinitions,gTokenValues,gRecursiveEvaluationStack,gProcessedFiles,gWatching=!1,gIgnoreErrors=!1;function error(e){var t;"string"==typeof e&&(e=[e]);const r="\n"+[].concat(...e.map(e=>e.split("\n"))).join("\n    ");null===(t=gConfig.console)||void 0===t||t.error(terminal.autoFormat(r)),gWatching||gIgnoreErrors||process.exit(1)}function log(e){var t;null===(t=gConfig.console)||void 0===t||t.log(e)}function mergeObject(e,t){e!==t&&t&&Object.keys(t).forEach(r=>{Array.isArray(t[r])?(e[r]||(e[r]=[]),e[r]=[...e[r],...t[r]]):"object"==typeof t[r]?(e[r]||(e[r]={}),mergeObject(e[r],t[r])):void 0!==t[r]&&(e[r]=t[r])})}function processPath(e){var t,r;const n=[];if(e=path.resolve(path.normalize(e)),gProcessedFiles.includes(e))return;if(gProcessedFiles.push(e),fs$1.lstatSync(e).isDirectory())return void glob.sync(e+"/**/*."+gConfig.tokenFileExt).forEach(processPath);let o;try{const t=fs$1.readFileSync(e,"utf8");o=/^\.json/.test(path.extname(e))?json5.parse(t):yaml.parse(t)}catch(e){n.push((e.name?e.name+": ":"")+e.message)}if((null===(t=o)||void 0===t?void 0:t.import)&&("string"==typeof o.import&&(o.import=[o.import]),Array.isArray(o.import)?o.import.forEach(t=>{let r=e;try{processPath(r=resolveFrom(path.parse(e).dir,t))}catch(e){n.push(`option "import: ${t}"`),"MODULE_NOT_FOUND"===e.code?n.push("Module not found."+("./"===t.slice(0,2)?"":`\nTo import as a file, use a relative path: "./${t}"`)):"ENOENT"===e.code?n.push("→ "+terminal.path(r)+"\nFile not found."):n.push(e.message)}}):n.push('Option "import" should be a path or an array of paths')),o&&gConfig.verbose&&(o.imports||o.extends||o.include||o.includes)&&!o.import&&log(terminal.warning()+terminal.path(path.relative("",e))+`\n${terminal.warning("Warning:")} use the \`"import"\` property to import other token files`),null===(r=o)||void 0===r?void 0:r.tokens)try{"object"!=typeof o.tokens?throwError(ErrorCode.UnexpectedTokensType):function e(t,r,n){Array.isArray(n)&&throwError(ErrorCode.UnexpectedTokensArray,terminal.link("tokens-as-array")),Object.keys(n).forEach(o=>{var a;const i=(r?r+".":"")+o;/^[a-zA-Z0-9_-]+$/.test(o)||throwError(ErrorCode.InvalidTokenName,i),n[o]||throwError(ErrorCode.InvalidTokenValue,o);try{const r=function(e,t){if("string"!=typeof t&&("object"!=typeof t||!t.value))return;let r={value:{}};return"string"==typeof t?r.value._=t:r=Object.assign({},t),"string"==typeof r.value&&(r.value={_:r.value}),e&&r.value._&&(r.value[e]=r.value._,r.value._=void 0),Object.keys(r.value).forEach(e=>{gThemes.includes(e)||gThemes.push(e)}),r}(null!=(a=t.theme)?a:gConfig.defaultTheme,n[o]);if(r)if(gTokenDefinitions.has(i)){r.type&&gTokenDefinitions.get(i).type&&gTokenDefinitions.get(i).type!==r.type&&throwError(ErrorCode.InconsistentTokenType,r.type,gTokenDefinitions.get(i).type);const e=gTokenDefinitions.get(i);mergeObject(e,r),gTokenDefinitions.set(i,e)}else gTokenDefinitions.set(i,r);else e(t,i,n[o])}catch(e){throw new Error(`${i}: "${n[o]}"\n${e.message}`)}})}(o,"",o.tokens)}catch(e){n.push(e.message)}gConfig.verbose&&0===n.length&&log(terminal.success()+"← "+terminal.path(path.relative("",e))),n.length>0&&error([terminal.error()+terminal.path(path.relative("",e)),...n])}function renderFile$1(e,t){const r=[],n=[];gTokenDefinitions.forEach((e,r)=>{Object.keys(e.value).forEach(e=>{t.themes.includes(e)&&n.push("_"===e?r:r+"."+e)})});const o=function(e,t){if(!t)return;const r=new Map;return e.forEach(e=>{try{r.set(e,t(gTokenValues.get(e)))}catch(t){error([terminal.error(`Error formatting "${gTokenValues.get(e).css()}" for the "${e}" token`),t.message])}}),r}(n,e.valueFormatter);o.forEach((e,t)=>{const r=e.replace(/{[a-zA-Z0-9_-]+}/g,e=>{const t=e.slice(1,-1);return o.has(t)?o.get(t):(error(terminal.error("Unresolved alias. ")+`Cannot find name "${e}"`+getSuggestion(t,o)),e)});r&&o.set(t,r)});const a=[];return t.themes.forEach(n=>{gTokenDefinitions.forEach((i,s)=>{if(void 0===i.value[n])return;const l=e.nameFormatter(s,n);r.includes(l)&&log(l!==s?terminal.warning("Warning: ")+` the "${s}" token has multiple definitions as "${l}"`:terminal.warning("Warning: ")+` the "${s}" token has multiple definitions`),r.push(l);const c=s+("_"===n?"":"."+n);a.push(e.renderProperty(Object.assign(Object.assign({},t),{theme:n,category:"",properties:a,values:o,token:c,definition:i,propertyName:l,propertyValue:o.get(c)})))})}),e.renderFile(Object.assign(Object.assign({},t),{content:e.renderGroup(Object.assign(Object.assign({},t),{category:"",properties:a,values:o}))}))}function build(e,t){var r,n,o,a,i;n=null===(r=t)||void 0===r?void 0:r.watching,gWatching=null!=n&&n,gThemes=[],gTokenDefinitions=new Map,gTokenValues=new Map,gRecursiveEvaluationStack=[],gProcessedFiles=[],e.forEach(e=>{const t=glob.sync(e);0!==t.length?t.forEach(processPath):error(terminal.error("File not found: ")+terminal.path(e))}),gTokenDefinitions.forEach((e,t)=>{Object.keys(e.value).forEach(r=>{const n=t+("_"===r?"":"."+r);let o;try{(o=function e(t,r){if(!r)return;gRecursiveEvaluationStack.includes(t)&&throwError(ErrorCode.CircularDefinition,t),gRecursiveEvaluationStack.push(t);const n=function(e,t={}){const r=new Stream(e,t),n=r.parseExpression();if(r.skipWhiteSpace(),r.isEOF())return n.setSource(e),n}(r,Object.assign(Object.assign({},gConfig),{aliasResolver:r=>{var n,o;if(gTokenValues.has(r))return gTokenValues.get(r);let a;return gTokenDefinitions.has(r)&&(gConfig.defaultTheme&&(a=e(r+"."+gConfig.defaultTheme,null===(n=gTokenDefinitions.get(r))||void 0===n?void 0:n.value[gConfig.defaultTheme])),a||(a=e(r,null===(o=gTokenDefinitions.get(t))||void 0===o?void 0:o.value._))),a}}));return gRecursiveEvaluationStack.pop(),n}(n,e.value[r]))||(o=new StringValue(e.value[r]))}catch(n){error([terminal.error("Syntax error")+` in "${t+": '"+e.value[r]}'"`,n.message]),o=new StringValue(e.value[r])}gTokenValues.set(n,o);const a=o.type();e.type&&a!=e.type&&log(terminal.warning("Warning:")+` Type mismatch. Expected \`${e.type}\` but got \`${a}\` for "${n}" token`)})});try{const e=function(e){const t={fileHeader:DEFAULT_FILE_HEADER,renderFilename:function({theme:e,basename:t}){return t+(e?"-"+e:"")},renderGroup:e=>e.properties.join("\n"),renderFile:e=>e.content};gConfig.formats[e]||throwError(ErrorCode.UnknownFormat,e,getSuggestion(e,gConfig.formats));const r=gConfig.formats[e].extends;return"string"==typeof r?gConfig.formats[r]?(mergeObject(t,gConfig.formats[r]),mergeObject(t,gConfig.formats[e])):throwError(ErrorCode.UnknownFormat,e,getSuggestion(e,gConfig.formats)):mergeObject(t,gConfig.formats[e]),"string"==typeof t.valueFormatter?gConfig.valueFormatters[t.valueFormatter]||throwError(ErrorCode.UnknownValueFormatter,t.valueFormatter,getSuggestion(t.valueFormatter,gConfig.valueFormatters)):"function"!=typeof t.valueFormatter&&(t.valueFormatter=e=>e.css()),"string"==typeof t.nameFormatter?gConfig.nameFormatters[t.nameFormatter]||throwError(ErrorCode.UnknownNameFormatter,t.nameFormatter,getSuggestion(t.nameFormatter,gConfig.nameFormatters)):"function"!=typeof t.nameFormatter&&(t.nameFormatter=(e,t)=>e+(t&&"_"!==t?"-"+t:"")),"function"!=typeof t.renderProperty&&(gConfig.verbose&&log(terminal.warning("Warning: ")+` the "${e}" format does not have a \`propertyTemplate\` function`),t.renderProperty=e=>`${e.propertyName}${e.theme?"-"+e.theme:""}: ${e.propertyValue}`),t}(gConfig.outputFormat);e.fileHeader=null!=(o=t.header)?o:e.fileHeader;const r=(null===(a=t)||void 0===a?void 0:a.output)&&path.resolve(t.output),n=function(e,t){var r;const n={};if(!function(){var e;return(null===(e=gConfig.themes)||void 0===e?void 0:e.length)>0&&(gThemes=gThemes.filter(e=>gConfig.themes.includes(e))),gThemes.forEach(e=>{let t=0;gTokenDefinitions.forEach((r,n)=>{void 0!==r.value[e]&&(t+=1)}),0===t&&gThemes.splice(gThemes.indexOf(e),1)}),0!==gThemes.length&&0!==gTokenDefinitions.size||(error([terminal.error("No tokens found."),'Token files should have a "tokens" property',terminal.link("../guide")]),!1)}())return;const o=null!=(r=e&&path.parse(e))?r:{name:"tokens"},a={filepath:"",themes:[],header:t.fileHeader,definitions:gTokenDefinitions,rawValues:gTokenValues,content:""};return gConfig.splitOutput?gThemes.forEach(e=>{a.filepath=path.format({dir:o.dir,name:t.renderFilename({theme:e,basename:o.name}),ext:t.ext}),a.themes=[e],n[a.filepath]=renderFile$1(t,a)}):(a.filepath=path.format({dir:o.dir,name:t.renderFilename({theme:"",basename:o.name}),ext:t.ext}),a.themes=gThemes,n[a.filepath]=renderFile$1(t,a)),n}(r,e);if(n&&!(null===(i=t)||void 0===i?void 0:i.dryRun)){if(!r)return n;if(gConfig.verbose){let e="";1===gThemes.length&&"_"===gThemes[0]||(e=1===gThemes.length?`for theme "${gThemes[0]}"`:"for themes "+gThemes.map(e=>'"'+e+'"').join(", ")),log(`    Writing ${terminal.string(gConfig.outputFormat)} format ${e}`)}Object.keys(n).forEach(e=>{!function(e,t){const r=path.dirname(t);fs$1.existsSync(r)||fs$1.mkdirsSync(r),fs$1.writeFileSync(t,e),(gConfig.verbose||gWatching)&&log(terminal.success()+(gWatching?terminal.time()+" ":"")+"→ "+terminal.path(path.relative("",t)))}(n[e],e)})}}catch(e){error(terminal.error(e.message))}return{}}function chromatic(e,t){var r,n,o,a,i,s,l,c,u,h,g,p,m,d,f,v,y,C,E,k,b,x,w,F,T,S,O,U;"string"==typeof e&&(e=[e]);let I=configParser.search();null==(n=null===(r=I)||void 0===r?void 0:r.isEmpty)||n||mergeObject(gConfig,I.config),(null===(o=t)||void 0===o?void 0:o.config)&&(null==(i=null===(a=I=configParser.load(t.config))||void 0===a?void 0:a.isEmpty)||i||mergeObject(gConfig,I.config)),(null===(s=t)||void 0===s?void 0:s.themes)&&("string"==typeof t.themes?gConfig.themes=t.themes.split(",").map(e=>e.trim()):Array.isArray(t.themes)&&(gConfig.themes=[...t.themes])),c=null===(l=t)||void 0===l?void 0:l.ignoreErrors,gIgnoreErrors=null!=c&&c;const N=[];if("string"==typeof(null===(u=t)||void 0===u?void 0:u.console)?"log"===(null===(h=t)||void 0===h?void 0:h.console)&&(terminal.useColor(!1),gConfig.console={log:e=>{N.push(e)},error:e=>{N.push(e)}}):gConfig.console=null!=(p=null===(g=t)||void 0===g?void 0:g.console)?p:{log:e=>console.error(e),error:e=>console.error(e)},gConfig.themes||(gConfig.themes=[]),gConfig.tokenFileExt=null!=(v=null!=(d=null===(m=t)||void 0===m?void 0:m.tokenFileExt)?d:null===(f=gConfig)||void 0===f?void 0:f.tokenFileExt)?v:"yaml",gConfig.verbose=null!=(k=null!=(C=null===(y=t)||void 0===y?void 0:y.verbose)?C:null===(E=gConfig)||void 0===E?void 0:E.verbose)&&k,gConfig.splitOutput=t.splitOutput,gConfig.outputFormat=null!=(F=null!=(x=null===(b=t)||void 0===b?void 0:b.format)?x:null===(w=gConfig)||void 0===w?void 0:w.outputFormat)?F:"",!gConfig.outputFormat){const e=(null===(T=t)||void 0===T?void 0:T.output)&&path.extname(null===(S=t)||void 0===S?void 0:S.output);if(e){const t=Object.keys(gConfig.formats).filter(t=>gConfig.formats[t].ext===e);1===t.length?gConfig.outputFormat=t[0]:gConfig.formats[e.slice(1)]?gConfig.outputFormat=e.slice(1):t.length>1&&error([terminal.error("Ambiguous format. ")+`Use ${terminal.keyword("--format")} to indicate which output format to use.`,`Did you mean \`${t.join(", ")}\`?`])}gConfig.outputFormat?gConfig.verbose&&log(terminal.warning()+'Setting the format to "gConfig.outputFormat" based on the output file extension. Use `--format` to indicate which output format to use.'):(gConfig.outputFormat="yaml",log(terminal.warning("Format not specified.")+` Using "${terminal.keyword("yaml")}". `+`Use ${terminal.keyword("--format")} to indicate which output format to use.`))}mergeObject(gConfig.nameFormatters,null===(O=t)||void 0===O?void 0:O.nameFormatters),mergeObject(gConfig.valueFormatters,null===(U=t)||void 0===U?void 0:U.valueFormatters);const j=build(e,t);return N.length>0&&(j.stderr=N.join("\n")),j}mergeObject(gConfig,DefaultFormatters),mergeObject(gConfig,WebFormats),mergeObject(gConfig,{formats:{yaml:{ext:".yaml",renderFile:e=>(e.header?"# "+e.header.split("\n").join("\n# "):"")+"\ntokens:\n"+e.content,renderGroup:e=>"\t"+e.properties.join("\n\t"),renderProperty:e=>`${e.definition.comment?"# "+e.definition.comment+"\n\t":""}${e.propertyName}: "${e.propertyValue.replace(/"/g,'\\"')}"`},json:{ext:".json",renderFile:e=>e.content,renderGroup:e=>"{\n\t"+e.properties.join(",\n\t")+"\n}",renderProperty:e=>`"${e.propertyName}": "${e.propertyValue}"`}}}),mergeObject(gConfig,StyleGuideFormat),module.exports=chromatic;const chokidar=require("chokidar");function logResult(e){console.log(Object.keys(e).map(t=>("stderr"===t?terminal.error():terminal.success())+">>>> "+terminal.path(t)+"\n"+e[t]).join("\n"))}const argv=require("yargs").usage("Usage: $0 file(s) [options]").example("$0 ./assets/tokens.yaml -o ./build/tokens.scss","Generate a Sass file from a design tokens YAML file").option("output",{alias:"o",describe:"Save output to path",type:"path"}).normalize("output").option("format",{alias:"f",describe:"Output format: css|sass|js|yaml|json",type:"string"}).option("header",{describe:"Content inserted at the to of the output file",type:"string"}).option("themes",{describe:"Comma separated list of themes to process",type:"string"}).option("split-output",{describe:"If there are multiple themes, output one file per theme. Otherwise the themes are combined in a single file.",type:"boolean",default:!1}).option("token-file-ext",{describe:"Default file extension of token files",type:"string",default:".yaml"}).option("dry-run",{describe:"Validate the token files, attempt to generate the specified file format, but don't output anything",conflicts:"output",type:"boolean"}).option("config",{describe:"Load config file from path",type:"path"}).normalize("config").option("verbose",{describe:"Display additional information during processing",type:"boolean"}).option("no-color",{describe:"Suppress color output in terminal",type:"boolean"}).option("ignore-errors",{alias:"i",describe:"Attempt to continue when an error is encountered",type:"boolean"}).option("watch",{describe:"Watch for changes to the token files and rebuild",type:"boolean"}).help("h").alias("h","help").epilogue("For more information, see https://github.com/arnog/chromatic/docs/guide.md").strict(!0).argv;if(void 0===process.stdin.isTTY||process.stdin.isTTY)argv._.length<1&&(console.error(terminal.error()+`Expected at least one path to a directory or token file. Use ${terminal.keyword("--help")} for available options.`),process.exit(1)),argv.watch?chokidar.watch(argv._).on("all",(e,t)=>{chromatic(argv._,Object.assign(Object.assign({},argv),{watching:!0})),console.log(terminal.time()+` ${terminal.dim(argv.$0)}: Waiting for changes... ${terminal.dim("Press Ctrl-C to exit.")}`)}):logResult(chromatic(argv._,argv));else{process.stdin.setEncoding("utf-8");let e="";process.stdin.on("readable",(function(){let t;for(;t=process.stdin.read();)e+=t})),process.stdin.on("end",(function(){logResult(chromatic(e,argv))}))}

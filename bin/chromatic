#!/usr/bin/env node
var ErrorCode;!function(e){e[e.NoError=0]="NoError",e[e.SyntaxError=1]="SyntaxError",e[e.UnexpectedOpenBracket=2]="UnexpectedOpenBracket",e[e.ExpectedCloseBracket=3]="ExpectedCloseBracket",e[e.ExpectedCloseCurlyBracket=4]="ExpectedCloseCurlyBracket",e[e.ExpectedOpenParen=5]="ExpectedOpenParen",e[e.ExpectedCloseParen=6]="ExpectedCloseParen",e[e.ExpectedQuote=7]="ExpectedQuote",e[e.UnknownToken=8]="UnknownToken",e[e.UnknownUnit=9]="UnknownUnit",e[e.UnknownFunction=10]="UnknownFunction",e[e.MissingArgument=11]="MissingArgument",e[e.ExpectedArgument=12]="ExpectedArgument",e[e.TooManyArguments=13]="TooManyArguments",e[e.ExpectedOperand=14]="ExpectedOperand",e[e.InvalidOperand=15]="InvalidOperand",e[e.InvalidUnaryOperand=16]="InvalidUnaryOperand",e[e.ExpectedIntegerIndex=17]="ExpectedIntegerIndex",e[e.CircularDefinition=18]="CircularDefinition",e[e.UnexpectedTokensArray=19]="UnexpectedTokensArray",e[e.UnexpectedTokensType=20]="UnexpectedTokensType",e[e.InvalidTokenName=21]="InvalidTokenName",e[e.InvalidTokenValue=22]="InvalidTokenValue",e[e.InconsistentTokenType=23]="InconsistentTokenType",e[e.UnknownFormat=24]="UnknownFormat",e[e.UnknownValueFormatter=25]="UnknownValueFormatter",e[e.UnknownNameFormatter=26]="UnknownNameFormatter"}(ErrorCode||(ErrorCode={}));const ERRORS={[ErrorCode.SyntaxError]:"Syntax error",[ErrorCode.UnexpectedOpenBracket]:"Unexpected `[`",[ErrorCode.ExpectedCloseBracket]:"Expected `]`",[ErrorCode.ExpectedCloseCurlyBracket]:"Expected `}`",[ErrorCode.ExpectedOpenParen]:"Expected `(`",[ErrorCode.ExpectedCloseParen]:"Expected `)`",[ErrorCode.ExpectedQuote]:'Expected `"`',[ErrorCode.UnknownToken]:"Unknown token `%1`%2",[ErrorCode.UnknownUnit]:"Unknown unit `%1`",[ErrorCode.UnknownFunction]:"Unknown function `%1`%2",[ErrorCode.MissingArgument]:"Missing argument %1 of `%2` of type `%3`",[ErrorCode.ExpectedArgument]:"Expected argument %1 of `%2` to be of type `%3`",[ErrorCode.TooManyArguments]:"Too many arguments for function `%1(%2)`",[ErrorCode.ExpectedOperand]:"Expected operand",[ErrorCode.InvalidOperand]:"Invalid operand",[ErrorCode.InvalidUnaryOperand]:"Invalid operand",[ErrorCode.CircularDefinition]:'Circular definition of the "%1" token',[ErrorCode.UnexpectedTokensArray]:'The "tokens" property is an array. It should be a key/value map of tokens.\n%1',[ErrorCode.UnexpectedTokensType]:'The "tokens" property should be a key/value map of tokens.',[ErrorCode.InvalidTokenName]:'Invalid token name "%1": it must only contain digits, letters, "_" and "-"',[ErrorCode.InvalidTokenValue]:'The "%1" token is invalid. If using a YAML file, make sure RGB hex values are within quotes',[ErrorCode.InconsistentTokenType]:'Inconsistent token type in valus of token "%1"',[ErrorCode.UnknownFormat]:'Unknown format "%1"%2',[ErrorCode.UnknownValueFormatter]:'Unknown value formatter "%1"%2',[ErrorCode.UnknownNameFormatter]:'Unknown name formatter "%1"%2',[ErrorCode.ExpectedIntegerIndex]:"Expected array index to be a number"};class SyntaxError extends Error{constructor(e,...r){super(ERRORS[e]),this.code=e,this.args=r}}function throwErrorIf(e,r,...t){e&&throwErrorWithContext(void 0,r,...t)}function throwErrorWithContext(e,r,...t){var n;let o="";throw process.env.TEST?o="[ERR] "+(null!=(n=ErrorCode[r])?n:r):(e&&(o=e.join("\n")+"\n"),o+=ERRORS[r],t.forEach((e,r)=>{o=o.replace(new RegExp(`%${r+1}`,"g"),e)})),new Error(o)}const stringSimilarity=require("string-similarity");function getSuggestion(e,r){const t=function(e,r){if(!e||!r)return"";let t;if(t=r instanceof Map?Array.from(r.keys()):Object.keys(r),0===t.length)return"";const n=stringSimilarity.findBestMatch(e,t);return n.bestMatch.rating>.1?n.bestMatch.target:""}(e,r);return t?`. Did you mean "${t}"?`:""}const DefaultFormatters={nameFormatters:{camelcase:(e,r)=>(e+!r?"":"."+r).toLowerCase().replace(/(?:^\w|[A-Z]|\b\w)/g,(e,r)=>0===r?e.toLowerCase():e.toUpperCase()).replace(/\s+/g,""),kebabcase:(e,r)=>(e+!r?"":"."+r).match(/[A-Z]{2,}(?=[A-Z][a-z0-9]*|\b)|[A-Z]?[a-z0-9]*|[A-Z]|[0-9]+/g).filter(Boolean).map(e=>e.toLowerCase()).join("-"),uppercase:(e,r)=>(e+!r?"":"."+r).toUpperCase(),lowercase:(e,r)=>(e+!r?"":"."+r).toLowerCase()},handlebarsHelpers:{uppercase:e=>e.toUpperCase(),sanitizeCssPropertyName:e=>e.replace(/[^a-zA-Z0-9_-]/g,"-"),cssValue:e=>{var r,t;return null!=(t=null===(r=e)||void 0===r?void 0:r.css())?t:"[MISSING VALUE]"},"remove-last-comma":function(e){const r=e.fn(this).split("\n"),t=r.reduce((e,r,t)=>/,$/.test(r)?t:e,-1);return r.map((e,r)=>r!==t?e:e.slice(0,-1)).join("\n")},comment:function(e,r="/* */"){var t,n;if("string"!=typeof e)return this.comment;if(!e)return"";"string"!=typeof r&&(r="/* */");const o=null!=(n=null===(t=r.match(/(\s*)/))||void 0===t?void 0:t[1])?n:"",a=r.slice(o.length);let[s,i]=a.split(" ");return"/*"===s&&"*/"===i?o+"/* "+e.split("\n").join("\n"+o+" * ")+"\n"+o+" */":(i||(s=r.slice(o.length),i=""),o+s+e.split("\n").join((null!=i?i:"")+"\n"+o+s))}}},DEFAULT_FILE_HEADER=`\nThis file was automatically generated by Chromatic.\nDo not edit.\nGenerated ${(new Date).toISOString()}\n`,colorName=require("color-name");function clampByte(e){return e<0?0:e>255?255:Math.round(e)}class Value{constructor(){this.source=""}css(){return""}type(){}canonicalScalar(){return 0}getSource(){return this.source}setSource(e){this.source=e}equals(e){return this.type()===e.type()&&this.canonicalScalar()==e.canonicalScalar()}}function roundTo(e,r){return Math.round(e*Math.pow(10,r)+1e-14)/Math.pow(10,r)}class Percentage extends Value{constructor(e){super(),this.value=e}css(){return roundTo(this.value,2)+"%"}type(){return"percentage"}canonicalScalar(){return this.value/100}equals(e){if(isLength(e)){const r=promoteToMulti(this),t=promoteToMulti(e);return[...Object.keys(r.value),...Object.keys(t.value)].every(e=>r.value[e]===t.value[e])}return!1}}class Angle extends Value{constructor(e,r){super(),this.value=e,this.unit=r}css(){return roundTo(this.value,2)+this.unit}type(){return"angle"}canonicalScalar(){return asDegree(this)}}class Length extends Value{constructor(e,r){if(super(),"number"==typeof e)this.value=e,this.unit=0===e?"px":r;else if(void 0===r){const r=Object.keys(e).filter(r=>"number"==typeof e[r]&&0!==e[r]);0===r.length?(this.value=0,this.unit="px"):1===r.length?(this.value=e[r[0]],this.unit=r[0]):(this.value=e,this.unit="multi")}else this.value=e,this.unit="multi",console.assert("multi"===r)}css(){if("number"==typeof this.value)return 0===this.value||isNaN(this.value)?Number(this.value).toString():roundTo(this.value,2)+this.unit;const e={};let r=Object.keys(this.value);if(r.length>1){let t=0;r.forEach(r=>{const n=asPx(this.value[r],r);isNaN(n)?"px"!==r&&(e[r]=this.value[r]):t+=n}),0!==t&&(e.px=t)}else e[r[0]]=this.value[r[0]];return r=Object.keys(e),1===r.length?"px"===r[0]&&0===e.px?"0":roundTo(e[r[0]],2)+r[0]:"calc("+r.map(r=>Number(e[r]).toString()+r).join(" + ")+")"}type(){return"length"}canonicalScalar(){return"multi"===this.unit?NaN:asPx(this.value,this.unit)}}class Time extends Value{constructor(e,r){super(),this.value=e,this.unit=r}css(){return roundTo(this.value,2)+this.unit}type(){return"time"}canonicalScalar(){return"ms"===this.unit?this.value/1e3:this.value}}class Frequency extends Value{constructor(e,r){super(),this.value=e,this.unit=r}css(){return roundTo(this.value,2)+this.unit}type(){return"frequency"}canonicalScalar(){return"khz"===this.unit?1e3*this.value:this.value}}class NumberValue extends Value{constructor(e){super(),this.value=e}css(){return Number(this.value).toString()}type(){return"number"}canonicalScalar(){return this.value}}class StringValue extends Value{constructor(e){super(),this.value=e}css(e=""){return e+this.value+e}type(){return"string"}canonicalScalar(){return parseFloat(this.value)}equals(e){return isString(e)&&this.value===e.value}}class ArrayValue extends Value{constructor(e){super(),this.value=e.map(e=>makeValueFrom(e))}get(e){return this.value[e]}type(){return"array"}css(){return"["+this.value.map(e=>e.css()).join(", ")+"]"}equals(e){return isArray(e)&&this.value.length===e.value.length&&this.value.every((r,t)=>r===e.value[t])}}function hueToRgbChannel(e,r,t){return t<0&&(t+=6),t>=6&&(t-=6),t<1?(r-e)*t+e:t<3?r:t<4?(r-e)*(4-t)+e:e}function hslToRgb(e,r,t){e=(e+360)%360/60,t=Math.max(0,Math.min(t,1)),r=Math.max(0,Math.min(r,1));const n=t<=.5?t*(r+1):t+r-t*r,o=2*t-n;return{r:Math.round(255*hueToRgbChannel(o,n,e+2)),g:Math.round(255*hueToRgbChannel(o,n,e)),b:Math.round(255*hueToRgbChannel(o,n,e-2))}}function rgbToHsl(e,r,t){e/=255,r/=255,t/=255;const n=Math.min(e,r,t),o=Math.max(e,r,t),a=o-n;let s,i;o===n?s=0:e===o?s=(r-t)/a:r===o?s=2+(t-e)/a:t===o&&(s=4+(e-r)/a),s=Math.min(60*s,360),s<0&&(s+=360);const l=(n+o)/2;return i=o===n?0:l<=.5?a/(o+n):a/(2-o-n),{h:s,s:i,l:l}}class Color extends Value{constructor(e){if(super(),"string"==typeof e)if("transparent"===e.toLowerCase())[this.r,this.g,this.b,this.a]=[0,0,0,0],[this.h,this.s,this.l]=[0,0,0];else{const r=function(e){if(!e)return;if("#"!==e[0])return;let r;return(e=e.slice(1)).length<=4?(r={r:parseInt(e[0]+e[0],16),g:parseInt(e[1]+e[1],16),b:parseInt(e[2]+e[2],16)},4===e.length&&(r.a=parseInt(e[3]+e[3],16)/255)):(r={r:parseInt(e[0]+e[1],16),g:parseInt(e[2]+e[3],16),b:parseInt(e[4]+e[5],16)},8===e.length&&(r.a=parseInt(e[6]+e[7],16)/255)),r&&void 0===r.a&&(r.a=1),r}(e)||function(e){const r=colorName[e.toLowerCase()];if(r)return{r:r[0],g:r[1],b:r[2],a:1}}(e);if(!r)throw new Error;Object.assign(this,r),Object.assign(this,rgbToHsl(this.r,this.g,this.b))}else Object.assign(this,e),"number"==typeof this.r?Object.assign(this,rgbToHsl(this.r,this.g,this.b)):(console.assert("number"==typeof this.h),this.h=(this.h+360)%360,this.s=Math.max(0,Math.min(1,this.s)),this.l=Math.max(0,Math.min(1,this.l)),Object.assign(this,hslToRgb(this.h,this.s,this.l)));"number"!=typeof this.a&&(this.a=1)}type(){return"color"}opaque(){return new Color({r:this.r,g:this.g,b:this.b})}luma(){let e=this.r/255,r=this.g/255,t=this.b/255;return e=e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4),r=r<=.03928?r/12.92:Math.pow((r+.055)/1.055,2.4),t=t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4),.2126*e+.7152*r+.0722*t}hex(){let e=((1<<24)+(clampByte(this.r)<<16)+(clampByte(this.g)<<8)+clampByte(this.b)).toString(16).slice(1);return this.a<1&&(e+=("00"+Math.round(255*this.a).toString(16)).slice(-2)),e[0]===e[1]&&e[2]===e[3]&&e[4]===e[5]&&e[6]===e[7]&&(e=e[0]+e[2]+e[4]+(this.a<1?e[6]:"")),"#"+e}rgb(){return`rgb(${roundTo(this.r,2)}, ${roundTo(this.g,2)}, ${roundTo(this.b,2)}${this.a<1?", "+roundTo(100*this.a,2)+"%":""})`}hsl(){return`hsl(${this.h}deg, ${this.s}%, ${this.l}%, ${this.a<1?", "+roundTo(100*this.a,2)+"%":""})`}css(){return 0===this.r&&0===this.g&&0===this.b&&0===this.a?"transparent":this.a<1?this.rgb():this.hex()}canonicalScalar(){return this.luma()}equals(e){return isColor(e)&&this.r===e.r&&this.g===e.g&&this.b===e.b&&this.a===e.a}}function makeValueFrom(e){switch(e.type()){case"color":return new Color(e);case"frequency":return new Frequency(e.value,e.unit);case"time":return new Time(e.value,e.unit);case"angle":return new Angle(e.value,e.unit);case"string":return new StringValue(e.value);case"length":return new Length(e.value,e.unit);case"percentage":return new Percentage(e.value);case"number":return new NumberValue(e.value);case"array":return new ArrayValue(e.value.map(makeValueFrom));default:console.error("Unknown value type")}}function isColor(e){return e instanceof Color}function asColor(e){if(!e)return;let r;try{r=new Color(e)}catch(e){r=void 0}return r}function isNumber(e){return e instanceof NumberValue}function assertNumber(e){console.assert(e instanceof NumberValue)}function isPercentage(e){return e instanceof Percentage}function isLength(e){return e instanceof Length}function isString(e){return e instanceof StringValue}function isAngle(e){return e instanceof Angle}function isTime(e){return e instanceof Time}function isFrequency(e){return e instanceof Frequency}function isArray(e){return e instanceof ArrayValue}function isZero(e){return e instanceof NumberValue&&0===e.value}function asInteger(e,r){return isNumber(e)?Math.round(e.value):(void 0===r&&assertNumber(e),r)}function asDecimalRatio(e,r){return isPercentage(e)?e.value/100:isNumber(e)?e.value:(void 0===r&&(t=e,console.assert(t instanceof NumberValue||t instanceof Percentage)),r);var t}function asDegree(e){return isAngle(e)?"deg"===e.unit?e.value:"rad"===e.unit?180*e.value/Math.PI:"grad"===e.unit?180*e.value/200:"turn"===e.unit?360*e.value:void function(e,...r){throwErrorWithContext(void 0,e,...r)}(ErrorCode.UnknownUnit,e.unit):(assertNumber(e),e.value)}function asPx(e,r,t){var n,o,a,s,i,l,u,c,h,g,m;if("number"!=typeof e){console.assert("multi"===r);let o=null!=(n=e.px)?n:0;return Object.keys(e).forEach(e=>{const r=asPx(this.value[e],e,t);if(isNaN(r))return NaN;o+=o}),o}if("px"===r)return e;if("cm"===r)return 96*e/2.54;if("mm"===r)return 96*e/25.4;if("Q"===r)return 96*e/2.54/40;if("in"===r)return 96*e;if("pc"===r)return 16*e;if("pt"===r)return 96*e/72;let p;return p="vmin"===r?Math.min(null!=(a=null===(o=t)||void 0===o?void 0:o.vh)?a:NaN,null!=(i=null===(s=t)||void 0===s?void 0:s.vw)?i:NaN):"vmax"===r?Math.max(null!=(u=null===(l=t)||void 0===l?void 0:l.vh)?u:NaN,null!=(h=null===(c=t)||void 0===c?void 0:c.vw)?h:NaN):null!=(m=null===(g=t)||void 0===g?void 0:g[r])?m:NaN,p*e}function asPercent(e){return isPercentage(e)?e.value/100:(assertNumber(e),e.value)}function asString(e,r){return isString(e)?e.value:r}function compareValue(e,r){return r.canonicalScalar()-e.canonicalScalar()}function promoteToMulti(e){if(isNumber(e))return new Length({px:e.value},"multi");if("multi"===e.unit)return e;const r={};return r[e.unit]=e.value,new Length(r,"multi")}function scaleLength(e,r){if("multi"===e.unit)throw new SyntaxError(ErrorCode.InvalidOperand);const t=asString(r,"pentatonic").toLowerCase();let n={tritonic:[2,3],tetratonic:[2,4],pentatonic:[2,5],golden:[1.618,1],"golden ditonic":[1.618,2]}[t];if(void 0===n){if(n=t.split(":").map(e=>parseFloat(e)),isNaN(n[0])||isNaN(n[1]))throw new SyntaxError(ErrorCode.InvalidOperand);n=[n[1]/n[0],1]}const[o,a]=n,s=e.value*(Math.pow(o,7/a)-Math.pow(o,-2/a))<10||e.value*Math.pow(o,-2/a)<1?2:0,i=[-2,-1,0,1,2,3,4,5,6,7].map(r=>new Length(roundTo(e.value*Math.pow(o,r/a),s),e.unit));return new ArrayValue(i)}var _a;const chalk=require("chalk"),ciInfo=require("ci-info");let gUseColor=null!=(_a=process.stdout.isTTY)&&_a&&!ciInfo.isCI;const terminal={useColor:e=>{gUseColor=e},autoFormat:e=>e.replace(/("(.*)")/g,e=>terminal.string(e.slice(1,-1))).replace(/(`(.*)`)/g,e=>terminal.keyword(e)),success:(e="")=>(chalk.green("✔︎   "+e),gUseColor?chalk.bold.green("✔︎   "+e):"✔︎   "+e),error:(e="")=>gUseColor?chalk.hex("#fa2040")(chalk.bold("✘   "+e)):"✘   "+e,warning:(e="")=>gUseColor?chalk.hex("#ffcc00")(chalk.bold("⚠️   "+e)):"⚠   "+e,path:(e="")=>gUseColor?chalk.hex("#6ab3ff").italic(e):e,keyword:(e="")=>gUseColor?chalk.hex("#ffcc00")(e):e,string:(e="")=>gUseColor?chalk.hex("#ffcc00")('"'+chalk.italic(e)+'"'):'"'+e+'"',dim:(e="")=>gUseColor?chalk.hex("#999")(e):e,time:(e=new Date)=>gUseColor?chalk.hex("#d1d7ff")(`[${e.toLocaleTimeString()}]`):"["+e+"]",link:e=>gUseColor?"\n▷   "+chalk.hex("#d1d7ff")("https://github.com/arnog/chromatic/docs/errors/"+e+".md"):"\n▷   https://github.com/arnog/chromatic/docs/errors/"+e+".md"},chroma=require("chroma-js");function asDecimalByte(e){return isPercentage(e)?Math.round(255*e.value/100):(assertNumber(e),Math.round(e.value))}function labToRgb(e,r,t){let n=(100*e+16)/116,o=r/500+n,a=n-t/200;o=.95047*(o*o*o>.008856?o*o*o:(o-16/116)/7.787),n=1*(n*n*n>.008856?n*n*n:(n-16/116)/7.787),a=1.08883*(a*a*a>.008856?a*a*a:(a-16/116)/7.787);let s=3.2406*o+-1.5372*n+-.4986*a,i=-.9689*o+1.8758*n+.0415*a,l=.0557*o+-.204*n+1.057*a;return s=s>.0031308?1.055*Math.pow(s,1/2.4)-.055:12.92*s,i=i>.0031308?1.055*Math.pow(i,1/2.4)-.055:12.92*i,l=l>.0031308?1.055*Math.pow(l,1/2.4)-.055:12.92*l,{r:clampByte(255*s),g:clampByte(255*i),b:clampByte(255*l)}}function rgbToLab(e,r,t){r/=255,t/=255;let n=(.4124*(e=(e/=255)>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92)+.3576*(r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92)+.1805*(t=t>.04045?Math.pow((t+.055)/1.055,2.4):t/12.92))/.95047,o=(.2126*e+.7152*r+.0722*t)/1,a=(.0193*e+.1192*r+.9505*t)/1.08883;return n=n>.008856?Math.pow(n,1/3):7.787*n+16/116,o=o>.008856?Math.pow(o,1/3):7.787*o+16/116,a=a>.008856?Math.pow(a,1/3):7.787*a+16/116,{L:(116*o-16)/100,a:500*(n-o),b:200*(o-a)}}const whiteColor=new Color("#fff"),blackColor=new Color("#000");function mixColor(e,r,t,n){const o=asString(n,"hsl").toLowerCase(),a=asColor(e);if(!a)return;const s=asColor(r);if(!s)return a;const i=asDecimalRatio(t,.5);let l="number"==typeof s.a?s.a:1;return l+=(("number"==typeof a.a?s.a:1)-l)*i,"rgb"===o?new Color({r:a.r+(s.r-a.r)*i,g:a.g+(s.g-a.g)*i,b:a.b+(s.b-a.b)*i,a:l}):"hsl"===o?new Color({h:a.h+(s.h-a.h)*i,s:a.s+(s.s-a.s)*i,l:a.l+(s.l-a.l)*i,a:l}):void 0}function scaleColor(e,r,t,n){var o,a;let s,i=new Color("#fff"),l=new Color("#000"),u=10;if("color"===(null===(o=t)||void 0===o?void 0:o.type()))i=asColor(e),s=asColor(r),l=asColor(t),u=asInteger(n,10);else if("color"===(null===(a=r)||void 0===a?void 0:a.type()))i=asColor(e),s=asColor(r),l=asColor(r),u=asInteger(t,10);else if("color"===e.type()){s=asColor(e),l=new Color({h:s.h-20*Math.sin(4*Math.PI*(s.h/360)),s:s.s+.2*Math.sin(2*Math.PI*(s.h/360)),l:s.h>=180?s.l-.35:s.l-.15+.15*Math.sin(3*Math.PI*(s.h/360))}),u=asInteger(r,10);const t=new StringValue("rgb");return new ArrayValue([mixColor(i,s,new NumberValue(.12),t),mixColor(i,s,new NumberValue(.3),t),mixColor(i,s,new NumberValue(.5),t),mixColor(i,s,new NumberValue(.7),t),mixColor(i,s,new NumberValue(.85),t),s,mixColor(l,s,new NumberValue(.85),t),mixColor(l,s,new NumberValue(.7),t),mixColor(l,s,new NumberValue(.5),t),mixColor(l,s,new NumberValue(.2),t)])}if(!i||!s||!l)return;const c=chroma.scale([i.opaque().hex(),s.opaque().hex(),l.opaque().hex()]).mode("lab").correctLightness().colors(u+1);return new ArrayValue(c.map(e=>new Color(e)))}const COLOR_ARGUMENTS_FUNCTIONS=["rgb","rgba","hsl","hsla","hwb","grey","lab"],COLOR_FUNCTIONS={rgb:(e,r,t,n)=>new Color({r:asDecimalByte(e),g:asDecimalByte(r),b:asDecimalByte(t),a:asDecimalRatio(n,1)}),hsl:(e,r,t,n)=>new Color({h:asDegree(e),s:asPercent(r),l:asPercent(t),a:asDecimalRatio(n,1)}),hsv:(e,r,t,n)=>{let o=asPercent(r);const a=asPercent(t),s=(2-o)*a/2;return 0!=s&&(o=1==s?0:s<.5?o*a/(2*s):o*a/(2-2*s)),new Color({h:asDegree(e),s:o,l:s,a:asDecimalRatio(n,1)})},hwb:(e,r,t,n)=>new Color(Object.assign({a:asDecimalRatio(n,1)},function(e,r,t){const n=hslToRgb(e,1,.5),o=[];o[0]=n.r/255,o[1]=n.g/255,o[2]=n.b/255;const a=r+t;a>1&&(r=Number((r/a).toFixed(2)),t=Number((t/a).toFixed(2)));for(let e=0;e<3;e++)o[e]*=1-r-t,o[e]+=r,o[e]=Number(255*o[e]);return{r:o[0],g:o[1],b:o[2]}}(asDegree(e),asPercent(r),asPercent(t)))),lab:(e,r,t,n)=>new Color(Object.assign({a:asDecimalRatio(n,1)},labToRgb(asPercent(e),asDecimalRatio(r),asDecimalRatio(t)))),gray:(e,r)=>new Color(Object.assign({a:asDecimalRatio(r,1)},labToRgb(asPercent(e),0,0))),mix:(e,r,t,n)=>{const o=asString(n,"hsl").toLowerCase(),a=asColor(e);if(!a)return;const s=asColor(r);if(!s)return a;const i=asDecimalRatio(t,.5);let l="number"==typeof s.a?s.a:1;if(l+=(("number"==typeof a.a?s.a:1)-l)*i,"rgb"===o)return new Color({r:a.r+(s.r-a.r)*i,g:a.g+(s.g-a.g)*i,b:a.b+(s.b-a.b)*i,a:l});if("hsl"===o)return new Color({h:a.h+(s.h-a.h)*i,s:a.s+(s.s-a.s)*i,l:a.l+(s.l-a.l)*i,a:l});if("lab"===o){const{L:e,a:r,b:t}=rgbToLab(a.r,a.g,a.b),{L:n,a:o,b:u}=rgbToLab(s.r,s.g,s.b);return new Color(Object.assign(Object.assign({},labToRgb(e+(n-e)*i,r+(o-r)*i,t+(u-t)*i)),{alpha:l}))}},saturate:(e,r)=>{const t=asColor(e);if(t)return new Color({h:t.h,s:t.s+(1-t.s)*asDecimalRatio(r,.1),l:t.l,a:t.a})},desaturate:(e,r)=>{const t=asColor(e);if(t)return new Color({h:t.h,s:t.s-t.s*asDecimalRatio(r,.1),l:t.l,a:t.a})},lighten:(e,r)=>{const t=asColor(e);if(t)return new Color({h:t.h,s:t.s,l:t.l+(1-t.l)*asDecimalRatio(r,.1),a:t.a})},darken:(e,r)=>{const t=asColor(e);if(t)return new Color({h:t.h,s:t.s,l:t.l-t.l*asDecimalRatio(r,.1),a:t.a})},rotateHue:(e,r)=>{const t=asColor(e);if(t)return r&&(isAngle(r)||isNumber(r))?new Color({h:(t.h+asDegree(r)+360)%360,s:t.s,l:t.l,a:t.a}):t},complement:e=>{const r=asColor(e);if(r)return new Color({h:(r.h+180)%360,s:r.s,l:r.l,a:r.a})},contrast:(e,r,t)=>{const n=asColor(e),o=asColor(r)||blackColor,a=asColor(t)||whiteColor;let s,i;const l=n.luma(),u=o.luma(),c=a.luma();return s=l>u?(l+.05)/(u+.05):(u+.05)/(l+.05),i=l>c?(l+.05)/(c+.05):(c+.05)/(l+.05),s>i?o:a},rgba:(e,r,t,n)=>new Color({r:asDecimalByte(e),g:asDecimalByte(r),b:asDecimalByte(t),a:asDecimalRatio(n,1)}),hsla:(e,r,t,n)=>new Color({h:asDegree(e),s:asPercent(r),l:asPercent(t),a:asDecimalRatio(n,1)}),tint:(e,r)=>mixColor(whiteColor,e,null!=r?r:new NumberValue(.1)),shade:(e,r)=>mixColor(blackColor,e,null!=r?r:new NumberValue(.1))};let FUNCTIONS={};FUNCTIONS=Object.assign({calc:e=>e,min:(e,r)=>compareValue(e,r)<0?e:r,max:(e,r)=>compareValue(e,r)<0?r:e,clamp:(e,r,t)=>compareValue(r,e)<0?e:compareValue(r,t)>0?t:r,scale:(e,r,t,n)=>isColor(e)?scaleColor(e,r,t,n):isLength(e)?scaleLength(e,r):void 0},COLOR_FUNCTIONS);const FUNCTION_ARGUMENTS=Object.assign({calc:"any",min:"any, any",max:"any, any",clamp:"any, any, any"},{rgb:"number|percentage, number|percentage, number|percentage,number|percentage|none",rgba:"number|percentage, number|percentage, number|percentage,number|percentage|none",hsl:"number|angle, number|percentage, number|percentage, number|percentage|none",hsla:"number|angle, number|percentage, number|percentage, number|percentage|none",hsv:"number|angle, number|percentage, number|percentage, number|percentage|none",hwb:"number|angle, number|percentage, number|percentage, number|percentage|none",lab:"number|percentage, number, number, number|percentage|none",gray:"number|percentage, number|percentage|none",mix:"color, color, number|percentage|none, string|none",saturate:"color, number|percentage|none",desaturate:"color, number|percentage|none",lighten:"color, number|percentage|none",darken:"color, number|percentage|none",rotateHue:"color, angle|number|none",complement:"color",contrast:"color, color|none, color|none",tint:"color, number|percentage|none",shade:"color, number|percentage|none"});class Stream{constructor(e,r={}){this.s="",this.index=0,this.options={},this.s=e,this.index=0,this.options=r}isEOF(){return this.index>=this.s.length}lookAhead(e){return this.s.slice(this.index,this.index+e)}skipWhiteSpace(){this.match(/^\s*/)}match(e){if("string"==typeof e){if(this.lookAhead(e.length)===e)return this.index+=e.length,e}else{const r=this.s.slice(this.index).match(e);if(r&&r[0])return this.index+=r[0].length,r[1]||!0}}error(e,...r){var t,n,o,a;const s=null!=(n=null===(t=this.s.slice(0,this.index).match(/^(.*)/))||void 0===t?void 0:t[1])?n:"",i=null!=(a=null===(o=this.s.slice(this.index).match(/(.*)$/))||void 0===o?void 0:o[1])?a:"";throwErrorWithContext([s+terminal.dim(i)," ".repeat(s.length)+"⇧"],e,...r)}applyOpToLength(e,r,t){isNumber(r)&&"/"===e&&this.error(ErrorCode.InvalidOperand),isNumber(r)||isNumber(t)||"*"!==e||this.error(ErrorCode.InvalidOperand);const n={"+":(e,r)=>e+r,"-":(e,r)=>e-r,"*":(e,r)=>e*r,"/":(e,r)=>e/r}[e];if(isNumber(r)){if(o=t,console.assert(o instanceof Length),"multi"===t.unit){const e={};return Object.keys(t.value).forEach(o=>{e[o]=n(r.value,t.value[o])}),new Length(e)}return new Length(n(r.value,t.value),t.unit)}var o;if(isNumber(t)){if("number"==typeof r.value)return new Length(n(r.value,t.value),r.unit);const e={};return Object.keys(r.value).forEach(o=>{e[o]=n(r.value[o],t.value)}),new Length(e)}if("/"===e)return"multi"!==r.unit&&"multi"!==t.unit||this.error(ErrorCode.InvalidOperand),r.unit===t.unit?new NumberValue(r.value/t.value):new NumberValue(r.canonicalScalar()/t.canonicalScalar());const a=promoteToMulti(r),s=promoteToMulti(t),i={};return[...Object.keys(a.value),...Object.keys(s.value)].forEach(e=>{void 0===s.value[e]?i[e]=a.value[e]:void 0===a.value[e]?i[e]=s.value[e]:i[e]=n(a.value[e],s.value[e])}),new Length(i)}parseUnit(e){if(this.match("%"))return new Percentage(e);let r=this.match(/^(em|ex|ch|rem|vw|vh|vmin|vmax|px|cm|mm|in|pt|pc|Q)/);return r?new Length(e,r):(r=this.match(/^(deg|°|rad|grad|turn)/),r?new Angle(e,"°"===r?"deg":r):(r=this.match(/^(ms|s)/),r?new Time(e,r):(r=this.match(/^(khz|hz|kHz|Hz)/),r?new Frequency(e,r.toLowerCase()):(r=this.match(/^([a-zA-Z]+)/),r&&this.error(ErrorCode.UnknownUnit,r),new NumberValue(e)))))}parseIndex(e){let r=e;if(this.match("["))if("array"!==e.type())this.error(ErrorCode.UnexpectedOpenBracket);else{const t=asInteger(this.parseExpression(),NaN);isNaN(t)&&this.error(ErrorCode.ExpectedIntegerIndex),r=e.get(t),this.skipWhiteSpace(),this.match("]")||this.error(ErrorCode.ExpectedCloseBracket)}return r}parseLiteral(){var e,r,t,n;let o;const a=this.index,s=this.match(/^\s*([+\-])\s*/);if(s){const e=this.parseLiteral();if("-"===s){if(isPercentage(e))return new Percentage(-100*asPercent(e));if(isNumber(e))return new NumberValue(-e.value);if(isAngle(e))return new Angle(-e.value,e.unit);if(isLength(e))return this.applyOpToLength("-",new Length(0,"px"),e);this.error(ErrorCode.InvalidUnaryOperand)}return e}const i=this.match(/^([0-9]*\.[0-9]+|\.?[0-9]+)/);if(i&&(o=this.parseUnit(parseFloat(i))),!o&&this.match("[")){const e=[];for(;"]"!==this.lookAhead(1)&&!this.isEOF();){const r=this.parseExpression();r||this.error(ErrorCode.SyntaxError),e.push(r),this.match(/^(\s*,?|\s+)/)}return this.isEOF()&&this.error(ErrorCode.ExpectedCloseBracket),this.match("]"),new ArrayValue(e)}if(!o&&this.match('"')){let e="";for(;'"'!==this.lookAhead(1)&&!this.isEOF();)"\\"===this.lookAhead(1)?(e+=this.s[this.index+1],this.index+=2):(e+=this.s[this.index],this.index+=1);return this.isEOF()&&this.error(ErrorCode.ExpectedQuote),this.match('"'),new StringValue(e)}if(!o&&this.match("{")){const a=this.match(/^([a-zA-Z_-][a-zA-Z0-9\._-]*)/);if(a){let s=null===(e=this.options)||void 0===e?void 0:e.aliasResolver(a);if("string"==typeof s){const e=a.match(/^(.+)-([0-9]{2,3})$/);if(e){const o=null===(r=this.options)||void 0===r?void 0:r.aliasResolver(e[1]);if("string"!=typeof o){if(isArray(o)){const r=Math.round(parseInt(e[2])/100);s=o.get(r)}else if(isColor(o)){const r=Math.round(parseInt(e[2])/100);s=null===(t=scaleColor(o))||void 0===t?void 0:t.get(r)}else if(isLength(o)){const r="50"===e[2]?0:Math.round(parseInt(e[2])/100);s=null===(n=scaleLength(o))||void 0===n?void 0:n.get(r)}}else"string"==typeof o?this.error(ErrorCode.UnknownToken,e[1],o):this.error(ErrorCode.InvalidOperand)}}"string"==typeof s&&this.error(ErrorCode.UnknownToken,a,s),o=s,o&&(o=makeValueFrom(o),o.setSource("{"+a+"}"))}this.match("}")||this.error(ErrorCode.ExpectedCloseCurlyBracket)}return o||(o=asColor(this.match(/^\s*(#[0-9a-fA-F]{3,8})/))),o||(this.index=a,o=asColor(this.match(/^\s*([a-zA-Z]+)/))),o||(this.index=a),o}parseColorArguments(){const e=[];if(this.skipWhiteSpace(),!this.match("("))return;let r=this.parseExpression();if(r){if(e.push(r),!this.match(/^(\s*,?|\s+)/))return this.match(")"),e;if(r=this.parseExpression(),r){if(e.push(r),!this.match(/^(\s*,?|\s+)/))return this.match(")"),e;if(r=this.parseExpression(),r){if(e.push(r),!this.match(/^(\s*,?|\s+|\s*\/)/))return this.match(")"),e;r=this.parseExpression(),r&&e.push(r)}}}return this.match(")"),e}parseArguments(){if(this.skipWhiteSpace(),!this.match("("))return;const e=[];for(;")"!==this.lookAhead(1)&&!this.isEOF();){const r=this.parseExpression();r||this.error(ErrorCode.SyntaxError),e.push(r),this.match(/^(\s*,?|\s+)/)}return this.isEOF()&&this.error(ErrorCode.ExpectedCloseParen),this.match(")"),e}parseCall(){const e=this.index,r=this.match(/^([a-zA-Z\-]+)/);if(r)if(FUNCTIONS[r]){const e=COLOR_ARGUMENTS_FUNCTIONS.includes(r)?this.parseColorArguments():this.parseArguments();if(e){try{!function(e,r){var t;const n=null===(t=FUNCTION_ARGUMENTS[e])||void 0===t?void 0:t.split(",").map(e=>e.trim());if(n&&(n.forEach((t,n)=>{var o;const a=t.split("|").map(e=>e.trim());if(!a.includes("none")&&!r[n])throw new SyntaxError(ErrorCode.MissingArgument,String(n+1),e,a.join(", "));if(r[n]&&!a.includes("any")&&!a.includes(null===(o=r[n])||void 0===o?void 0:o.type()))throw new SyntaxError(ErrorCode.ExpectedArgument,String(n+1),e,a.join(", "))}),r.length>n.length))throw new SyntaxError(ErrorCode.TooManyArguments,e,n.join(", "))}(r,e)}catch(e){e.code?this.error(e.code,...e.args):this.error(e.message)}return FUNCTIONS[r](...e)}this.error(ErrorCode.SyntaxError)}else"("===this.lookAhead(1)&&this.error(ErrorCode.UnknownFunction,r,getSuggestion(r,FUNCTIONS));this.index=e}parseTerminal(){const e=this.parseCall()||this.parseGroup()||this.parseLiteral();return e?this.parseIndex(e):e}parseFactor(){let e=this.parseTerminal(),r=this.match(/^\s*([*|/])\s*/);for(;r;){const t={"*":(e,r)=>e*r,"/":(e,r)=>e/r}[r],n=this.parseTerminal();if(n||this.error(ErrorCode.ExpectedOperand),isNumber(n))isNumber(e)?e=new NumberValue(t(e.value,n.value)):isPercentage(e)?e=new Percentage(t(e.value,n.value)):isLength(e)?e=this.applyOpToLength(r,e,n):isAngle(e)?e=new Angle(t(e.value,n.value),e.unit):isFrequency(e)?e=new Frequency(t(e.value,n.value),e.unit):isTime(e)&&(e=new Time(t(e.value,n.value),e.unit));else{if((isNumber(e)||isLength(e))&&isLength(n))return this.applyOpToLength(r,e,n);isNumber(e)?isPercentage(n)?e=new Percentage(t(e.value,n.value)):isLength(n)?e=this.applyOpToLength(r,e,n):isAngle(n)?e=new Angle(t(e.value,n.value),n.unit):isFrequency(n)?e=new Frequency(t(e.value,n.value),n.unit):isTime(n)&&(e=new Time(t(e.value,n.value),n.unit)):"/"===r&&e.type()===n.type()?e=new NumberValue(e.canonicalScalar()/n.canonicalScalar()):this.error(ErrorCode.InvalidOperand)}r=this.match(/^\s*([*|/])\s*/)}return e}parseTerm(){let e=this.parseFactor(),r=this.match(/^\s*([+\-])\s*/);for(;r;){const t={"+":(e,r)=>e+r,"-":(e,r)=>e-r}[r],n=this.parseFactor();n||this.error(ErrorCode.ExpectedOperand),isString(e)||isString(n)?("-"===r&&this.error(ErrorCode.InvalidOperand),e=new StringValue(t(e.css(),n.css()))):isNumber(e)&&isNumber(n)?e=new NumberValue(t(e.value,n.value)):(isZero(e)||isPercentage(e))&&(isZero(n)||isPercentage(n))?e=new Percentage(100*t(asPercent(e),asPercent(n))):isZero(e)&&isTime(n)?e=new Time(t(0,n.value),n.unit):isTime(e)&&isZero(n)?e=new Time(e.value,e.unit):isTime(e)&&isTime(n)?e=e.unit===n.unit?new Time(t(e.value,n.value),e.unit):new Time(t(e.canonicalScalar(),n.canonicalScalar()),"s"):isZero(e)&&isFrequency(n)?e=new Frequency(t(0,n.value),n.unit):isFrequency(e)&&isZero(n)?e=new Frequency(e.value,e.unit):isFrequency(e)&&isFrequency(n)?e=e.unit===n.unit?new Frequency(t(e.value,n.value),e.unit):new Frequency(t(e.canonicalScalar(),n.canonicalScalar()),"hz"):isZero(e)&&isAngle(n)?e=new Angle(t(0,n.value),n.unit):isAngle(e)&&isZero(n)?e=new Angle(e.value,e.unit):isAngle(e)&&isAngle(n)?e=e.unit===n.unit?new Angle(t(e.value,n.value),e.unit):new Angle(t(asDegree(e),asDegree(n)),"deg"):(isZero(e)||isLength(e))&&(isZero(n)||isLength(n))?e=this.applyOpToLength(r,e,n):this.error(ErrorCode.InvalidOperand),r=this.match(/^\s*([+\-])\s*/)}return e}parseGroup(){let e;return this.match("(")&&(e=this.parseExpression(),this.skipWhiteSpace(),this.match(")")||this.error(ErrorCode.ExpectedCloseParen)),e&&isNumber(e)&&(e=this.parseUnit(e.value)),e}parseExpression(){return this.skipWhiteSpace(),this.parseTerm()}}const fs=require("fs"),GenericFormats={formats:{yaml:{ext:".yaml",render:e=>e.renderTemplate(fs.readFileSync(__dirname+"/templates/yaml.hbs","utf-8"),e)},json:{ext:".json",render:e=>e.renderTemplate(fs.readFileSync(__dirname+"/templates/json.hbs","utf-8"),e),handlebarsHelpers:{}},"data-dump":{ext:".yaml",render:e=>e.renderTemplate(fs.readFileSync(__dirname+"/templates/data-dump.hbs","utf-8"),e)}}},fs$1=require("fs"),WebFormats={formats:{sass:{ext:".scss",render:e=>e.renderTemplate(fs$1.readFileSync(__dirname+"/templates/sass.hbs","utf-8"),e)},css:{ext:".css",render:e=>e.renderTemplate(fs$1.readFileSync(__dirname+"/templates/css.hbs","utf-8"),e)}}},marked=require("marked"),highlight=require("highlight.js"),handlebars=require("handlebars"),fs$2=require("fs");function renderColorSection(e){let r="";const t={colors:[],colorRamps:[],group:""};return e.themes.forEach(n=>{t.group=1===e.themes.length?"":"_"===n.theme?"Base":n.theme,t.colors=[],n.tokens.forEach(e=>{var r,n;if(isColor(e.tokenValue)){const o=e.tokenValue;let a,s=o.luma()>=1?"frame ":"";o.luma()>.42&&(s+="light"),o.a<1&&(a=new Color(o),a.a=1),t.colors.push({name:e.tokenId,value:e.tokenValue,source:o.getSource(),css:o.css(),comment:(r=e.tokenDefinition.comment,null!=r?r:""),cls:s,opaqueColor:null===(n=a)||void 0===n?void 0:n.css()})}else(function(e){return e instanceof ArrayValue&&e.value.every(e=>isColor(e))})(e.tokenValue)&&t.colorRamps.push({name:e.tokenId,source:e.tokenValue.getSource(),values:e.tokenValue.value.map((e,r)=>{var t;const n=e;let o,a=n.luma()>=1?"frame ":"";return n.luma()>.42&&(a+="light"),n.a<1&&(o=new Color(n),o.a=1),{name:0===r?"50":100*r,cls:a,value:n,css:n.css(),opaqueColor:null===(t=o)||void 0===t?void 0:t.css()}})})}),r+=handlebars.compile(fs$2.readFileSync(__dirname+"/templates/html-colors.hbs","utf-8"))(t)}),r}const StyleGuideFormat={formats:{"html/colors":{ext:".html",render:renderColorSection},html:{ext:".html",render:e=>e.renderTemplate(fs$2.readFileSync(__dirname+"/templates/html-file.hbs","utf-8"),Object.assign(Object.assign({},e),{"color-section":renderColorSection(e)}))}}};marked.setOptions({renderer:new marked.Renderer,highlight:e=>highlight.highlightAuto(e).value,pedantic:!1,gfm:!0,breaks:!1,sanitize:!1,smartLists:!0,smartypants:!1,xhtml:!1});const{cosmiconfigSync:cosmiconfigSync}=require("cosmiconfig"),configParser=cosmiconfigSync("chromatic"),glob=require("glob"),fs$3=require("fs-extra"),path=require("path"),yaml=require("yaml"),json5=require("json5"),resolveFrom=require("resolve-from"),handlebars$1=require("handlebars"),gConfig={};let gThemes,gGroups,gTokenDefinitions,gTokenValues,gRecursiveEvaluationStack,gErroredTokens,gProcessedFiles,gWatching=!1,gIgnoreErrors=!1;function error(e){var r;"string"==typeof e&&(e=[e]);const t="\n"+[].concat(...e.map(e=>e.split("\n"))).join("\n    ");null===(r=gConfig.console)||void 0===r||r.error(terminal.autoFormat(t)),gWatching||gIgnoreErrors||process.exit(1)}function log(e){var r;null===(r=gConfig.console)||void 0===r||r.log(e)}function mergeObject(e,r){e!==r&&r&&Object.keys(r).forEach(t=>{Array.isArray(r[t])?(e[t]||(e[t]=[]),e[t]=[...e[t],...r[t]]):"object"==typeof r[t]?(e[t]||(e[t]={}),mergeObject(e[t],r[t])):void 0!==r[t]&&(e[t]=r[t])})}function evaluateTokenExpression(e,r,t){if(r&&!gErroredTokens.includes(e))try{throwErrorIf(gRecursiveEvaluationStack.includes(e),ErrorCode.CircularDefinition,e),gRecursiveEvaluationStack.push(e);const n=function(e,r={}){const t=new Stream(e,r),n=t.parseExpression();if(t.skipWhiteSpace(),t.isEOF())return n&&n.setSource(e),n}(r,Object.assign(Object.assign({},gConfig),{aliasResolver:r=>{var n,o,a,s,i;let l;if(t){if(gTokenValues.has(r+"."+t))return gTokenValues.get(r+"."+t);if(gTokenDefinitions.has(r)&&(l=evaluateTokenExpression(r+"."+t,null!=(o=null===(n=gTokenDefinitions.get(r))||void 0===n?void 0:n.value[t])?o:null===(a=gTokenDefinitions.get(e))||void 0===a?void 0:a.value._,t)),l)return l}return gTokenValues.has(r)?gTokenValues.get(r):(gTokenDefinitions.has(r)&&(t&&(l=evaluateTokenExpression(r+"."+t,null===(s=gTokenDefinitions.get(r))||void 0===s?void 0:s.value[t],t)),l||(l=evaluateTokenExpression(r,null===(i=gTokenDefinitions.get(e))||void 0===i?void 0:i.value._,t))),null!=l?l:getSuggestion(r,gTokenDefinitions))}}));return gRecursiveEvaluationStack.pop(),n}catch(t){gErroredTokens.includes(e)||(gErroredTokens.push(e),error([terminal.error("Syntax error")+` in "${e+": '"+r}'"`,t.message]))}}function processPath(e){var r,t,n;const o=[];if(e=path.resolve(path.normalize(e)),gProcessedFiles.includes(e))return;if(gProcessedFiles.push(e),fs$3.lstatSync(e).isDirectory())return void glob.sync(e+"/**/*"+gConfig.tokenFileExt).forEach(processPath);let a;try{const r=fs$3.readFileSync(e,"utf8");a=/^\.json/.test(path.extname(e))?json5.parse(r):yaml.parse(r)}catch(e){o.push((e.name?e.name+": ":"")+e.message)}if((null===(r=a)||void 0===r?void 0:r.import)&&("string"==typeof a.import&&(a.import=[a.import]),Array.isArray(a.import)?a.import.forEach(r=>{let t=e;try{t=resolveFrom(path.parse(e).dir,r),processPath(t)}catch(e){o.push(`option "import: ${r}"`),"MODULE_NOT_FOUND"===e.code?o.push("Module not found."+("./"===r.slice(0,2)?"":`\nTo import as a file, use a relative path: "./${r}"`)):"ENOENT"===e.code?o.push("→ "+terminal.path(t)+"\nFile not found."):o.push(e.message)}}):o.push('Option "import" should be a path or an array of paths')),a&&gConfig.verbose&&(a.imports||a.extends||a.include||a.includes)&&!a.import&&log(terminal.warning()+terminal.path(path.relative("",e))+`\n${terminal.warning("Warning:")} use the \`"import"\` property to import other token files`),(null===(t=a)||void 0===t?void 0:t.groups)&&Object.keys(a.groups).forEach(e=>{var r;if(gGroups.has(e)){const t=gGroups.get(e);t.name=null!=(r=a.groups[e].name)?r:t.name,t.comment=(t.comment?t.comment+"\n":"")+a.groups[e].comment,t.remarks=(t.remarks?t.remarks+"\n":"")+a.groups[e].remarks,gGroups.set(e,t)}else gGroups.set(e,a.groups[e])}),null===(n=a)||void 0===n?void 0:n.tokens){throwErrorIf("object"!=typeof a.tokens,ErrorCode.UnexpectedTokensType);try{!function e(r,t,n){throwErrorIf(Array.isArray(n),ErrorCode.UnexpectedTokensArray,terminal.link("tokens-as-array")),gGroups.has(t)||gGroups.set(t,{}),Object.keys(n).forEach(o=>{var a;const s=(t?t+".":"")+o;throwErrorIf(!/^[a-zA-Z_-][a-zA-Z0-9_-]*$/.test(o),ErrorCode.InvalidTokenName,s),throwErrorIf(!n[o],ErrorCode.InvalidTokenValue,o);try{const t=function(e,r){if("string"!=typeof r&&("object"!=typeof r||!r.value))return;let t={value:{}};return"string"==typeof r?t.value._=r:t=Object.assign({},r),"string"==typeof t.value&&(t.value={_:t.value}),e&&t.value._&&(t.value[e]=t.value._,t.value._=void 0),Object.keys(t.value).forEach(e=>{gThemes.includes(e)||gThemes.push(e)}),t}(null!=(a=r.theme)?a:gConfig.defaultTheme,n[o]);if(t)if(gTokenDefinitions.has(s)){const e=gTokenDefinitions.get(s);mergeObject(e,t),gTokenDefinitions.set(s,e)}else gTokenDefinitions.set(s,t);else e(r,s,n[o])}catch(e){throw new Error(`${s}: "${n[o]}"\n${e.message}`)}})}(a,"",a.tokens)}catch(e){o.push(e.message)}}gConfig.verbose&&0===o.length&&log(terminal.success()+"← "+terminal.path(process.env.TEST?path.basename(e):path.relative("",e))),o.length>0&&error([terminal.error()+"← "+terminal.path(process.env.TEST?path.basename(e):path.relative("",e)),...o])}function renderFile(e,r,t){gTokenDefinitions.forEach((e,t)=>{Object.keys(e.value).forEach(e=>{r.includes(e)})});const n=[];gGroups.forEach((e,t)=>{const o=[...gTokenDefinitions].filter(([e,r])=>t?e.startsWith(t+"."):!/\./.test(e));n.push({groupId:t,groupInfo:e,tokens:o.map(([e,t])=>({tokenId:e,tokenDefinition:t,themes:r.map(r=>{const t=e+("_"===r?"":"."+r);return{theme:r,tokenName:t,tokenValue:gTokenValues.get(t)}}).filter(e=>e.tokenValue)}))})});const o={};return gTokenDefinitions.forEach((e,r)=>{if(Object.keys(e.value).length>1)Object.keys(e.value).forEach(t=>{o[t]||(o[t]=[]);const n=r+("_"===t?"":"."+t);o[t].push({tokenId:r,tokenName:n,tokenDefinition:e,tokenValue:gTokenValues.get(n)})});else{const t=Object.keys(e.value)[0],n=r+("_"===t?"":"."+t);o[""]||(o[""]=[]),o[""].push({tokenId:r,tokenName:n,tokenDefinition:e,tokenValue:gTokenValues.get(n)})}}),e.render({filepath:t,fileHeader:e.fileHeader,themes:Object.keys(o).map(e=>({theme:e,isDefaultTheme:"_"===e,tokens:o[e]})),groups:n,renderTemplate:(e,r)=>handlebars$1.compile(e.replace(/\r\n/g,"\n"))(r)})}function build(e,r){var t,n,o,a,s;n=null===(t=r)||void 0===t?void 0:t.watching,gWatching=null!=n&&n,gThemes=[],gTokenDefinitions=new Map,gGroups=new Map,gTokenValues=new Map,gRecursiveEvaluationStack=[],gProcessedFiles=[],gErroredTokens=[],e.forEach(e=>{const r=glob.sync(e);0!==r.length?r.forEach(processPath):error(terminal.error("File not found: ")+terminal.path(e))});try{gTokenDefinitions.forEach((e,r)=>{Object.keys(e.value).forEach(t=>{var n;const o=r+("_"===t?"":"."+t),a=null!=(n=evaluateTokenExpression(o,e.value[t],gConfig.defaultTheme))?n:new StringValue(e.value[t]);gTokenValues.set(o,a),e.type&&a.type()!=e.type&&log(terminal.warning("Warning:")+` Type mismatch. Expected \`${e.type}\` but got \`${a.type()}\` for "${o}" token`)})}),gTokenValues.forEach((e,r)=>{isString(e)&&(e.value=e.value.replace(/{[a-zA-Z0-9\._-]+}/g,e=>{const r=e.slice(1,-1);return gTokenValues.has(r)?gTokenValues.get(r).css():(error(terminal.error("Unresolved alias. ")+`Cannot find token "${e}"`+getSuggestion(r,gTokenValues)),e)}))}),gTokenDefinitions.forEach((e,r)=>{gThemes.forEach(t=>{var n;if("_"!==t&&void 0===e.value[t]){const o=r+"."+t,a=null!=(n=evaluateTokenExpression(o,e.value._,t))?n:new StringValue(e.value._);gTokenValues.set(o,a)}})}),gTokenDefinitions.forEach((e,r)=>{gThemes.forEach(e=>{var t;if("_"!==e){const n=r+"."+e;(null===(t=gTokenValues.get(r))||void 0===t?void 0:t.equals(gTokenValues.get(n)))&&gTokenValues.delete(n)}})}),gTokenDefinitions.forEach((e,r)=>{throwErrorIf(Object.keys(e.value).reduce((e,t)=>{var n,o;const a="_"===t?r:r+"."+t;return e.includes(null===(n=gTokenValues.get(a))||void 0===n?void 0:n.type())||e.push(null===(o=gTokenValues.get(a))||void 0===o?void 0:o.type()),e},[]).length>1,ErrorCode.InconsistentTokenType,r)});const e=function(e){const r={fileHeader:DEFAULT_FILE_HEADER,formatFilename:function({theme:e,basename:r}){return r+(e?"-"+e:"")},handlebarsHelpers:Object.assign({},gConfig.handlebarsHelpers),render:e=>"Expected a render() function in the Format definition."};throwErrorIf(!gConfig.formats[e],ErrorCode.UnknownFormat,e,getSuggestion(e,gConfig.formats));const t=gConfig.formats[e].extends;return t&&(throwErrorIf(!gConfig.formats[t],ErrorCode.UnknownFormat,t,getSuggestion(t,gConfig.formats)),mergeObject(r,gConfig.formats[t])),mergeObject(r,gConfig.formats[e]),Object.keys(r.handlebarsHelpers).forEach(e=>{handlebars$1.registerHelper(e,r.handlebarsHelpers[e])}),r}(gConfig.outputFormat);e.fileHeader=null!=(o=r.header)?o:e.fileHeader;const t=(null===(a=r)||void 0===a?void 0:a.output)&&path.resolve(r.output),n=function(e,r){var t;const n={};let o="";if(!function(){var e;return(null===(e=gConfig.themes)||void 0===e?void 0:e.length)>0&&(gThemes=gThemes.filter(e=>gConfig.themes.includes(e))),gThemes.forEach(e=>{let r=0;gTokenDefinitions.forEach((t,n)=>{void 0!==t.value[e]&&(r+=1)}),0===r&&gThemes.splice(gThemes.indexOf(e),1)}),0!==gThemes.length&&0!==gTokenDefinitions.size||(error([terminal.error("No tokens found."),'Token files should have a "tokens" property',terminal.link("../guide")]),!1)}())return;const a=null!=(t=e&&path.parse(e))?t:{name:"tokens"};return gConfig.splitOutput?gThemes.forEach(e=>{o=path.format({dir:a.dir,name:r.formatFilename({theme:e,basename:a.name}),ext:r.ext}),n[o]=renderFile(r,[e],o)}):(o=path.format({dir:a.dir,name:r.formatFilename({theme:"",basename:a.name}),ext:r.ext}),n[o]=renderFile(r,gThemes,o)),n}(t,e);if(n&&!(null===(s=r)||void 0===s?void 0:s.dryRun)){if(!t)return n;if(gConfig.verbose){let e="";1===gThemes.length&&"_"===gThemes[0]||(e=1===gThemes.length?`for theme "${gThemes[0]}"`:"for themes "+gThemes.map(e=>'"'+e+'"').join(", ")),log(`    Writing ${terminal.string(gConfig.outputFormat)} format ${e}`)}Object.keys(n).forEach(e=>{!function(e,r){const t=path.dirname(r);fs$3.existsSync(t)||fs$3.mkdirsSync(t),fs$3.writeFileSync(r,e),(gConfig.verbose||gWatching)&&log(terminal.success()+(gWatching?terminal.time()+" ":"")+"→ "+terminal.path(path.relative("",r)))}(n[e],e)})}}catch(e){error(terminal.error(e.message))}return{}}function chromatic(e,r){var t,n,o,a,s,i,l,u,c,h,g,m,p,d,f,v,b,y,C,k,E,w,x,T,S,O,N;"string"==typeof e&&(e=[e]);let F=configParser.search();null==(n=null===(t=F)||void 0===t?void 0:t.isEmpty)||n||mergeObject(gConfig,F.config),(null===(o=r)||void 0===o?void 0:o.config)&&(F=configParser.load(r.config),null==(s=null===(a=F)||void 0===a?void 0:a.isEmpty)||s||mergeObject(gConfig,F.config)),(null===(i=r)||void 0===i?void 0:i.themes)&&("string"==typeof r.themes?gConfig.themes=r.themes.split(",").map(e=>e.trim()):Array.isArray(r.themes)&&(gConfig.themes=[...r.themes])),u=null===(l=r)||void 0===l?void 0:l.ignoreErrors,gIgnoreErrors=null!=u&&u;const I=[];if("string"==typeof(null===(c=r)||void 0===c?void 0:c.console)?"log"===(null===(h=r)||void 0===h?void 0:h.console)&&(terminal.useColor(!1),gConfig.console={log:e=>{I.push(e)},error:e=>{I.push(e)}}):gConfig.console=null!=(m=null===(g=r)||void 0===g?void 0:g.console)?m:{log:e=>console.error(e),error:e=>console.error(e)},gConfig.themes||(gConfig.themes=[]),gConfig.tokenFileExt=null!=(v=null!=(d=null===(p=r)||void 0===p?void 0:p.tokenFileExt)?d:null===(f=gConfig)||void 0===f?void 0:f.tokenFileExt)?v:"yaml",gConfig.verbose=null!=(k=null!=(y=null===(b=r)||void 0===b?void 0:b.verbose)?y:null===(C=gConfig)||void 0===C?void 0:C.verbose)&&k,gConfig.splitOutput=r.splitOutput,gConfig.outputFormat=null!=(T=null!=(w=null===(E=r)||void 0===E?void 0:E.format)?w:null===(x=gConfig)||void 0===x?void 0:x.outputFormat)?T:"",!gConfig.outputFormat){const e=(null===(S=r)||void 0===S?void 0:S.output)&&path.extname(null===(O=r)||void 0===O?void 0:O.output);if(e){const r=Object.keys(gConfig.formats).filter(r=>{var t,n;return gConfig.formats[r].ext===e||(null===(n=gConfig.formats[null===(t=gConfig.formats[r])||void 0===t?void 0:t.extends])||void 0===n?void 0:n.ext)});1===r.length?gConfig.outputFormat=r[0]:gConfig.formats[e.slice(1)]?gConfig.outputFormat=e.slice(1):r.length>1&&error([terminal.error("Ambiguous format. ")+`Use ${terminal.keyword("--format")} to indicate which output format to use.`,`Did you mean \`${r.join(", ")}\`?`])}gConfig.outputFormat?gConfig.verbose&&log(terminal.warning()+'Setting the format to "gConfig.outputFormat" based on the output file extension. Use `--format` to indicate which output format to use.'):(gConfig.outputFormat="yaml",log(terminal.warning("Format not specified.")+` Using "${terminal.keyword("yaml")}". `+`Use ${terminal.keyword("--format")} to indicate which output format to use.`))}mergeObject(gConfig.handlebarsHelpers,null===(N=r)||void 0===N?void 0:N.handlebarsHelpers);const U=build(e,r);return I.length>0&&(U.stderr=I.join("\n")),U}mergeObject(gConfig,DefaultFormatters),mergeObject(gConfig,WebFormats),mergeObject(gConfig,GenericFormats),mergeObject(gConfig,StyleGuideFormat),module.exports=chromatic;const fs$4=require("fs-extra"),path$1=require("path"),chokidar=require("chokidar");function logResult(e){console.log(Object.keys(e).map(r=>("stderr"===r?terminal.error():terminal.success())+">>>> "+terminal.path(r)+"\n"+e[r]).join("\n"))}require("yargs").usage("Usage: $0 file(s) [options]").example("$0 ./assets/tokens.yaml -o ./build/tokens.scss","Generate a Sass file from a design tokens YAML file").command(["* <paths..>","build <paths..>"],"Build output files",(function(e){e.positional("<path>",{describe:"Path to a token file or directory",type:"string"}).option("output",{alias:"o",describe:"Save output to path",type:"path"}).normalize("output").option("format",{alias:"f",describe:"Output format: css|sass|js|yaml|json",type:"string"}).option("header",{describe:"Content inserted at the to of the output file",type:"string"}).option("themes",{describe:"Comma separated list of themes to process",type:"string"}).option("split-output",{describe:"If there are multiple themes, output one file per theme. Otherwise the themes are combined in a single file.",type:"boolean",default:!1}).option("token-file-ext",{describe:"Default file extension of token files",type:"string",default:".yaml"}).option("dry-run",{describe:"Validate the token files, attempt to generate the specified file format, but don't output anything",conflicts:"output",type:"boolean"}).option("config",{describe:"Load config file from path",type:"path"}).normalize("config").option("verbose",{describe:"Display additional information during processing",type:"boolean"}).option("no-color",{describe:"Suppress color output in terminal",type:"boolean"}).option("ignore-errors",{alias:"i",describe:"Attempt to continue when an error is encountered",type:"boolean"}).option("watch",{describe:"Watch for changes to the token files and rebuild",type:"boolean"})}),(function(e){if(void 0===process.stdin.isTTY||process.stdin.isTTY)(!e.paths||e.paths.length<1)&&(console.error(terminal.error()+"Expected at least one path to a directory or token file.\n"+`    Use ${terminal.keyword(e.$0+" help")} for available options.\n`,`   Use ${terminal.keyword(e.$0+" example")} to create an example directory.`),process.exit(1)),e.watch?chokidar.watch(e.paths).on("all",(r,t)=>{chromatic(e.paths,Object.assign(Object.assign({},e),{watching:!0})),console.log(terminal.time()+` ${terminal.dim(e.$0)}: Waiting for changes...\n${terminal.dim("Press Ctrl-C to exit.")}`)}):logResult(chromatic(e.paths,e));else{process.stdin.setEncoding("utf-8");let r="";process.stdin.on("readable",(function(){let e;for(;e=process.stdin.read();)r+=e})),process.stdin.on("end",(function(){logResult(chromatic(r,e))}))}})).command("example [example-directory]","Create example directory",e=>{e.positional("example-directory",{describe:"Example output directory",type:"string"})},(function(e){var r;const t=path$1.resolve(null!=(r=e["example-directory"])?r:"chromatic-example");console.log("Creating an example in "+path$1.relative("",t));try{fs$4.copySync("examples/basic",t,{overwrite:!1,errorOnExist:!0}),console.log("Now, try the example:\n    "+terminal.keyword(e.$0+" "+path$1.relative("",t)+" -o ./build/tokens.scss")+"\nor:\n    "+terminal.keyword(e.$0+" "+path$1.relative("",t)+" -o ./build/tokens.html"))}catch(e){console.log(e.message)}})).command("help","Show help",()=>{},e=>e.help()).help("h").alias("h","help").epilog("For more information, see https://github.com/arnog/chromatic/docs/guide.md").strict(!0).argv;
